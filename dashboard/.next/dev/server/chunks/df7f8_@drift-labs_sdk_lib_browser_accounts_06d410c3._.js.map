{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/fetch.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.fetchRevenueShareEscrowAccount = exports.fetchRevenueShareAccount = exports.fetchUserStatsAccount = exports.fetchUserAccountsUsingKeys = exports.fetchUserAccounts = void 0;\nconst pda_1 = require(\"../addresses/pda\");\nasync function fetchUserAccounts(connection, program, authority, limit = 8) {\n    const userAccountPublicKeys = new Array();\n    for (let i = 0; i < limit; i++) {\n        userAccountPublicKeys.push(await (0, pda_1.getUserAccountPublicKey)(program.programId, authority, i));\n    }\n    return fetchUserAccountsUsingKeys(connection, program, userAccountPublicKeys);\n}\nexports.fetchUserAccounts = fetchUserAccounts;\nasync function fetchUserAccountsUsingKeys(connection, program, userAccountPublicKeys) {\n    const accountInfos = await connection.getMultipleAccountsInfo(userAccountPublicKeys, 'confirmed');\n    return accountInfos.map((accountInfo) => {\n        if (!accountInfo) {\n            return undefined;\n        }\n        return program.account.user.coder.accounts.decodeUnchecked('User', accountInfo.data);\n    });\n}\nexports.fetchUserAccountsUsingKeys = fetchUserAccountsUsingKeys;\nasync function fetchUserStatsAccount(connection, program, authority) {\n    const userStatsPublicKey = (0, pda_1.getUserStatsAccountPublicKey)(program.programId, authority);\n    const accountInfo = await connection.getAccountInfo(userStatsPublicKey, 'confirmed');\n    return accountInfo\n        ? program.account.user.coder.accounts.decodeUnchecked('UserStats', accountInfo.data)\n        : undefined;\n}\nexports.fetchUserStatsAccount = fetchUserStatsAccount;\nasync function fetchRevenueShareAccount(connection, program, authority) {\n    const revenueShareAccountPublicKey = (0, pda_1.getRevenueShareAccountPublicKey)(program.programId, authority);\n    const accountInfo = await connection.getAccountInfo(revenueShareAccountPublicKey);\n    if (!accountInfo)\n        return null;\n    return program.account.revenueShare.coder.accounts.decode('RevenueShare', accountInfo.data);\n}\nexports.fetchRevenueShareAccount = fetchRevenueShareAccount;\nasync function fetchRevenueShareEscrowAccount(connection, program, authority) {\n    const revenueShareEscrowPubKey = (0, pda_1.getRevenueShareEscrowAccountPublicKey)(program.programId, authority);\n    const escrow = await connection.getAccountInfo(revenueShareEscrowPubKey);\n    if (!escrow)\n        return null;\n    const escrowAccount = program.account.revenueShareEscrow.coder.accounts.decode('RevenueShareEscrow', escrow.data);\n    return escrowAccount;\n}\nexports.fetchRevenueShareEscrowAccount = fetchRevenueShareEscrowAccount;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,8BAA8B,GAAG,QAAQ,wBAAwB,GAAG,QAAQ,qBAAqB,GAAG,QAAQ,0BAA0B,GAAG,QAAQ,iBAAiB,GAAG,KAAK;AAClL,MAAM;AACN,eAAe,kBAAkB,UAAU,EAAE,OAAO,EAAE,SAAS,EAAE,QAAQ,CAAC;IACtE,MAAM,wBAAwB,IAAI;IAClC,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,IAAK;QAC5B,sBAAsB,IAAI,CAAC,MAAM,CAAC,GAAG,MAAM,uBAAuB,EAAE,QAAQ,SAAS,EAAE,WAAW;IACtG;IACA,OAAO,2BAA2B,YAAY,SAAS;AAC3D;AACA,QAAQ,iBAAiB,GAAG;AAC5B,eAAe,2BAA2B,UAAU,EAAE,OAAO,EAAE,qBAAqB;IAChF,MAAM,eAAe,MAAM,WAAW,uBAAuB,CAAC,uBAAuB;IACrF,OAAO,aAAa,GAAG,CAAC,CAAC;QACrB,IAAI,CAAC,aAAa;YACd,OAAO;QACX;QACA,OAAO,QAAQ,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,eAAe,CAAC,QAAQ,YAAY,IAAI;IACvF;AACJ;AACA,QAAQ,0BAA0B,GAAG;AACrC,eAAe,sBAAsB,UAAU,EAAE,OAAO,EAAE,SAAS;IAC/D,MAAM,qBAAqB,CAAC,GAAG,MAAM,4BAA4B,EAAE,QAAQ,SAAS,EAAE;IACtF,MAAM,cAAc,MAAM,WAAW,cAAc,CAAC,oBAAoB;IACxE,OAAO,cACD,QAAQ,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,eAAe,CAAC,aAAa,YAAY,IAAI,IACjF;AACV;AACA,QAAQ,qBAAqB,GAAG;AAChC,eAAe,yBAAyB,UAAU,EAAE,OAAO,EAAE,SAAS;IAClE,MAAM,+BAA+B,CAAC,GAAG,MAAM,+BAA+B,EAAE,QAAQ,SAAS,EAAE;IACnG,MAAM,cAAc,MAAM,WAAW,cAAc,CAAC;IACpD,IAAI,CAAC,aACD,OAAO;IACX,OAAO,QAAQ,OAAO,CAAC,YAAY,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,gBAAgB,YAAY,IAAI;AAC9F;AACA,QAAQ,wBAAwB,GAAG;AACnC,eAAe,+BAA+B,UAAU,EAAE,OAAO,EAAE,SAAS;IACxE,MAAM,2BAA2B,CAAC,GAAG,MAAM,qCAAqC,EAAE,QAAQ,SAAS,EAAE;IACrG,MAAM,SAAS,MAAM,WAAW,cAAc,CAAC;IAC/C,IAAI,CAAC,QACD,OAAO;IACX,MAAM,gBAAgB,QAAQ,OAAO,CAAC,kBAAkB,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,sBAAsB,OAAO,IAAI;IAChH,OAAO;AACX;AACA,QAAQ,8BAA8B,GAAG","ignoreList":[0]}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/types.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DelistedMarketSetting = exports.NotSubscribedError = void 0;\nclass NotSubscribedError extends Error {\n    constructor() {\n        super(...arguments);\n        this.name = 'NotSubscribedError';\n    }\n}\nexports.NotSubscribedError = NotSubscribedError;\nvar DelistedMarketSetting;\n(function (DelistedMarketSetting) {\n    DelistedMarketSetting[DelistedMarketSetting[\"Unsubscribe\"] = 0] = \"Unsubscribe\";\n    DelistedMarketSetting[DelistedMarketSetting[\"Subscribe\"] = 1] = \"Subscribe\";\n    DelistedMarketSetting[DelistedMarketSetting[\"Discard\"] = 2] = \"Discard\";\n})(DelistedMarketSetting || (exports.DelistedMarketSetting = DelistedMarketSetting = {}));\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,qBAAqB,GAAG,QAAQ,kBAAkB,GAAG,KAAK;AAClE,MAAM,2BAA2B;IAC7B,aAAc;QACV,KAAK,IAAI;QACT,IAAI,CAAC,IAAI,GAAG;IAChB;AACJ;AACA,QAAQ,kBAAkB,GAAG;AAC7B,IAAI;AACJ,CAAC,SAAU,qBAAqB;IAC5B,qBAAqB,CAAC,qBAAqB,CAAC,cAAc,GAAG,EAAE,GAAG;IAClE,qBAAqB,CAAC,qBAAqB,CAAC,YAAY,GAAG,EAAE,GAAG;IAChE,qBAAqB,CAAC,qBAAqB,CAAC,UAAU,GAAG,EAAE,GAAG;AAClE,CAAC,EAAE,yBAAyB,CAAC,QAAQ,qBAAqB,GAAG,wBAAwB,CAAC,CAAC","ignoreList":[0]}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/utils.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.findDelistedPerpMarketsAndOracles = exports.capitalize = void 0;\nconst types_1 = require(\"../types\");\nconst oracleId_1 = require(\"../oracles/oracleId\");\nfunction capitalize(value) {\n    return value[0].toUpperCase() + value.slice(1);\n}\nexports.capitalize = capitalize;\nfunction findDelistedPerpMarketsAndOracles(perpMarkets, spotMarkets) {\n    const delistedPerpMarketIndexes = [];\n    const delistedOracles = [];\n    for (const perpMarket of perpMarkets) {\n        if (!perpMarket.data) {\n            continue;\n        }\n        if ((0, types_1.isVariant)(perpMarket.data.status, 'delisted')) {\n            delistedPerpMarketIndexes.push(perpMarket.data.marketIndex);\n            delistedOracles.push({\n                publicKey: perpMarket.data.amm.oracle,\n                source: perpMarket.data.amm.oracleSource,\n            });\n        }\n    }\n    // make sure oracle isn't used by spot market\n    const filteredDelistedOracles = [];\n    for (const delistedOracle of delistedOracles) {\n        let isUsedBySpotMarket = false;\n        for (const spotMarket of spotMarkets) {\n            if (!spotMarket.data) {\n                continue;\n            }\n            const delistedOracleId = (0, oracleId_1.getOracleId)(delistedOracle.publicKey, delistedOracle.source);\n            const spotMarketOracleId = (0, oracleId_1.getOracleId)(spotMarket.data.oracle, spotMarket.data.oracleSource);\n            if (spotMarketOracleId === delistedOracleId) {\n                isUsedBySpotMarket = true;\n                break;\n            }\n        }\n        if (!isUsedBySpotMarket) {\n            filteredDelistedOracles.push(delistedOracle);\n        }\n    }\n    return {\n        perpMarketIndexes: delistedPerpMarketIndexes,\n        oracles: filteredDelistedOracles,\n    };\n}\nexports.findDelistedPerpMarketsAndOracles = findDelistedPerpMarketsAndOracles;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,iCAAiC,GAAG,QAAQ,UAAU,GAAG,KAAK;AACtE,MAAM;AACN,MAAM;AACN,SAAS,WAAW,KAAK;IACrB,OAAO,KAAK,CAAC,EAAE,CAAC,WAAW,KAAK,MAAM,KAAK,CAAC;AAChD;AACA,QAAQ,UAAU,GAAG;AACrB,SAAS,kCAAkC,WAAW,EAAE,WAAW;IAC/D,MAAM,4BAA4B,EAAE;IACpC,MAAM,kBAAkB,EAAE;IAC1B,KAAK,MAAM,cAAc,YAAa;QAClC,IAAI,CAAC,WAAW,IAAI,EAAE;YAClB;QACJ;QACA,IAAI,CAAC,GAAG,QAAQ,SAAS,EAAE,WAAW,IAAI,CAAC,MAAM,EAAE,aAAa;YAC5D,0BAA0B,IAAI,CAAC,WAAW,IAAI,CAAC,WAAW;YAC1D,gBAAgB,IAAI,CAAC;gBACjB,WAAW,WAAW,IAAI,CAAC,GAAG,CAAC,MAAM;gBACrC,QAAQ,WAAW,IAAI,CAAC,GAAG,CAAC,YAAY;YAC5C;QACJ;IACJ;IACA,6CAA6C;IAC7C,MAAM,0BAA0B,EAAE;IAClC,KAAK,MAAM,kBAAkB,gBAAiB;QAC1C,IAAI,qBAAqB;QACzB,KAAK,MAAM,cAAc,YAAa;YAClC,IAAI,CAAC,WAAW,IAAI,EAAE;gBAClB;YACJ;YACA,MAAM,mBAAmB,CAAC,GAAG,WAAW,WAAW,EAAE,eAAe,SAAS,EAAE,eAAe,MAAM;YACpG,MAAM,qBAAqB,CAAC,GAAG,WAAW,WAAW,EAAE,WAAW,IAAI,CAAC,MAAM,EAAE,WAAW,IAAI,CAAC,YAAY;YAC3G,IAAI,uBAAuB,kBAAkB;gBACzC,qBAAqB;gBACrB;YACJ;QACJ;QACA,IAAI,CAAC,oBAAoB;YACrB,wBAAwB,IAAI,CAAC;QACjC;IACJ;IACA,OAAO;QACH,mBAAmB;QACnB,SAAS;IACb;AACJ;AACA,QAAQ,iCAAiC,GAAG","ignoreList":[0]}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/webSocketAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebSocketAccountSubscriber = void 0;\nconst utils_1 = require(\"./utils\");\nclass WebSocketAccountSubscriber {\n    constructor(accountName, program, accountPublicKey, decodeBuffer, resubOpts, commitment) {\n        var _a;\n        this.isUnsubscribing = false;\n        this.accountName = accountName;\n        this.logAccountName = `${accountName}-${accountPublicKey.toBase58()}`;\n        this.program = program;\n        this.accountPublicKey = accountPublicKey;\n        this.decodeBufferFn = decodeBuffer;\n        this.resubOpts = resubOpts;\n        if (((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs) < 1000) {\n            console.log(`resubTimeoutMs should be at least 1000ms to avoid spamming resub ${this.logAccountName}`);\n        }\n        this.receivingData = false;\n        this.commitment =\n            commitment !== null && commitment !== void 0 ? commitment : this.program.provider.opts.commitment;\n    }\n    async subscribe(onChange) {\n        var _a, _b;\n        if (this.listenerId != null || this.isUnsubscribing) {\n            if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n                console.log(`[${this.logAccountName}] Subscribe returning early - listenerId=${this.listenerId}, isUnsubscribing=${this.isUnsubscribing}`);\n            }\n            return;\n        }\n        this.onChange = onChange;\n        if (!this.dataAndSlot) {\n            await this.fetch();\n        }\n        this.listenerId = this.program.provider.connection.onAccountChange(this.accountPublicKey, (accountInfo, context) => {\n            var _a;\n            if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs) {\n                this.receivingData = true;\n                clearTimeout(this.timeoutId);\n                this.handleRpcResponse(context, accountInfo);\n                this.setTimeout();\n            }\n            else {\n                this.handleRpcResponse(context, accountInfo);\n            }\n        }, this.commitment);\n        if ((_b = this.resubOpts) === null || _b === void 0 ? void 0 : _b.resubTimeoutMs) {\n            this.receivingData = true;\n            this.setTimeout();\n        }\n    }\n    setData(data, slot) {\n        const newSlot = slot || 0;\n        if (this.dataAndSlot && this.dataAndSlot.slot > newSlot) {\n            return;\n        }\n        this.dataAndSlot = {\n            data,\n            slot,\n        };\n    }\n    setTimeout() {\n        var _a;\n        if (!this.onChange) {\n            throw new Error('onChange callback function must be set');\n        }\n        this.timeoutId = setTimeout(async () => {\n            var _a, _b, _c, _d;\n            if (this.isUnsubscribing) {\n                // If we are in the process of unsubscribing, do not attempt to resubscribe\n                if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n                    console.log(`[${this.logAccountName}] Timeout fired but isUnsubscribing=true, skipping resubscribe`);\n                }\n                return;\n            }\n            if (this.receivingData) {\n                if ((_b = this.resubOpts) === null || _b === void 0 ? void 0 : _b.logResubMessages) {\n                    console.log(`No ws data from ${this.logAccountName} in ${this.resubOpts.resubTimeoutMs}ms, resubscribing - listenerId=${this.listenerId}, isUnsubscribing=${this.isUnsubscribing}`);\n                }\n                await this.unsubscribe(true);\n                this.receivingData = false;\n                await this.subscribe(this.onChange);\n                if ((_c = this.resubOpts) === null || _c === void 0 ? void 0 : _c.logResubMessages) {\n                    console.log(`[${this.logAccountName}] Resubscribe completed - receivingData=${this.receivingData}, listenerId=${this.listenerId}, isUnsubscribing=${this.isUnsubscribing}`);\n                }\n            }\n            else {\n                if ((_d = this.resubOpts) === null || _d === void 0 ? void 0 : _d.logResubMessages) {\n                    console.log(`[${this.logAccountName}] Timeout fired but receivingData=false, skipping resubscribe`);\n                }\n            }\n        }, (_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs);\n    }\n    async fetch() {\n        const rpcResponse = await this.program.provider.connection.getAccountInfoAndContext(this.accountPublicKey, this.program.provider.opts.commitment);\n        this.handleRpcResponse(rpcResponse.context, rpcResponse === null || rpcResponse === void 0 ? void 0 : rpcResponse.value);\n    }\n    handleRpcResponse(context, accountInfo) {\n        const newSlot = context.slot;\n        let newBuffer = undefined;\n        if (accountInfo) {\n            newBuffer = accountInfo.data;\n        }\n        if (!this.bufferAndSlot) {\n            this.bufferAndSlot = {\n                buffer: newBuffer,\n                slot: newSlot,\n            };\n            if (newBuffer) {\n                const account = this.decodeBuffer(newBuffer);\n                this.dataAndSlot = {\n                    data: account,\n                    slot: newSlot,\n                };\n                this.onChange(account);\n            }\n            return;\n        }\n        if (newSlot < this.bufferAndSlot.slot) {\n            return;\n        }\n        const oldBuffer = this.bufferAndSlot.buffer;\n        if (newBuffer && (!oldBuffer || !newBuffer.equals(oldBuffer))) {\n            this.bufferAndSlot = {\n                buffer: newBuffer,\n                slot: newSlot,\n            };\n            const account = this.decodeBuffer(newBuffer);\n            this.dataAndSlot = {\n                data: account,\n                slot: newSlot,\n            };\n            this.onChange(account);\n        }\n    }\n    decodeBuffer(buffer) {\n        if (this.decodeBufferFn) {\n            return this.decodeBufferFn(buffer);\n        }\n        else {\n            return this.program.account[this.accountName].coder.accounts.decode((0, utils_1.capitalize)(this.accountName), buffer);\n        }\n    }\n    unsubscribe(onResub = false) {\n        if (!onResub && this.resubOpts) {\n            this.resubOpts.resubTimeoutMs = undefined;\n        }\n        this.isUnsubscribing = true;\n        clearTimeout(this.timeoutId);\n        this.timeoutId = undefined;\n        if (this.listenerId != null) {\n            const promise = Promise.race([\n                this.program.provider.connection.removeAccountChangeListener(this.listenerId),\n                new Promise((_, reject) => setTimeout(() => reject(new Error(`Unsubscribe timeout for account ${this.logAccountName}`)), 10000)),\n            ])\n                .then(() => {\n                this.listenerId = undefined;\n                this.isUnsubscribing = false;\n            })\n                .catch((error) => {\n                console.error(`[${this.logAccountName}] Unsubscribe failed, forcing cleanup - listenerId=${this.listenerId}, isUnsubscribing=${this.isUnsubscribing}`, error);\n                this.listenerId = undefined;\n                this.isUnsubscribing = false;\n            });\n            return promise;\n        }\n        else {\n            this.isUnsubscribing = false;\n        }\n    }\n}\nexports.WebSocketAccountSubscriber = WebSocketAccountSubscriber;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 296, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/webSocketDriftClientAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebSocketDriftClientAccountSubscriber = void 0;\nconst types_1 = require(\"./types\");\nconst events_1 = require(\"events\");\nconst pda_1 = require(\"../addresses/pda\");\nconst webSocketAccountSubscriber_1 = require(\"./webSocketAccountSubscriber\");\nconst web3_js_1 = require(\"@solana/web3.js\");\nconst oracleClientCache_1 = require(\"../oracles/oracleClientCache\");\nconst quoteAssetOracleClient_1 = require(\"../oracles/quoteAssetOracleClient\");\nconst config_1 = require(\"../config\");\nconst utils_1 = require(\"./utils\");\nconst oracleId_1 = require(\"../oracles/oracleId\");\nconst types_2 = require(\"../types\");\nconst ORACLE_DEFAULT_ID = (0, oracleId_1.getOracleId)(web3_js_1.PublicKey.default, types_2.OracleSource.QUOTE_ASSET);\nclass WebSocketDriftClientAccountSubscriber {\n    constructor(program, perpMarketIndexes, spotMarketIndexes, oracleInfos, shouldFindAllMarketsAndOracles, delistedMarketSetting, resubOpts, commitment, customPerpMarketAccountSubscriber, customOracleAccountSubscriber) {\n        this.oracleClientCache = new oracleClientCache_1.OracleClientCache();\n        this.perpMarketAccountSubscribers = new Map();\n        this.perpOracleMap = new Map();\n        this.perpOracleStringMap = new Map();\n        this.spotMarketAccountSubscribers = new Map();\n        this.spotOracleMap = new Map();\n        this.spotOracleStringMap = new Map();\n        this.oracleSubscribers = new Map();\n        this.isSubscribing = false;\n        this.chunks = (array, size) => {\n            return new Array(Math.ceil(array.length / size))\n                .fill(null)\n                .map((_, index) => index * size)\n                .map((begin) => array.slice(begin, begin + size));\n        };\n        this.isSubscribed = false;\n        this.program = program;\n        this.eventEmitter = new events_1.EventEmitter();\n        this.perpMarketIndexes = perpMarketIndexes;\n        this.spotMarketIndexes = spotMarketIndexes;\n        this.oracleInfos = oracleInfos;\n        this.shouldFindAllMarketsAndOracles = shouldFindAllMarketsAndOracles;\n        this.delistedMarketSetting = delistedMarketSetting;\n        this.resubOpts = resubOpts;\n        this.commitment = commitment;\n        this.customPerpMarketAccountSubscriber = customPerpMarketAccountSubscriber;\n        this.customOracleAccountSubscriber = customOracleAccountSubscriber;\n    }\n    async subscribe() {\n        if (this.isSubscribed) {\n            return true;\n        }\n        if (this.isSubscribing) {\n            return await this.subscriptionPromise;\n        }\n        this.isSubscribing = true;\n        this.subscriptionPromise = new Promise((res) => {\n            this.subscriptionPromiseResolver = res;\n        });\n        if (this.shouldFindAllMarketsAndOracles) {\n            const { perpMarketIndexes, perpMarketAccounts, spotMarketIndexes, spotMarketAccounts, oracleInfos, } = await (0, config_1.findAllMarketAndOracles)(this.program);\n            this.perpMarketIndexes = perpMarketIndexes;\n            this.spotMarketIndexes = spotMarketIndexes;\n            this.oracleInfos = oracleInfos;\n            // front run and set the initial data here to save extra gma call in set initial data\n            this.initialPerpMarketAccountData = new Map(perpMarketAccounts.map((market) => [market.marketIndex, market]));\n            this.initialSpotMarketAccountData = new Map(spotMarketAccounts.map((market) => [market.marketIndex, market]));\n        }\n        const statePublicKey = await (0, pda_1.getDriftStateAccountPublicKey)(this.program.programId);\n        // create and activate main state account subscription\n        this.stateAccountSubscriber = new webSocketAccountSubscriber_1.WebSocketAccountSubscriber('state', this.program, statePublicKey, undefined, undefined, this.commitment);\n        await this.stateAccountSubscriber.subscribe((data) => {\n            this.eventEmitter.emit('stateAccountUpdate', data);\n            this.eventEmitter.emit('update');\n        });\n        // set initial data to avoid spamming getAccountInfo calls in webSocketAccountSubscriber\n        await this.setInitialData();\n        await Promise.all([\n            // subscribe to market accounts\n            this.subscribeToPerpMarketAccounts(),\n            // subscribe to spot market accounts\n            this.subscribeToSpotMarketAccounts(),\n            // subscribe to oracles\n            this.subscribeToOracles(),\n        ]);\n        this.eventEmitter.emit('update');\n        await this.handleDelistedMarkets();\n        await Promise.all([this.setPerpOracleMap(), this.setSpotOracleMap()]);\n        this.isSubscribing = false;\n        this.isSubscribed = true;\n        this.subscriptionPromiseResolver(true);\n        // delete initial data\n        this.removeInitialData();\n        return true;\n    }\n    async setInitialData() {\n        const connection = this.program.provider.connection;\n        if (!this.initialPerpMarketAccountData) {\n            const perpMarketPublicKeys = this.perpMarketIndexes.map((marketIndex) => (0, pda_1.getPerpMarketPublicKeySync)(this.program.programId, marketIndex));\n            const perpMarketPublicKeysChunks = this.chunks(perpMarketPublicKeys, 75);\n            const perpMarketAccountInfos = (await Promise.all(perpMarketPublicKeysChunks.map((perpMarketPublicKeysChunk) => connection.getMultipleAccountsInfo(perpMarketPublicKeysChunk)))).flat();\n            this.initialPerpMarketAccountData = new Map(perpMarketAccountInfos\n                .filter((accountInfo) => !!accountInfo)\n                .map((accountInfo) => {\n                const perpMarket = this.program.coder.accounts.decode('PerpMarket', accountInfo.data);\n                return [perpMarket.marketIndex, perpMarket];\n            }));\n        }\n        if (!this.initialSpotMarketAccountData) {\n            const spotMarketPublicKeys = this.spotMarketIndexes.map((marketIndex) => (0, pda_1.getSpotMarketPublicKeySync)(this.program.programId, marketIndex));\n            const spotMarketPublicKeysChunks = this.chunks(spotMarketPublicKeys, 75);\n            const spotMarketAccountInfos = (await Promise.all(spotMarketPublicKeysChunks.map((spotMarketPublicKeysChunk) => connection.getMultipleAccountsInfo(spotMarketPublicKeysChunk)))).flat();\n            this.initialSpotMarketAccountData = new Map(spotMarketAccountInfos\n                .filter((accountInfo) => !!accountInfo)\n                .map((accountInfo) => {\n                const spotMarket = this.program.coder.accounts.decode('SpotMarket', accountInfo.data);\n                return [spotMarket.marketIndex, spotMarket];\n            }));\n        }\n        const oracleAccountPubkeyChunks = this.chunks(this.oracleInfos.map((oracleInfo) => oracleInfo.publicKey), 75);\n        const oracleAccountInfos = (await Promise.all(oracleAccountPubkeyChunks.map((oracleAccountPublicKeysChunk) => connection.getMultipleAccountsInfo(oracleAccountPublicKeysChunk)))).flat();\n        this.initialOraclePriceData = new Map(this.oracleInfos.reduce((result, oracleInfo, i) => {\n            if (!oracleAccountInfos[i]) {\n                return result;\n            }\n            const oracleClient = this.oracleClientCache.get(oracleInfo.source, connection, this.program);\n            const oraclePriceData = oracleClient.getOraclePriceDataFromBuffer(oracleAccountInfos[i].data);\n            result.push([\n                (0, oracleId_1.getOracleId)(oracleInfo.publicKey, oracleInfo.source),\n                oraclePriceData,\n            ]);\n            return result;\n        }, []));\n    }\n    removeInitialData() {\n        this.initialPerpMarketAccountData = new Map();\n        this.initialSpotMarketAccountData = new Map();\n        this.initialOraclePriceData = new Map();\n    }\n    async subscribeToPerpMarketAccounts() {\n        await Promise.all(this.perpMarketIndexes.map((marketIndex) => this.subscribeToPerpMarketAccount(marketIndex)));\n        return true;\n    }\n    async subscribeToPerpMarketAccount(marketIndex) {\n        const perpMarketPublicKey = await (0, pda_1.getPerpMarketPublicKey)(this.program.programId, marketIndex);\n        const AccountSubscriberClass = this.customPerpMarketAccountSubscriber || webSocketAccountSubscriber_1.WebSocketAccountSubscriber;\n        const accountSubscriber = new AccountSubscriberClass('perpMarket', this.program, perpMarketPublicKey, undefined, this.resubOpts, this.commitment);\n        accountSubscriber.setData(this.initialPerpMarketAccountData.get(marketIndex));\n        await accountSubscriber.subscribe((data) => {\n            this.eventEmitter.emit('perpMarketAccountUpdate', data);\n            this.eventEmitter.emit('update');\n        });\n        this.perpMarketAccountSubscribers.set(marketIndex, accountSubscriber);\n        return true;\n    }\n    async subscribeToSpotMarketAccounts() {\n        await Promise.all(this.spotMarketIndexes.map((marketIndex) => this.subscribeToSpotMarketAccount(marketIndex)));\n        return true;\n    }\n    async subscribeToSpotMarketAccount(marketIndex) {\n        const marketPublicKey = await (0, pda_1.getSpotMarketPublicKey)(this.program.programId, marketIndex);\n        const accountSubscriber = new webSocketAccountSubscriber_1.WebSocketAccountSubscriber('spotMarket', this.program, marketPublicKey, undefined, this.resubOpts, this.commitment);\n        accountSubscriber.setData(this.initialSpotMarketAccountData.get(marketIndex));\n        await accountSubscriber.subscribe((data) => {\n            this.eventEmitter.emit('spotMarketAccountUpdate', data);\n            this.eventEmitter.emit('update');\n        });\n        this.spotMarketAccountSubscribers.set(marketIndex, accountSubscriber);\n        return true;\n    }\n    async subscribeToOracles() {\n        await Promise.all(this.oracleInfos\n            .filter((oracleInfo) => !oracleInfo.publicKey.equals(web3_js_1.PublicKey.default))\n            .map((oracleInfo) => this.subscribeToOracle(oracleInfo)));\n        return true;\n    }\n    async subscribeToOracle(oracleInfo) {\n        const oracleId = (0, oracleId_1.getOracleId)(oracleInfo.publicKey, oracleInfo.source);\n        const client = this.oracleClientCache.get(oracleInfo.source, this.program.provider.connection, this.program);\n        const AccountSubscriberClass = this.customOracleAccountSubscriber || webSocketAccountSubscriber_1.WebSocketAccountSubscriber;\n        const accountSubscriber = new AccountSubscriberClass('oracle', this.program, oracleInfo.publicKey, (buffer) => {\n            return client.getOraclePriceDataFromBuffer(buffer);\n        }, this.resubOpts, this.commitment);\n        const initialOraclePriceData = this.initialOraclePriceData.get(oracleId);\n        if (initialOraclePriceData) {\n            accountSubscriber.setData(initialOraclePriceData);\n        }\n        await accountSubscriber.subscribe((data) => {\n            this.eventEmitter.emit('oraclePriceUpdate', oracleInfo.publicKey, oracleInfo.source, data);\n            this.eventEmitter.emit('update');\n        });\n        this.oracleSubscribers.set(oracleId, accountSubscriber);\n        return true;\n    }\n    async unsubscribeFromMarketAccounts() {\n        await Promise.all(Array.from(this.perpMarketAccountSubscribers.values()).map((accountSubscriber) => accountSubscriber.unsubscribe()));\n    }\n    async unsubscribeFromSpotMarketAccounts() {\n        await Promise.all(Array.from(this.spotMarketAccountSubscribers.values()).map((accountSubscriber) => accountSubscriber.unsubscribe()));\n    }\n    async unsubscribeFromOracles() {\n        await Promise.all(Array.from(this.oracleSubscribers.values()).map((accountSubscriber) => accountSubscriber.unsubscribe()));\n    }\n    async fetch() {\n        if (!this.isSubscribed) {\n            return;\n        }\n        const promises = [this.stateAccountSubscriber.fetch()]\n            .concat(Array.from(this.perpMarketAccountSubscribers.values()).map((subscriber) => subscriber.fetch()))\n            .concat(Array.from(this.spotMarketAccountSubscribers.values()).map((subscriber) => subscriber.fetch()));\n        await Promise.all(promises);\n    }\n    async unsubscribe() {\n        if (!this.isSubscribed) {\n            return;\n        }\n        await this.stateAccountSubscriber.unsubscribe();\n        await this.unsubscribeFromMarketAccounts();\n        await this.unsubscribeFromSpotMarketAccounts();\n        await this.unsubscribeFromOracles();\n        this.isSubscribed = false;\n    }\n    async addSpotMarket(marketIndex) {\n        if (this.spotMarketAccountSubscribers.has(marketIndex)) {\n            return true;\n        }\n        const subscriptionSuccess = this.subscribeToSpotMarketAccount(marketIndex);\n        await this.setSpotOracleMap();\n        return subscriptionSuccess;\n    }\n    async addPerpMarket(marketIndex) {\n        if (this.perpMarketAccountSubscribers.has(marketIndex)) {\n            return true;\n        }\n        const subscriptionSuccess = this.subscribeToPerpMarketAccount(marketIndex);\n        await this.setPerpOracleMap();\n        return subscriptionSuccess;\n    }\n    async addOracle(oracleInfo) {\n        const oracleId = (0, oracleId_1.getOracleId)(oracleInfo.publicKey, oracleInfo.source);\n        if (this.oracleSubscribers.has(oracleId)) {\n            return true;\n        }\n        if (oracleInfo.publicKey.equals(web3_js_1.PublicKey.default)) {\n            return true;\n        }\n        return this.subscribeToOracle(oracleInfo);\n    }\n    async setPerpOracleMap() {\n        const perpMarkets = this.getMarketAccountsAndSlots();\n        const addOraclePromises = [];\n        for (const perpMarket of perpMarkets) {\n            if (!perpMarket || !perpMarket.data) {\n                continue;\n            }\n            const perpMarketAccount = perpMarket.data;\n            const perpMarketIndex = perpMarketAccount.marketIndex;\n            const oracle = perpMarketAccount.amm.oracle;\n            const oracleId = (0, oracleId_1.getOracleId)(oracle, perpMarket.data.amm.oracleSource);\n            if (!this.oracleSubscribers.has(oracleId)) {\n                addOraclePromises.push(this.addOracle({\n                    publicKey: oracle,\n                    source: perpMarket.data.amm.oracleSource,\n                }));\n            }\n            this.perpOracleMap.set(perpMarketIndex, oracle);\n            this.perpOracleStringMap.set(perpMarketIndex, oracleId);\n        }\n        await Promise.all(addOraclePromises);\n    }\n    async setSpotOracleMap() {\n        const spotMarkets = this.getSpotMarketAccountsAndSlots();\n        const addOraclePromises = [];\n        for (const spotMarket of spotMarkets) {\n            if (!spotMarket || !spotMarket.data) {\n                continue;\n            }\n            const spotMarketAccount = spotMarket.data;\n            const spotMarketIndex = spotMarketAccount.marketIndex;\n            const oracle = spotMarketAccount.oracle;\n            const oracleId = (0, oracleId_1.getOracleId)(oracle, spotMarketAccount.oracleSource);\n            if (!this.oracleSubscribers.has(oracleId)) {\n                addOraclePromises.push(this.addOracle({\n                    publicKey: oracle,\n                    source: spotMarketAccount.oracleSource,\n                }));\n            }\n            this.spotOracleMap.set(spotMarketIndex, oracle);\n            this.spotOracleStringMap.set(spotMarketIndex, oracleId);\n        }\n        await Promise.all(addOraclePromises);\n    }\n    async handleDelistedMarkets() {\n        if (this.delistedMarketSetting === types_1.DelistedMarketSetting.Subscribe) {\n            return;\n        }\n        const { perpMarketIndexes, oracles } = (0, utils_1.findDelistedPerpMarketsAndOracles)(this.getMarketAccountsAndSlots(), this.getSpotMarketAccountsAndSlots());\n        for (const perpMarketIndex of perpMarketIndexes) {\n            await this.perpMarketAccountSubscribers\n                .get(perpMarketIndex)\n                .unsubscribe();\n            if (this.delistedMarketSetting === types_1.DelistedMarketSetting.Discard) {\n                this.perpMarketAccountSubscribers.delete(perpMarketIndex);\n            }\n        }\n        for (const oracle of oracles) {\n            const oracleId = (0, oracleId_1.getOracleId)(oracle.publicKey, oracle.source);\n            await this.oracleSubscribers.get(oracleId).unsubscribe();\n            if (this.delistedMarketSetting === types_1.DelistedMarketSetting.Discard) {\n                this.oracleSubscribers.delete(oracleId);\n            }\n        }\n    }\n    assertIsSubscribed() {\n        if (!this.isSubscribed) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` before using this function');\n        }\n    }\n    getStateAccountAndSlot() {\n        this.assertIsSubscribed();\n        return this.stateAccountSubscriber.dataAndSlot;\n    }\n    getMarketAccountAndSlot(marketIndex) {\n        this.assertIsSubscribed();\n        return this.perpMarketAccountSubscribers.get(marketIndex).dataAndSlot;\n    }\n    getMarketAccountsAndSlots() {\n        return Array.from(this.perpMarketAccountSubscribers.values()).map((subscriber) => subscriber.dataAndSlot);\n    }\n    getSpotMarketAccountAndSlot(marketIndex) {\n        this.assertIsSubscribed();\n        return this.spotMarketAccountSubscribers.get(marketIndex).dataAndSlot;\n    }\n    getSpotMarketAccountsAndSlots() {\n        return Array.from(this.spotMarketAccountSubscribers.values()).map((subscriber) => subscriber.dataAndSlot);\n    }\n    getOraclePriceDataAndSlot(oracleId) {\n        this.assertIsSubscribed();\n        if (oracleId === ORACLE_DEFAULT_ID) {\n            return {\n                data: quoteAssetOracleClient_1.QUOTE_ORACLE_PRICE_DATA,\n                slot: 0,\n            };\n        }\n        return this.oracleSubscribers.get(oracleId).dataAndSlot;\n    }\n    getOraclePriceDataAndSlotForPerpMarket(marketIndex) {\n        const perpMarketAccount = this.getMarketAccountAndSlot(marketIndex);\n        const oracle = this.perpOracleMap.get(marketIndex);\n        const oracleId = this.perpOracleStringMap.get(marketIndex);\n        if (!perpMarketAccount || !oracleId) {\n            return undefined;\n        }\n        if (!perpMarketAccount.data.amm.oracle.equals(oracle)) {\n            // If the oracle has changed, we need to update the oracle map in background\n            this.setPerpOracleMap();\n        }\n        return this.getOraclePriceDataAndSlot(oracleId);\n    }\n    getOraclePriceDataAndSlotForSpotMarket(marketIndex) {\n        const spotMarketAccount = this.getSpotMarketAccountAndSlot(marketIndex);\n        const oracle = this.spotOracleMap.get(marketIndex);\n        const oracleId = this.spotOracleStringMap.get(marketIndex);\n        if (!spotMarketAccount || !oracleId) {\n            return undefined;\n        }\n        if (!spotMarketAccount.data.oracle.equals(oracle)) {\n            // If the oracle has changed, we need to update the oracle map in background\n            this.setSpotOracleMap();\n        }\n        return this.getOraclePriceDataAndSlot(oracleId);\n    }\n}\nexports.WebSocketDriftClientAccountSubscriber = WebSocketDriftClientAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,qCAAqC,GAAG,KAAK;AACrD,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,oBAAoB,CAAC,GAAG,WAAW,WAAW,EAAE,UAAU,SAAS,CAAC,OAAO,EAAE,QAAQ,YAAY,CAAC,WAAW;AACnH,MAAM;IACF,YAAY,OAAO,EAAE,iBAAiB,EAAE,iBAAiB,EAAE,WAAW,EAAE,8BAA8B,EAAE,qBAAqB,EAAE,SAAS,EAAE,UAAU,EAAE,iCAAiC,EAAE,6BAA6B,CAAE;QACpN,IAAI,CAAC,iBAAiB,GAAG,IAAI,oBAAoB,iBAAiB;QAClE,IAAI,CAAC,4BAA4B,GAAG,IAAI;QACxC,IAAI,CAAC,aAAa,GAAG,IAAI;QACzB,IAAI,CAAC,mBAAmB,GAAG,IAAI;QAC/B,IAAI,CAAC,4BAA4B,GAAG,IAAI;QACxC,IAAI,CAAC,aAAa,GAAG,IAAI;QACzB,IAAI,CAAC,mBAAmB,GAAG,IAAI;QAC/B,IAAI,CAAC,iBAAiB,GAAG,IAAI;QAC7B,IAAI,CAAC,aAAa,GAAG;QACrB,IAAI,CAAC,MAAM,GAAG,CAAC,OAAO;YAClB,OAAO,IAAI,MAAM,KAAK,IAAI,CAAC,MAAM,MAAM,GAAG,OACrC,IAAI,CAAC,MACL,GAAG,CAAC,CAAC,GAAG,QAAU,QAAQ,MAC1B,GAAG,CAAC,CAAC,QAAU,MAAM,KAAK,CAAC,OAAO,QAAQ;QACnD;QACA,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,YAAY,GAAG,IAAI,SAAS,YAAY;QAC7C,IAAI,CAAC,iBAAiB,GAAG;QACzB,IAAI,CAAC,iBAAiB,GAAG;QACzB,IAAI,CAAC,WAAW,GAAG;QACnB,IAAI,CAAC,8BAA8B,GAAG;QACtC,IAAI,CAAC,qBAAqB,GAAG;QAC7B,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,CAAC,UAAU,GAAG;QAClB,IAAI,CAAC,iCAAiC,GAAG;QACzC,IAAI,CAAC,6BAA6B,GAAG;IACzC;IACA,MAAM,YAAY;QACd,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,OAAO;QACX;QACA,IAAI,IAAI,CAAC,aAAa,EAAE;YACpB,OAAO,MAAM,IAAI,CAAC,mBAAmB;QACzC;QACA,IAAI,CAAC,aAAa,GAAG;QACrB,IAAI,CAAC,mBAAmB,GAAG,IAAI,QAAQ,CAAC;YACpC,IAAI,CAAC,2BAA2B,GAAG;QACvC;QACA,IAAI,IAAI,CAAC,8BAA8B,EAAE;YACrC,MAAM,EAAE,iBAAiB,EAAE,kBAAkB,EAAE,iBAAiB,EAAE,kBAAkB,EAAE,WAAW,EAAG,GAAG,MAAM,CAAC,GAAG,SAAS,uBAAuB,EAAE,IAAI,CAAC,OAAO;YAC/J,IAAI,CAAC,iBAAiB,GAAG;YACzB,IAAI,CAAC,iBAAiB,GAAG;YACzB,IAAI,CAAC,WAAW,GAAG;YACnB,qFAAqF;YACrF,IAAI,CAAC,4BAA4B,GAAG,IAAI,IAAI,mBAAmB,GAAG,CAAC,CAAC,SAAW;oBAAC,OAAO,WAAW;oBAAE;iBAAO;YAC3G,IAAI,CAAC,4BAA4B,GAAG,IAAI,IAAI,mBAAmB,GAAG,CAAC,CAAC,SAAW;oBAAC,OAAO,WAAW;oBAAE;iBAAO;QAC/G;QACA,MAAM,iBAAiB,MAAM,CAAC,GAAG,MAAM,6BAA6B,EAAE,IAAI,CAAC,OAAO,CAAC,SAAS;QAC5F,sDAAsD;QACtD,IAAI,CAAC,sBAAsB,GAAG,IAAI,6BAA6B,0BAA0B,CAAC,SAAS,IAAI,CAAC,OAAO,EAAE,gBAAgB,WAAW,WAAW,IAAI,CAAC,UAAU;QACtK,MAAM,IAAI,CAAC,sBAAsB,CAAC,SAAS,CAAC,CAAC;YACzC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,sBAAsB;YAC7C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,wFAAwF;QACxF,MAAM,IAAI,CAAC,cAAc;QACzB,MAAM,QAAQ,GAAG,CAAC;YACd,+BAA+B;YAC/B,IAAI,CAAC,6BAA6B;YAClC,oCAAoC;YACpC,IAAI,CAAC,6BAA6B;YAClC,uBAAuB;YACvB,IAAI,CAAC,kBAAkB;SAC1B;QACD,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QACvB,MAAM,IAAI,CAAC,qBAAqB;QAChC,MAAM,QAAQ,GAAG,CAAC;YAAC,IAAI,CAAC,gBAAgB;YAAI,IAAI,CAAC,gBAAgB;SAAG;QACpE,IAAI,CAAC,aAAa,GAAG;QACrB,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,2BAA2B,CAAC;QACjC,sBAAsB;QACtB,IAAI,CAAC,iBAAiB;QACtB,OAAO;IACX;IACA,MAAM,iBAAiB;QACnB,MAAM,aAAa,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,UAAU;QACnD,IAAI,CAAC,IAAI,CAAC,4BAA4B,EAAE;YACpC,MAAM,uBAAuB,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,cAAgB,CAAC,GAAG,MAAM,0BAA0B,EAAE,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE;YACvI,MAAM,6BAA6B,IAAI,CAAC,MAAM,CAAC,sBAAsB;YACrE,MAAM,yBAAyB,CAAC,MAAM,QAAQ,GAAG,CAAC,2BAA2B,GAAG,CAAC,CAAC,4BAA8B,WAAW,uBAAuB,CAAC,4BAA4B,EAAE,IAAI;YACrL,IAAI,CAAC,4BAA4B,GAAG,IAAI,IAAI,uBACvC,MAAM,CAAC,CAAC,cAAgB,CAAC,CAAC,aAC1B,GAAG,CAAC,CAAC;gBACN,MAAM,aAAa,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,cAAc,YAAY,IAAI;gBACpF,OAAO;oBAAC,WAAW,WAAW;oBAAE;iBAAW;YAC/C;QACJ;QACA,IAAI,CAAC,IAAI,CAAC,4BAA4B,EAAE;YACpC,MAAM,uBAAuB,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,cAAgB,CAAC,GAAG,MAAM,0BAA0B,EAAE,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE;YACvI,MAAM,6BAA6B,IAAI,CAAC,MAAM,CAAC,sBAAsB;YACrE,MAAM,yBAAyB,CAAC,MAAM,QAAQ,GAAG,CAAC,2BAA2B,GAAG,CAAC,CAAC,4BAA8B,WAAW,uBAAuB,CAAC,4BAA4B,EAAE,IAAI;YACrL,IAAI,CAAC,4BAA4B,GAAG,IAAI,IAAI,uBACvC,MAAM,CAAC,CAAC,cAAgB,CAAC,CAAC,aAC1B,GAAG,CAAC,CAAC;gBACN,MAAM,aAAa,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,cAAc,YAAY,IAAI;gBACpF,OAAO;oBAAC,WAAW,WAAW;oBAAE;iBAAW;YAC/C;QACJ;QACA,MAAM,4BAA4B,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,aAAe,WAAW,SAAS,GAAG;QAC1G,MAAM,qBAAqB,CAAC,MAAM,QAAQ,GAAG,CAAC,0BAA0B,GAAG,CAAC,CAAC,+BAAiC,WAAW,uBAAuB,CAAC,+BAA+B,EAAE,IAAI;QACtL,IAAI,CAAC,sBAAsB,GAAG,IAAI,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,QAAQ,YAAY;YAC/E,IAAI,CAAC,kBAAkB,CAAC,EAAE,EAAE;gBACxB,OAAO;YACX;YACA,MAAM,eAAe,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,WAAW,MAAM,EAAE,YAAY,IAAI,CAAC,OAAO;YAC3F,MAAM,kBAAkB,aAAa,4BAA4B,CAAC,kBAAkB,CAAC,EAAE,CAAC,IAAI;YAC5F,OAAO,IAAI,CAAC;gBACR,CAAC,GAAG,WAAW,WAAW,EAAE,WAAW,SAAS,EAAE,WAAW,MAAM;gBACnE;aACH;YACD,OAAO;QACX,GAAG,EAAE;IACT;IACA,oBAAoB;QAChB,IAAI,CAAC,4BAA4B,GAAG,IAAI;QACxC,IAAI,CAAC,4BAA4B,GAAG,IAAI;QACxC,IAAI,CAAC,sBAAsB,GAAG,IAAI;IACtC;IACA,MAAM,gCAAgC;QAClC,MAAM,QAAQ,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,cAAgB,IAAI,CAAC,4BAA4B,CAAC;QAChG,OAAO;IACX;IACA,MAAM,6BAA6B,WAAW,EAAE;QAC5C,MAAM,sBAAsB,MAAM,CAAC,GAAG,MAAM,sBAAsB,EAAE,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE;QAC5F,MAAM,yBAAyB,IAAI,CAAC,iCAAiC,IAAI,6BAA6B,0BAA0B;QAChI,MAAM,oBAAoB,IAAI,uBAAuB,cAAc,IAAI,CAAC,OAAO,EAAE,qBAAqB,WAAW,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU;QAChJ,kBAAkB,OAAO,CAAC,IAAI,CAAC,4BAA4B,CAAC,GAAG,CAAC;QAChE,MAAM,kBAAkB,SAAS,CAAC,CAAC;YAC/B,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,2BAA2B;YAClD,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,4BAA4B,CAAC,GAAG,CAAC,aAAa;QACnD,OAAO;IACX;IACA,MAAM,gCAAgC;QAClC,MAAM,QAAQ,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,cAAgB,IAAI,CAAC,4BAA4B,CAAC;QAChG,OAAO;IACX;IACA,MAAM,6BAA6B,WAAW,EAAE;QAC5C,MAAM,kBAAkB,MAAM,CAAC,GAAG,MAAM,sBAAsB,EAAE,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE;QACxF,MAAM,oBAAoB,IAAI,6BAA6B,0BAA0B,CAAC,cAAc,IAAI,CAAC,OAAO,EAAE,iBAAiB,WAAW,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU;QAC7K,kBAAkB,OAAO,CAAC,IAAI,CAAC,4BAA4B,CAAC,GAAG,CAAC;QAChE,MAAM,kBAAkB,SAAS,CAAC,CAAC;YAC/B,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,2BAA2B;YAClD,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,4BAA4B,CAAC,GAAG,CAAC,aAAa;QACnD,OAAO;IACX;IACA,MAAM,qBAAqB;QACvB,MAAM,QAAQ,GAAG,CAAC,IAAI,CAAC,WAAW,CAC7B,MAAM,CAAC,CAAC,aAAe,CAAC,WAAW,SAAS,CAAC,MAAM,CAAC,UAAU,SAAS,CAAC,OAAO,GAC/E,GAAG,CAAC,CAAC,aAAe,IAAI,CAAC,iBAAiB,CAAC;QAChD,OAAO;IACX;IACA,MAAM,kBAAkB,UAAU,EAAE;QAChC,MAAM,WAAW,CAAC,GAAG,WAAW,WAAW,EAAE,WAAW,SAAS,EAAE,WAAW,MAAM;QACpF,MAAM,SAAS,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,WAAW,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,UAAU,EAAE,IAAI,CAAC,OAAO;QAC3G,MAAM,yBAAyB,IAAI,CAAC,6BAA6B,IAAI,6BAA6B,0BAA0B;QAC5H,MAAM,oBAAoB,IAAI,uBAAuB,UAAU,IAAI,CAAC,OAAO,EAAE,WAAW,SAAS,EAAE,CAAC;YAChG,OAAO,OAAO,4BAA4B,CAAC;QAC/C,GAAG,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU;QAClC,MAAM,yBAAyB,IAAI,CAAC,sBAAsB,CAAC,GAAG,CAAC;QAC/D,IAAI,wBAAwB;YACxB,kBAAkB,OAAO,CAAC;QAC9B;QACA,MAAM,kBAAkB,SAAS,CAAC,CAAC;YAC/B,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,qBAAqB,WAAW,SAAS,EAAE,WAAW,MAAM,EAAE;YACrF,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,UAAU;QACrC,OAAO;IACX;IACA,MAAM,gCAAgC;QAClC,MAAM,QAAQ,GAAG,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,4BAA4B,CAAC,MAAM,IAAI,GAAG,CAAC,CAAC,oBAAsB,kBAAkB,WAAW;IACrI;IACA,MAAM,oCAAoC;QACtC,MAAM,QAAQ,GAAG,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,4BAA4B,CAAC,MAAM,IAAI,GAAG,CAAC,CAAC,oBAAsB,kBAAkB,WAAW;IACrI;IACA,MAAM,yBAAyB;QAC3B,MAAM,QAAQ,GAAG,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,MAAM,IAAI,GAAG,CAAC,CAAC,oBAAsB,kBAAkB,WAAW;IAC1H;IACA,MAAM,QAAQ;QACV,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB;QACJ;QACA,MAAM,WAAW;YAAC,IAAI,CAAC,sBAAsB,CAAC,KAAK;SAAG,CACjD,MAAM,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,4BAA4B,CAAC,MAAM,IAAI,GAAG,CAAC,CAAC,aAAe,WAAW,KAAK,KAClG,MAAM,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,4BAA4B,CAAC,MAAM,IAAI,GAAG,CAAC,CAAC,aAAe,WAAW,KAAK;QACvG,MAAM,QAAQ,GAAG,CAAC;IACtB;IACA,MAAM,cAAc;QAChB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB;QACJ;QACA,MAAM,IAAI,CAAC,sBAAsB,CAAC,WAAW;QAC7C,MAAM,IAAI,CAAC,6BAA6B;QACxC,MAAM,IAAI,CAAC,iCAAiC;QAC5C,MAAM,IAAI,CAAC,sBAAsB;QACjC,IAAI,CAAC,YAAY,GAAG;IACxB;IACA,MAAM,cAAc,WAAW,EAAE;QAC7B,IAAI,IAAI,CAAC,4BAA4B,CAAC,GAAG,CAAC,cAAc;YACpD,OAAO;QACX;QACA,MAAM,sBAAsB,IAAI,CAAC,4BAA4B,CAAC;QAC9D,MAAM,IAAI,CAAC,gBAAgB;QAC3B,OAAO;IACX;IACA,MAAM,cAAc,WAAW,EAAE;QAC7B,IAAI,IAAI,CAAC,4BAA4B,CAAC,GAAG,CAAC,cAAc;YACpD,OAAO;QACX;QACA,MAAM,sBAAsB,IAAI,CAAC,4BAA4B,CAAC;QAC9D,MAAM,IAAI,CAAC,gBAAgB;QAC3B,OAAO;IACX;IACA,MAAM,UAAU,UAAU,EAAE;QACxB,MAAM,WAAW,CAAC,GAAG,WAAW,WAAW,EAAE,WAAW,SAAS,EAAE,WAAW,MAAM;QACpF,IAAI,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,WAAW;YACtC,OAAO;QACX;QACA,IAAI,WAAW,SAAS,CAAC,MAAM,CAAC,UAAU,SAAS,CAAC,OAAO,GAAG;YAC1D,OAAO;QACX;QACA,OAAO,IAAI,CAAC,iBAAiB,CAAC;IAClC;IACA,MAAM,mBAAmB;QACrB,MAAM,cAAc,IAAI,CAAC,yBAAyB;QAClD,MAAM,oBAAoB,EAAE;QAC5B,KAAK,MAAM,cAAc,YAAa;YAClC,IAAI,CAAC,cAAc,CAAC,WAAW,IAAI,EAAE;gBACjC;YACJ;YACA,MAAM,oBAAoB,WAAW,IAAI;YACzC,MAAM,kBAAkB,kBAAkB,WAAW;YACrD,MAAM,SAAS,kBAAkB,GAAG,CAAC,MAAM;YAC3C,MAAM,WAAW,CAAC,GAAG,WAAW,WAAW,EAAE,QAAQ,WAAW,IAAI,CAAC,GAAG,CAAC,YAAY;YACrF,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,WAAW;gBACvC,kBAAkB,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC;oBAClC,WAAW;oBACX,QAAQ,WAAW,IAAI,CAAC,GAAG,CAAC,YAAY;gBAC5C;YACJ;YACA,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,iBAAiB;YACxC,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,iBAAiB;QAClD;QACA,MAAM,QAAQ,GAAG,CAAC;IACtB;IACA,MAAM,mBAAmB;QACrB,MAAM,cAAc,IAAI,CAAC,6BAA6B;QACtD,MAAM,oBAAoB,EAAE;QAC5B,KAAK,MAAM,cAAc,YAAa;YAClC,IAAI,CAAC,cAAc,CAAC,WAAW,IAAI,EAAE;gBACjC;YACJ;YACA,MAAM,oBAAoB,WAAW,IAAI;YACzC,MAAM,kBAAkB,kBAAkB,WAAW;YACrD,MAAM,SAAS,kBAAkB,MAAM;YACvC,MAAM,WAAW,CAAC,GAAG,WAAW,WAAW,EAAE,QAAQ,kBAAkB,YAAY;YACnF,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,WAAW;gBACvC,kBAAkB,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC;oBAClC,WAAW;oBACX,QAAQ,kBAAkB,YAAY;gBAC1C;YACJ;YACA,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,iBAAiB;YACxC,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,iBAAiB;QAClD;QACA,MAAM,QAAQ,GAAG,CAAC;IACtB;IACA,MAAM,wBAAwB;QAC1B,IAAI,IAAI,CAAC,qBAAqB,KAAK,QAAQ,qBAAqB,CAAC,SAAS,EAAE;YACxE;QACJ;QACA,MAAM,EAAE,iBAAiB,EAAE,OAAO,EAAE,GAAG,CAAC,GAAG,QAAQ,iCAAiC,EAAE,IAAI,CAAC,yBAAyB,IAAI,IAAI,CAAC,6BAA6B;QAC1J,KAAK,MAAM,mBAAmB,kBAAmB;YAC7C,MAAM,IAAI,CAAC,4BAA4B,CAClC,GAAG,CAAC,iBACJ,WAAW;YAChB,IAAI,IAAI,CAAC,qBAAqB,KAAK,QAAQ,qBAAqB,CAAC,OAAO,EAAE;gBACtE,IAAI,CAAC,4BAA4B,CAAC,MAAM,CAAC;YAC7C;QACJ;QACA,KAAK,MAAM,UAAU,QAAS;YAC1B,MAAM,WAAW,CAAC,GAAG,WAAW,WAAW,EAAE,OAAO,SAAS,EAAE,OAAO,MAAM;YAC5E,MAAM,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,UAAU,WAAW;YACtD,IAAI,IAAI,CAAC,qBAAqB,KAAK,QAAQ,qBAAqB,CAAC,OAAO,EAAE;gBACtE,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC;YAClC;QACJ;IACJ;IACA,qBAAqB;QACjB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,MAAM,IAAI,QAAQ,kBAAkB,CAAC;QACzC;IACJ;IACA,yBAAyB;QACrB,IAAI,CAAC,kBAAkB;QACvB,OAAO,IAAI,CAAC,sBAAsB,CAAC,WAAW;IAClD;IACA,wBAAwB,WAAW,EAAE;QACjC,IAAI,CAAC,kBAAkB;QACvB,OAAO,IAAI,CAAC,4BAA4B,CAAC,GAAG,CAAC,aAAa,WAAW;IACzE;IACA,4BAA4B;QACxB,OAAO,MAAM,IAAI,CAAC,IAAI,CAAC,4BAA4B,CAAC,MAAM,IAAI,GAAG,CAAC,CAAC,aAAe,WAAW,WAAW;IAC5G;IACA,4BAA4B,WAAW,EAAE;QACrC,IAAI,CAAC,kBAAkB;QACvB,OAAO,IAAI,CAAC,4BAA4B,CAAC,GAAG,CAAC,aAAa,WAAW;IACzE;IACA,gCAAgC;QAC5B,OAAO,MAAM,IAAI,CAAC,IAAI,CAAC,4BAA4B,CAAC,MAAM,IAAI,GAAG,CAAC,CAAC,aAAe,WAAW,WAAW;IAC5G;IACA,0BAA0B,QAAQ,EAAE;QAChC,IAAI,CAAC,kBAAkB;QACvB,IAAI,aAAa,mBAAmB;YAChC,OAAO;gBACH,MAAM,yBAAyB,uBAAuB;gBACtD,MAAM;YACV;QACJ;QACA,OAAO,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,UAAU,WAAW;IAC3D;IACA,uCAAuC,WAAW,EAAE;QAChD,MAAM,oBAAoB,IAAI,CAAC,uBAAuB,CAAC;QACvD,MAAM,SAAS,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC;QACtC,MAAM,WAAW,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC;QAC9C,IAAI,CAAC,qBAAqB,CAAC,UAAU;YACjC,OAAO;QACX;QACA,IAAI,CAAC,kBAAkB,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS;YACnD,4EAA4E;YAC5E,IAAI,CAAC,gBAAgB;QACzB;QACA,OAAO,IAAI,CAAC,yBAAyB,CAAC;IAC1C;IACA,uCAAuC,WAAW,EAAE;QAChD,MAAM,oBAAoB,IAAI,CAAC,2BAA2B,CAAC;QAC3D,MAAM,SAAS,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC;QACtC,MAAM,WAAW,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC;QAC9C,IAAI,CAAC,qBAAqB,CAAC,UAAU;YACjC,OAAO;QACX;QACA,IAAI,CAAC,kBAAkB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS;YAC/C,4EAA4E;YAC5E,IAAI,CAAC,gBAAgB;QACzB;QACA,OAAO,IAAI,CAAC,yBAAyB,CAAC;IAC1C;AACJ;AACA,QAAQ,qCAAqC,GAAG","ignoreList":[0]}},
    {"offset": {"line": 676, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/webSocketInsuranceFundStakeAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebSocketInsuranceFundStakeAccountSubscriber = void 0;\nconst types_1 = require(\"./types\");\nconst events_1 = require(\"events\");\nconst webSocketAccountSubscriber_1 = require(\"./webSocketAccountSubscriber\");\nclass WebSocketInsuranceFundStakeAccountSubscriber {\n    constructor(program, insuranceFundStakeAccountPublicKey, resubTimeoutMs, commitment) {\n        this.isSubscribed = false;\n        this.program = program;\n        this.insuranceFundStakeAccountPublicKey =\n            insuranceFundStakeAccountPublicKey;\n        this.eventEmitter = new events_1.EventEmitter();\n        this.resubTimeoutMs = resubTimeoutMs;\n        this.commitment = commitment;\n    }\n    async subscribe(insuranceFundStakeAccount) {\n        if (this.isSubscribed) {\n            return true;\n        }\n        this.insuranceFundStakeDataAccountSubscriber =\n            new webSocketAccountSubscriber_1.WebSocketAccountSubscriber('insuranceFundStake', this.program, this.insuranceFundStakeAccountPublicKey, undefined, {\n                resubTimeoutMs: this.resubTimeoutMs,\n            }, this.commitment);\n        if (insuranceFundStakeAccount) {\n            this.insuranceFundStakeDataAccountSubscriber.setData(insuranceFundStakeAccount);\n        }\n        await this.insuranceFundStakeDataAccountSubscriber.subscribe((data) => {\n            this.eventEmitter.emit('insuranceFundStakeAccountUpdate', data);\n            this.eventEmitter.emit('update');\n        });\n        this.eventEmitter.emit('update');\n        this.isSubscribed = true;\n        return true;\n    }\n    async fetch() {\n        await Promise.all([this.insuranceFundStakeDataAccountSubscriber.fetch()]);\n    }\n    async unsubscribe() {\n        if (!this.isSubscribed) {\n            return;\n        }\n        await Promise.all([\n            this.insuranceFundStakeDataAccountSubscriber.unsubscribe(),\n        ]);\n        this.isSubscribed = false;\n    }\n    assertIsSubscribed() {\n        if (!this.isSubscribed) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` before using this function');\n        }\n    }\n    getInsuranceFundStakeAccountAndSlot() {\n        this.assertIsSubscribed();\n        return this.insuranceFundStakeDataAccountSubscriber.dataAndSlot;\n    }\n    updateData(insuranceFundStake, slot) {\n        var _a;\n        const currentDataSlot = ((_a = this.insuranceFundStakeDataAccountSubscriber.dataAndSlot) === null || _a === void 0 ? void 0 : _a.slot) || 0;\n        if (currentDataSlot <= slot) {\n            this.insuranceFundStakeDataAccountSubscriber.setData(insuranceFundStake, slot);\n            this.eventEmitter.emit('insuranceFundStakeAccountUpdate', insuranceFundStake);\n            this.eventEmitter.emit('update');\n        }\n    }\n}\nexports.WebSocketInsuranceFundStakeAccountSubscriber = WebSocketInsuranceFundStakeAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,4CAA4C,GAAG,KAAK;AAC5D,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;IACF,YAAY,OAAO,EAAE,kCAAkC,EAAE,cAAc,EAAE,UAAU,CAAE;QACjF,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,kCAAkC,GACnC;QACJ,IAAI,CAAC,YAAY,GAAG,IAAI,SAAS,YAAY;QAC7C,IAAI,CAAC,cAAc,GAAG;QACtB,IAAI,CAAC,UAAU,GAAG;IACtB;IACA,MAAM,UAAU,yBAAyB,EAAE;QACvC,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,OAAO;QACX;QACA,IAAI,CAAC,uCAAuC,GACxC,IAAI,6BAA6B,0BAA0B,CAAC,sBAAsB,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,kCAAkC,EAAE,WAAW;YAChJ,gBAAgB,IAAI,CAAC,cAAc;QACvC,GAAG,IAAI,CAAC,UAAU;QACtB,IAAI,2BAA2B;YAC3B,IAAI,CAAC,uCAAuC,CAAC,OAAO,CAAC;QACzD;QACA,MAAM,IAAI,CAAC,uCAAuC,CAAC,SAAS,CAAC,CAAC;YAC1D,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,mCAAmC;YAC1D,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QACvB,IAAI,CAAC,YAAY,GAAG;QACpB,OAAO;IACX;IACA,MAAM,QAAQ;QACV,MAAM,QAAQ,GAAG,CAAC;YAAC,IAAI,CAAC,uCAAuC,CAAC,KAAK;SAAG;IAC5E;IACA,MAAM,cAAc;QAChB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB;QACJ;QACA,MAAM,QAAQ,GAAG,CAAC;YACd,IAAI,CAAC,uCAAuC,CAAC,WAAW;SAC3D;QACD,IAAI,CAAC,YAAY,GAAG;IACxB;IACA,qBAAqB;QACjB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,MAAM,IAAI,QAAQ,kBAAkB,CAAC;QACzC;IACJ;IACA,sCAAsC;QAClC,IAAI,CAAC,kBAAkB;QACvB,OAAO,IAAI,CAAC,uCAAuC,CAAC,WAAW;IACnE;IACA,WAAW,kBAAkB,EAAE,IAAI,EAAE;QACjC,IAAI;QACJ,MAAM,kBAAkB,CAAC,CAAC,KAAK,IAAI,CAAC,uCAAuC,CAAC,WAAW,MAAM,QAAQ,OAAO,KAAK,IAAI,KAAK,IAAI,GAAG,IAAI,KAAK;QAC1I,IAAI,mBAAmB,MAAM;YACzB,IAAI,CAAC,uCAAuC,CAAC,OAAO,CAAC,oBAAoB;YACzE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,mCAAmC;YAC1D,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;IACJ;AACJ;AACA,QAAQ,4CAA4C,GAAG","ignoreList":[0]}},
    {"offset": {"line": 748, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/webSocketHighLeverageModeConfigAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebSocketHighLeverageModeConfigAccountSubscriber = void 0;\nconst types_1 = require(\"./types\");\nconst events_1 = require(\"events\");\nconst webSocketAccountSubscriber_1 = require(\"./webSocketAccountSubscriber\");\nclass WebSocketHighLeverageModeConfigAccountSubscriber {\n    constructor(program, highLeverageModeConfigAccountPublicKey, resubTimeoutMs, commitment) {\n        this.isSubscribed = false;\n        this.program = program;\n        this.highLeverageModeConfigAccountPublicKey =\n            highLeverageModeConfigAccountPublicKey;\n        this.eventEmitter = new events_1.EventEmitter();\n        this.resubTimeoutMs = resubTimeoutMs;\n        this.commitment = commitment;\n    }\n    async subscribe(highLeverageModeConfigAccount) {\n        if (this.isSubscribed) {\n            return true;\n        }\n        this.highLeverageModeConfigDataAccountSubscriber =\n            new webSocketAccountSubscriber_1.WebSocketAccountSubscriber('highLeverageModeConfig', this.program, this.highLeverageModeConfigAccountPublicKey, undefined, {\n                resubTimeoutMs: this.resubTimeoutMs,\n            }, this.commitment);\n        if (highLeverageModeConfigAccount) {\n            this.highLeverageModeConfigDataAccountSubscriber.setData(highLeverageModeConfigAccount);\n        }\n        await this.highLeverageModeConfigDataAccountSubscriber.subscribe((data) => {\n            this.eventEmitter.emit('highLeverageModeConfigAccountUpdate', data);\n            this.eventEmitter.emit('update');\n        });\n        this.eventEmitter.emit('update');\n        this.isSubscribed = true;\n        return true;\n    }\n    async fetch() {\n        await Promise.all([\n            this.highLeverageModeConfigDataAccountSubscriber.fetch(),\n        ]);\n    }\n    async unsubscribe() {\n        if (!this.isSubscribed) {\n            return;\n        }\n        await Promise.all([\n            this.highLeverageModeConfigDataAccountSubscriber.unsubscribe(),\n        ]);\n        this.isSubscribed = false;\n    }\n    assertIsSubscribed() {\n        if (!this.isSubscribed) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` before using this function');\n        }\n    }\n    getHighLeverageModeConfigAccountAndSlot() {\n        this.assertIsSubscribed();\n        return this.highLeverageModeConfigDataAccountSubscriber.dataAndSlot;\n    }\n    updateData(highLeverageModeConfig, slot) {\n        var _a;\n        const currentDataSlot = ((_a = this.highLeverageModeConfigDataAccountSubscriber.dataAndSlot) === null || _a === void 0 ? void 0 : _a.slot) || 0;\n        if (currentDataSlot <= slot) {\n            this.highLeverageModeConfigDataAccountSubscriber.setData(highLeverageModeConfig, slot);\n            this.eventEmitter.emit('highLeverageModeConfigAccountUpdate', highLeverageModeConfig);\n            this.eventEmitter.emit('update');\n        }\n    }\n}\nexports.WebSocketHighLeverageModeConfigAccountSubscriber = WebSocketHighLeverageModeConfigAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,gDAAgD,GAAG,KAAK;AAChE,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;IACF,YAAY,OAAO,EAAE,sCAAsC,EAAE,cAAc,EAAE,UAAU,CAAE;QACrF,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,sCAAsC,GACvC;QACJ,IAAI,CAAC,YAAY,GAAG,IAAI,SAAS,YAAY;QAC7C,IAAI,CAAC,cAAc,GAAG;QACtB,IAAI,CAAC,UAAU,GAAG;IACtB;IACA,MAAM,UAAU,6BAA6B,EAAE;QAC3C,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,OAAO;QACX;QACA,IAAI,CAAC,2CAA2C,GAC5C,IAAI,6BAA6B,0BAA0B,CAAC,0BAA0B,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,sCAAsC,EAAE,WAAW;YACxJ,gBAAgB,IAAI,CAAC,cAAc;QACvC,GAAG,IAAI,CAAC,UAAU;QACtB,IAAI,+BAA+B;YAC/B,IAAI,CAAC,2CAA2C,CAAC,OAAO,CAAC;QAC7D;QACA,MAAM,IAAI,CAAC,2CAA2C,CAAC,SAAS,CAAC,CAAC;YAC9D,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,uCAAuC;YAC9D,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QACvB,IAAI,CAAC,YAAY,GAAG;QACpB,OAAO;IACX;IACA,MAAM,QAAQ;QACV,MAAM,QAAQ,GAAG,CAAC;YACd,IAAI,CAAC,2CAA2C,CAAC,KAAK;SACzD;IACL;IACA,MAAM,cAAc;QAChB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB;QACJ;QACA,MAAM,QAAQ,GAAG,CAAC;YACd,IAAI,CAAC,2CAA2C,CAAC,WAAW;SAC/D;QACD,IAAI,CAAC,YAAY,GAAG;IACxB;IACA,qBAAqB;QACjB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,MAAM,IAAI,QAAQ,kBAAkB,CAAC;QACzC;IACJ;IACA,0CAA0C;QACtC,IAAI,CAAC,kBAAkB;QACvB,OAAO,IAAI,CAAC,2CAA2C,CAAC,WAAW;IACvE;IACA,WAAW,sBAAsB,EAAE,IAAI,EAAE;QACrC,IAAI;QACJ,MAAM,kBAAkB,CAAC,CAAC,KAAK,IAAI,CAAC,2CAA2C,CAAC,WAAW,MAAM,QAAQ,OAAO,KAAK,IAAI,KAAK,IAAI,GAAG,IAAI,KAAK;QAC9I,IAAI,mBAAmB,MAAM;YACzB,IAAI,CAAC,2CAA2C,CAAC,OAAO,CAAC,wBAAwB;YACjF,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,uCAAuC;YAC9D,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;IACJ;AACJ;AACA,QAAQ,gDAAgD,GAAG","ignoreList":[0]}},
    {"offset": {"line": 820, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/webSocketAccountSubscriberV2.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebSocketAccountSubscriberV2 = void 0;\nconst utils_1 = require(\"./utils\");\nconst gill_1 = require(\"gill\");\nconst bs58_1 = __importDefault(require(\"bs58\"));\n/**\n * WebSocketAccountSubscriberV2\n *\n * High-level overview\n * - WebSocket-first subscriber for a single Solana account with optional\n *   polling safeguards when the WS feed goes quiet.\n * - Emits decoded updates via `onChange` and maintains the latest\n *   `{buffer, slot}` and decoded `{data, slot}` internally.\n *\n * Why polling if this is a WebSocket subscriber?\n * - Under real-world conditions, WS notifications can stall or get dropped.\n * - When `resubOpts.resubTimeoutMs` elapses without WS data, you can either:\n *   - resubscribe to the WS stream (default), or\n *   - enable `resubOpts.usePollingInsteadOfResub` to start polling this single\n *     account via RPC to check for missed changes.\n * - Polling compares the fetched buffer to the last known buffer. If different\n *   at an equal-or-later slot, it indicates a missed update and we resubscribe\n *   to WS to restore a clean stream.\n *\n * Initial fetch (on subscribe)\n * - On `subscribe()`, we do a one-time RPC `fetch()` to seed internal state and\n *   emit the latest account state, ensuring consumers start from ground truth\n *   even before WS events arrive.\n *\n * Continuous polling (opt-in)\n * - If `usePollingInsteadOfResub` is set, the inactivity timeout triggers a\n *   polling loop that periodically `fetch()`es the account and checks for\n *   changes. On change, polling stops and we resubscribe to WS.\n * - If not set (default), the inactivity timeout immediately triggers a WS\n *   resubscription (no polling loop).\n *\n * Account focus\n * - This class tracks exactly one account  the one passed to the constructor \n *   which is by definition the account the consumer cares about. The extra\n *   logic is narrowly scoped to this account to minimize overhead.\n *\n * Tuning knobs\n * - `resubOpts.resubTimeoutMs`: WS inactivity threshold before fallback.\n * - `resubOpts.usePollingInsteadOfResub`: toggle polling vs immediate resub.\n * - `resubOpts.pollingIntervalMs`: polling cadence (default 30s).\n * - `resubOpts.logResubMessages`: verbose logs for diagnostics.\n * - `commitment`: WS/RPC commitment used for reads and notifications.\n * - `decodeBufferFn`: optional custom decode; defaults to Anchor coder.\n *\n * Implementation notes\n * - Uses `gill` for both WS (`rpcSubscriptions`) and RPC (`rpc`) to match the\n *   program providers RPC endpoint. Handles base58/base64 encoded data.\n */\nclass WebSocketAccountSubscriberV2 {\n    /**\n     * Create a single-account WebSocket subscriber with optional polling fallback.\n     *\n     * @param accountName Name of the Anchor account type (used for default decode).\n     * @param program Anchor `Program` used for decoding and provider access.\n     * @param accountPublicKey Public key of the account to track.\n     * @param decodeBuffer Optional custom decode function; if omitted, uses\n     *   program coder to decode `accountName`.\n     * @param resubOpts Resubscription/polling options. See class docs.\n     * @param commitment Commitment for WS and RPC operations.\n     * @param rpcSubscriptions Optional override/injection for testing.\n     * @param rpc Optional override/injection for testing.\n     */\n    constructor(accountName, program, accountPublicKey, decodeBuffer, resubOpts, commitment, rpcSubscriptions, rpc) {\n        this.isUnsubscribing = false;\n        this.accountName = accountName;\n        this.logAccountName = `${accountName}-${accountPublicKey.toBase58()}-ws-acct-subscriber-v2`;\n        this.program = program;\n        this.accountPublicKey = accountPublicKey;\n        this.decodeBufferFn = decodeBuffer;\n        this.resubOpts = resubOpts !== null && resubOpts !== void 0 ? resubOpts : {\n            resubTimeoutMs: 30000,\n            usePollingInsteadOfResub: true,\n            logResubMessages: false,\n        };\n        if (this.resubOpts.resubTimeoutMs < 1000) {\n            console.log(`resubTimeoutMs should be at least 1000ms to avoid spamming resub ${this.logAccountName}`);\n        }\n        this.receivingData = false;\n        if (['recent', 'single', 'singleGossip', 'root', 'max'].includes(this.program.provider.opts.commitment)) {\n            console.warn(`using commitment ${this.program.provider.opts.commitment} that is not supported by gill, this may cause issues`);\n        }\n        this.commitment =\n            commitment !== null && commitment !== void 0 ? commitment : this.program.provider.opts.commitment;\n        // Initialize gill client using the same RPC URL as the program provider\n        this.rpc = rpc\n            ? rpc\n            : (() => {\n                const rpcUrl = this.program.provider.connection\n                    .rpcEndpoint;\n                const { rpc } = (0, gill_1.createSolanaClient)({\n                    urlOrMoniker: rpcUrl,\n                });\n                return rpc;\n            })();\n        this.rpcSubscriptions = rpcSubscriptions\n            ? rpcSubscriptions\n            : (() => {\n                const rpcUrl = this.program.provider.connection\n                    .rpcEndpoint;\n                const { rpcSubscriptions } = (0, gill_1.createSolanaClient)({\n                    urlOrMoniker: rpcUrl,\n                });\n                return rpcSubscriptions;\n            })();\n    }\n    async handleNotificationLoop(subscriptionPromise) {\n        const subscription = await subscriptionPromise;\n        for await (const notification of subscription) {\n            // If we're currently polling and receive a WebSocket event, stop polling\n            if (this.pollingTimeoutId) {\n                if (this.resubOpts.logResubMessages) {\n                    console.log(`[${this.logAccountName}] Received WebSocket event while polling, stopping polling`);\n                }\n                this.stopPolling();\n            }\n            this.receivingData = true;\n            clearTimeout(this.timeoutId);\n            this.handleRpcResponse(notification.context, notification.value);\n            this.setTimeout();\n        }\n    }\n    async subscribe(onChange) {\n        /**\n         * Start the WebSocket subscription and (optionally) setup inactivity\n         * fallback.\n         *\n         * Flow\n         * - If we do not have initial state, perform a one-time `fetch()` to seed\n         *   internal buffers and emit current data.\n         * - Subscribe to account notifications via WS.\n         * - If `resubOpts.resubTimeoutMs` is set, schedule an inactivity timeout.\n         *   When it fires:\n         *   - if `usePollingInsteadOfResub` is true, start polling loop;\n         *   - otherwise, resubscribe to WS immediately.\n         */\n        if (this.listenerId != null || this.isUnsubscribing) {\n            if (this.resubOpts.logResubMessages) {\n                console.log(`[${this.logAccountName}] Subscribe returning early - listenerId=${this.listenerId}, isUnsubscribing=${this.isUnsubscribing}`);\n            }\n            return;\n        }\n        this.onChange = onChange;\n        if (!this.dataAndSlot) {\n            await this.fetch();\n        }\n        // Create abort controller for proper cleanup\n        const abortController = new AbortController();\n        this.abortController = abortController;\n        this.listenerId = Math.random(); // Unique ID for logging purposes\n        if (this.resubOpts.resubTimeoutMs) {\n            this.receivingData = true;\n            this.setTimeout();\n        }\n        // Subscribe to account changes using gill's rpcSubscriptions\n        const pubkey = this.accountPublicKey.toBase58();\n        if ((0, gill_1.isAddress)(pubkey)) {\n            const subscriptionPromise = this.rpcSubscriptions\n                .accountNotifications(pubkey, {\n                commitment: this.commitment,\n                encoding: 'base64',\n            })\n                .subscribe({\n                abortSignal: abortController.signal,\n            });\n            // Start notification loop with the subscription promise\n            this.handleNotificationLoop(subscriptionPromise);\n        }\n        else {\n            throw new Error('Invalid account public key');\n        }\n    }\n    setData(data, slot) {\n        const newSlot = slot || 0;\n        if (this.dataAndSlot && this.dataAndSlot.slot > newSlot) {\n            return;\n        }\n        this.dataAndSlot = {\n            data,\n            slot,\n        };\n    }\n    setTimeout() {\n        /**\n         * Schedule inactivity handling. If WS is quiet for\n         * `resubOpts.resubTimeoutMs` and `receivingData` is true, trigger either\n         * a polling loop or a resubscribe depending on options.\n         */\n        if (!this.onChange) {\n            throw new Error('onChange callback function must be set');\n        }\n        this.timeoutId = setTimeout(async () => {\n            if (this.isUnsubscribing) {\n                // If we are in the process of unsubscribing, do not attempt to resubscribe\n                if (this.resubOpts.logResubMessages) {\n                    console.log(`[${this.logAccountName}] Timeout fired but isUnsubscribing=true, skipping resubscribe`);\n                }\n                return;\n            }\n            if (this.receivingData) {\n                if (this.resubOpts.usePollingInsteadOfResub) {\n                    // Use polling instead of resubscribing\n                    if (this.resubOpts.logResubMessages) {\n                        console.log(`[${this.logAccountName}] No ws data in ${this.resubOpts.resubTimeoutMs}ms, starting polling - listenerId=${this.listenerId}`);\n                    }\n                    this.startPolling();\n                }\n                else {\n                    // Original resubscribe behavior\n                    if (this.resubOpts.logResubMessages) {\n                        console.log(`No ws data from ${this.logAccountName} in ${this.resubOpts.resubTimeoutMs}ms, resubscribing - listenerId=${this.listenerId}, isUnsubscribing=${this.isUnsubscribing}`);\n                    }\n                    await this.unsubscribe(true);\n                    this.receivingData = false;\n                    await this.subscribe(this.onChange);\n                    if (this.resubOpts.logResubMessages) {\n                        console.log(`[${this.logAccountName}] Resubscribe completed - receivingData=${this.receivingData}, listenerId=${this.listenerId}, isUnsubscribing=${this.isUnsubscribing}`);\n                    }\n                }\n            }\n            else {\n                if (this.resubOpts.logResubMessages) {\n                    console.log(`[${this.logAccountName}] Timeout fired but receivingData=false, skipping resubscribe`);\n                }\n            }\n        }, this.resubOpts.resubTimeoutMs);\n    }\n    /**\n     * Start the polling loop (single-account).\n     * - Periodically calls `fetch()` and compares buffers to detect changes.\n     * - On detected change, stops polling and resubscribes to WS.\n     */\n    startPolling() {\n        const pollingInterval = this.resubOpts.pollingIntervalMs || 30000; // Default to 30s\n        const poll = async () => {\n            var _a, _b;\n            if (this.isUnsubscribing) {\n                return;\n            }\n            try {\n                // Store current data and buffer before polling\n                const currentBuffer = (_a = this.bufferAndSlot) === null || _a === void 0 ? void 0 : _a.buffer;\n                // Fetch latest account data\n                await this.fetch();\n                // Check if we got new data by comparing buffers\n                const newBuffer = (_b = this.bufferAndSlot) === null || _b === void 0 ? void 0 : _b.buffer;\n                const hasNewData = newBuffer && (!currentBuffer || !newBuffer.equals(currentBuffer));\n                if (hasNewData) {\n                    // New data received, stop polling and resubscribe to websocket\n                    if (this.resubOpts.logResubMessages) {\n                        console.log(`[${this.logAccountName}] Polling detected account data change, resubscribing to websocket`);\n                    }\n                    await this.unsubscribe(true);\n                    this.receivingData = false;\n                    await this.subscribe(this.onChange);\n                }\n                else {\n                    // No new data, continue polling\n                    if (this.resubOpts.logResubMessages) {\n                        console.log(`[${this.logAccountName}] Polling found no account changes, continuing to poll every ${pollingInterval}ms`);\n                    }\n                    this.pollingTimeoutId = setTimeout(poll, pollingInterval);\n                }\n            }\n            catch (error) {\n                if (this.resubOpts.logResubMessages) {\n                    console.error(`[${this.logAccountName}] Error during polling:`, error);\n                }\n                // On error, continue polling\n                this.pollingTimeoutId = setTimeout(poll, pollingInterval);\n            }\n        };\n        // Start polling immediately\n        poll();\n    }\n    stopPolling() {\n        if (this.pollingTimeoutId) {\n            clearTimeout(this.pollingTimeoutId);\n            this.pollingTimeoutId = undefined;\n        }\n    }\n    /**\n     * Fetch the current account state via RPC and process it through the same\n     * decoding and update pathway as WS notifications.\n     */\n    async fetch() {\n        // Use gill's rpc for fetching account info\n        const accountAddress = this.accountPublicKey.toBase58();\n        const rpcResponse = await this.rpc\n            .getAccountInfo(accountAddress, {\n            commitment: this.commitment,\n            encoding: 'base64',\n        })\n            .send();\n        // Convert gill response to match the expected format\n        const context = {\n            slot: Number(rpcResponse.context.slot),\n        };\n        const accountInfo = rpcResponse.value;\n        this.handleRpcResponse({ slot: BigInt(context.slot) }, accountInfo);\n    }\n    handleRpcResponse(context, accountInfo) {\n        const newSlot = context.slot;\n        let newBuffer = undefined;\n        if (accountInfo) {\n            // Extract data from gill response\n            if (accountInfo.data) {\n                // Handle different data formats from gill\n                if (Array.isArray(accountInfo.data)) {\n                    // If it's a tuple [data, encoding]\n                    const [data, encoding] = accountInfo.data;\n                    if (encoding === 'base58') {\n                        // we know encoding will be base58\n                        // Convert base58 to buffer using bs58\n                        newBuffer = Buffer.from(bs58_1.default.decode(data));\n                    }\n                    else {\n                        newBuffer = Buffer.from(data, 'base64');\n                    }\n                }\n            }\n        }\n        if (!this.bufferAndSlot) {\n            this.bufferAndSlot = {\n                buffer: newBuffer,\n                slot: Number(newSlot),\n            };\n            if (newBuffer) {\n                const account = this.decodeBuffer(newBuffer);\n                this.dataAndSlot = {\n                    data: account,\n                    slot: Number(newSlot),\n                };\n                this.onChange(account);\n            }\n            return;\n        }\n        if (Number(newSlot) < this.bufferAndSlot.slot) {\n            return;\n        }\n        const oldBuffer = this.bufferAndSlot.buffer;\n        if (newBuffer && (!oldBuffer || !newBuffer.equals(oldBuffer))) {\n            this.bufferAndSlot = {\n                buffer: newBuffer,\n                slot: Number(newSlot),\n            };\n            const account = this.decodeBuffer(newBuffer);\n            this.dataAndSlot = {\n                data: account,\n                slot: Number(newSlot),\n            };\n            this.onChange(account);\n        }\n    }\n    decodeBuffer(buffer) {\n        if (this.decodeBufferFn) {\n            return this.decodeBufferFn(buffer);\n        }\n        else {\n            return this.program.account[this.accountName].coder.accounts.decode((0, utils_1.capitalize)(this.accountName), buffer);\n        }\n    }\n    unsubscribe(onResub = false) {\n        /**\n         * Stop timers, polling, and WS subscription.\n         * - When called during a resubscribe (`onResub=true`), we preserve\n         *   `resubOpts.resubTimeoutMs` for the restarted subscription.\n         */\n        if (!onResub && this.resubOpts) {\n            this.resubOpts.resubTimeoutMs = undefined;\n        }\n        this.isUnsubscribing = true;\n        clearTimeout(this.timeoutId);\n        this.timeoutId = undefined;\n        // Stop polling if active\n        this.stopPolling();\n        // Abort the WebSocket subscription\n        if (this.abortController) {\n            this.abortController.abort('unsubscribing');\n            this.abortController = undefined;\n        }\n        this.listenerId = undefined;\n        this.isUnsubscribing = false;\n        return Promise.resolve();\n    }\n}\nexports.WebSocketAccountSubscriberV2 = WebSocketAccountSubscriberV2;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1205, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/webSocketProgramAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebSocketProgramAccountSubscriber = void 0;\nclass WebSocketProgramAccountSubscriber {\n    constructor(subscriptionName, accountDiscriminator, program, decodeBufferFn, options = {\n        filters: [],\n    }, resubOpts) {\n        var _a;\n        this.bufferAndSlotMap = new Map();\n        this.isUnsubscribing = false;\n        this.receivingData = false;\n        this.subscriptionName = subscriptionName;\n        this.accountDiscriminator = accountDiscriminator;\n        this.program = program;\n        this.decodeBuffer = decodeBufferFn;\n        this.resubOpts = resubOpts;\n        if (((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs) < 1000) {\n            console.log('resubTimeoutMs should be at least 1000ms to avoid spamming resub');\n        }\n        this.options = options;\n        this.receivingData = false;\n    }\n    async subscribe(onChange) {\n        var _a, _b;\n        if (this.listenerId != null || this.isUnsubscribing) {\n            return;\n        }\n        this.onChange = onChange;\n        this.listenerId = this.program.provider.connection.onProgramAccountChange(this.program.programId, (keyedAccountInfo, context) => {\n            var _a;\n            if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs) {\n                this.receivingData = true;\n                clearTimeout(this.timeoutId);\n                this.handleRpcResponse(context, keyedAccountInfo);\n                this.setTimeout();\n            }\n            else {\n                this.handleRpcResponse(context, keyedAccountInfo);\n            }\n        }, (_a = this.options.commitment) !== null && _a !== void 0 ? _a : this.program.provider.opts.commitment, this.options.filters);\n        if ((_b = this.resubOpts) === null || _b === void 0 ? void 0 : _b.resubTimeoutMs) {\n            this.receivingData = true;\n            this.setTimeout();\n        }\n    }\n    setTimeout() {\n        var _a;\n        if (!this.onChange) {\n            throw new Error('onChange callback function must be set');\n        }\n        this.timeoutId = setTimeout(async () => {\n            var _a, _b;\n            if (this.isUnsubscribing) {\n                // If we are in the process of unsubscribing, do not attempt to resubscribe\n                return;\n            }\n            if (this.receivingData) {\n                if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n                    console.log(`No ws data from ${this.subscriptionName} in ${(_b = this.resubOpts) === null || _b === void 0 ? void 0 : _b.resubTimeoutMs}ms, resubscribing`);\n                }\n                await this.unsubscribe(true);\n                this.receivingData = false;\n                await this.subscribe(this.onChange);\n            }\n        }, (_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs);\n    }\n    handleRpcResponse(context, keyedAccountInfo) {\n        const newSlot = context.slot;\n        let newBuffer = undefined;\n        if (keyedAccountInfo) {\n            newBuffer = keyedAccountInfo.accountInfo.data;\n        }\n        const accountId = keyedAccountInfo.accountId.toBase58();\n        const existingBufferAndSlot = this.bufferAndSlotMap.get(accountId);\n        if (!existingBufferAndSlot) {\n            if (newBuffer) {\n                this.bufferAndSlotMap.set(accountId, {\n                    buffer: newBuffer,\n                    slot: newSlot,\n                });\n                const account = this.decodeBuffer(this.accountDiscriminator, newBuffer);\n                this.onChange(keyedAccountInfo.accountId, account, context, newBuffer);\n            }\n            return;\n        }\n        if (newSlot < existingBufferAndSlot.slot) {\n            return;\n        }\n        const oldBuffer = existingBufferAndSlot.buffer;\n        if (newBuffer && (!oldBuffer || !newBuffer.equals(oldBuffer))) {\n            this.bufferAndSlotMap.set(accountId, {\n                buffer: newBuffer,\n                slot: newSlot,\n            });\n            const account = this.decodeBuffer(this.accountDiscriminator, newBuffer);\n            this.onChange(keyedAccountInfo.accountId, account, context, newBuffer);\n        }\n    }\n    unsubscribe(onResub = false) {\n        if (!onResub) {\n            this.resubOpts.resubTimeoutMs = undefined;\n        }\n        this.isUnsubscribing = true;\n        clearTimeout(this.timeoutId);\n        this.timeoutId = undefined;\n        if (this.listenerId != null) {\n            const promise = this.program.provider.connection\n                .removeAccountChangeListener(this.listenerId)\n                .then(() => {\n                this.listenerId = undefined;\n                this.isUnsubscribing = false;\n            });\n            return promise;\n        }\n        else {\n            this.isUnsubscribing = false;\n        }\n    }\n}\nexports.WebSocketProgramAccountSubscriber = WebSocketProgramAccountSubscriber;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1326, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/websocketProgramUserAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebSocketProgramUserAccountSubscriber = void 0;\nconst types_1 = require(\"./types\");\nconst events_1 = require(\"events\");\nclass WebSocketProgramUserAccountSubscriber {\n    constructor(program, userAccountPublicKey, programSubscriber) {\n        this.isSubscribed = false;\n        this.program = program;\n        this.userAccountPublicKey = userAccountPublicKey;\n        this.eventEmitter = new events_1.EventEmitter();\n        this.programSubscriber = programSubscriber;\n    }\n    async subscribe(userAccount) {\n        if (this.isSubscribed) {\n            return true;\n        }\n        if (userAccount) {\n            this.updateData(userAccount, 0);\n        }\n        this.programSubscriber.onChange = (accountId, data, context) => {\n            if (accountId.equals(this.userAccountPublicKey)) {\n                this.updateData(data, context.slot);\n                this.eventEmitter.emit('userAccountUpdate', data);\n                this.eventEmitter.emit('update');\n            }\n        };\n        this.isSubscribed = true;\n        return true;\n    }\n    async fetch() {\n        if (!this.isSubscribed) {\n            throw new types_1.NotSubscribedError('Must subscribe before fetching account updates');\n        }\n        const account = await this.program.account.user.fetch(this.userAccountPublicKey);\n        this.updateData(account, 0);\n    }\n    updateData(userAccount, slot) {\n        this.userAccountAndSlot = {\n            data: userAccount,\n            slot,\n        };\n    }\n    async unsubscribe() {\n        this.isSubscribed = false;\n    }\n    getUserAccountAndSlot() {\n        if (!this.userAccountAndSlot) {\n            throw new types_1.NotSubscribedError('Must subscribe before getting user account data');\n        }\n        return this.userAccountAndSlot;\n    }\n}\nexports.WebSocketProgramUserAccountSubscriber = WebSocketProgramUserAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,qCAAqC,GAAG,KAAK;AACrD,MAAM;AACN,MAAM;AACN,MAAM;IACF,YAAY,OAAO,EAAE,oBAAoB,EAAE,iBAAiB,CAAE;QAC1D,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,oBAAoB,GAAG;QAC5B,IAAI,CAAC,YAAY,GAAG,IAAI,SAAS,YAAY;QAC7C,IAAI,CAAC,iBAAiB,GAAG;IAC7B;IACA,MAAM,UAAU,WAAW,EAAE;QACzB,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,OAAO;QACX;QACA,IAAI,aAAa;YACb,IAAI,CAAC,UAAU,CAAC,aAAa;QACjC;QACA,IAAI,CAAC,iBAAiB,CAAC,QAAQ,GAAG,CAAC,WAAW,MAAM;YAChD,IAAI,UAAU,MAAM,CAAC,IAAI,CAAC,oBAAoB,GAAG;gBAC7C,IAAI,CAAC,UAAU,CAAC,MAAM,QAAQ,IAAI;gBAClC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,qBAAqB;gBAC5C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;YAC3B;QACJ;QACA,IAAI,CAAC,YAAY,GAAG;QACpB,OAAO;IACX;IACA,MAAM,QAAQ;QACV,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,MAAM,IAAI,QAAQ,kBAAkB,CAAC;QACzC;QACA,MAAM,UAAU,MAAM,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,oBAAoB;QAC/E,IAAI,CAAC,UAAU,CAAC,SAAS;IAC7B;IACA,WAAW,WAAW,EAAE,IAAI,EAAE;QAC1B,IAAI,CAAC,kBAAkB,GAAG;YACtB,MAAM;YACN;QACJ;IACJ;IACA,MAAM,cAAc;QAChB,IAAI,CAAC,YAAY,GAAG;IACxB;IACA,wBAAwB;QACpB,IAAI,CAAC,IAAI,CAAC,kBAAkB,EAAE;YAC1B,MAAM,IAAI,QAAQ,kBAAkB,CAAC;QACzC;QACA,OAAO,IAAI,CAAC,kBAAkB;IAClC;AACJ;AACA,QAAQ,qCAAqC,GAAG","ignoreList":[0]}},
    {"offset": {"line": 1385, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/webSocketProgramAccountsSubscriberV2.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebSocketProgramAccountsSubscriberV2 = void 0;\nconst web3_js_1 = require(\"@solana/web3.js\");\nconst gill_1 = require(\"gill\");\nconst bs58_1 = __importDefault(require(\"bs58\"));\n/**\n * WebSocketProgramAccountsSubscriberV2\n *\n * High-level overview\n * - WebSocket-first subscriber for Solana program accounts that also layers in\n *   targeted polling to detect missed updates reliably.\n * - Emits decoded account updates via the provided `onChange` callback.\n * - Designed to focus extra work on the specific accounts the consumer cares\n *   about (\"monitored accounts\") while keeping baseline WS behavior for the\n *   full program subscription.\n *\n * Why polling if this is a WebSocket subscriber?\n * - WS infra can stall, drop, or reorder notifications under network stress or\n *   provider hiccups. When that happens, critical account changes can be missed.\n * - To mitigate this, the class accepts a set of accounts (provided via constructor) to monitor\n *   and uses light polling to verify whether a WS change was missed.\n * - If polling detects a newer slot with different data than the last seen\n *   buffer, a centralized resubscription is triggered to restore a clean stream.\n *\n * Initial fetch (on subscribe)\n * - On `subscribe()`, we first perform a single batched fetch of all monitored\n *   accounts (\"initial monitor fetch\").\n * - Purpose: seed the internal `bufferAndSlotMap` and emit the latest state so\n *   consumers have up-to-date data immediately, even before WS events arrive.\n * - This step does not decide resubscription; it only establishes ground truth.\n *\n * Continuous polling (only for monitored accounts)\n * - After seeding, each monitored account is put into a monitoring cycle:\n *   1) If no WS notification for an account is observed for `pollingIntervalMs`,\n *      we enqueue it for a batched fetch (buffered for a short window).\n *   2) Once an account enters the \"currently polling\" set, a shared batch poll\n *      runs every `pollingIntervalMs` across all such accounts.\n *   3) If WS notifications resume for an account, that account is removed from\n *      the polling set and returns to passive monitoring.\n * - Polling compares the newly fetched buffer with the last stored buffer at a\n *   later slot. A difference indicates a missed update; we schedule a single\n *   resubscription (coalesced across accounts) to re-sync.\n *\n * Accounts the consumer cares about\n * - Provide accounts up-front via the constructor `accountsToMonitor`, or add\n *   them dynamically with `addAccountToMonitor()` and remove with\n *   `removeAccountFromMonitor()`.\n * - Only these accounts incur additional polling safeguards; other accounts are\n *   still processed from the WS stream normally.\n *\n * Resubscription strategy\n * - Missed updates from any monitored account are coalesced and trigger a single\n *   resubscription after a short delay. This avoids rapid churn.\n * - If `resubOpts.resubTimeoutMs` is set, an inactivity timer also performs a\n *   batch check of monitored accounts. If a missed update is found, the same\n *   centralized resubscription flow is used.\n *\n * Tuning knobs\n * - `setPollingInterval(ms)`: adjust how often monitoring/polling runs\n *   (default 30s). Shorter = faster detection, higher RPC load.\n * - Debounced immediate poll (~100ms): batches accounts added to polling right after inactivity.\n * - Batch size for `getMultipleAccounts` is limited to 100, requests are chunked\n *   and processed concurrently.\n */\nclass WebSocketProgramAccountsSubscriberV2 {\n    constructor(subscriptionName, accountDiscriminator, program, decodeBufferFn, options = {\n        filters: [],\n    }, resubOpts, accountsToMonitor // Optional list of accounts to poll\n    ) {\n        var _a;\n        this.bufferAndSlotMap = new Map();\n        this.isUnsubscribing = false;\n        this.receivingData = false;\n        // Polling logic for specific accounts\n        this.accountsToMonitor = new Set();\n        this.pollingIntervalMs = 30000; // 30 seconds\n        this.pollingTimeouts = new Map();\n        this.lastWsNotificationTime = new Map(); // Track last WS notification time per account\n        this.accountsCurrentlyPolling = new Set(); // Track which accounts are being polled\n        this.debouncedImmediatePollMs = 100; // configurable short window\n        // Centralized resubscription handling\n        this.missedChangeDetected = false; // Flag to track if any missed change was detected\n        this.accountsWithMissedUpdates = new Set(); // Track which accounts had missed updates\n        this.subscriptionName = subscriptionName;\n        this.accountDiscriminator = accountDiscriminator;\n        this.program = program;\n        this.decodeBuffer = decodeBufferFn;\n        this.resubOpts = resubOpts !== null && resubOpts !== void 0 ? resubOpts : {\n            resubTimeoutMs: 30000,\n            usePollingInsteadOfResub: true,\n            logResubMessages: false,\n        };\n        if (((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs) < 1000) {\n            console.log('resubTimeoutMs should be at least 1000ms to avoid spamming resub');\n        }\n        this.options = options;\n        this.receivingData = false;\n        // Initialize accounts to monitor\n        if (accountsToMonitor) {\n            accountsToMonitor.forEach((account) => {\n                this.accountsToMonitor.add(account.toBase58());\n            });\n        }\n        // Initialize gill client using the same RPC URL as the program provider\n        const rpcUrl = this.program.provider.connection\n            .rpcEndpoint;\n        const { rpc, rpcSubscriptions } = (0, gill_1.createSolanaClient)({\n            urlOrMoniker: rpcUrl,\n        });\n        this.rpc = rpc;\n        this.rpcSubscriptions = rpcSubscriptions;\n    }\n    async handleNotificationLoop(notificationPromise) {\n        var _a;\n        try {\n            const subscriptionIterable = await notificationPromise;\n            for await (const notification of subscriptionIterable) {\n                try {\n                    if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs) {\n                        this.receivingData = true;\n                        clearTimeout(this.timeoutId);\n                        this.handleRpcResponse(notification.context, notification.value.pubkey, notification.value.account.data);\n                        this.setTimeout();\n                    }\n                    else {\n                        this.handleRpcResponse(notification.context, notification.value.pubkey, notification.value.account.data);\n                    }\n                }\n                catch (error) {\n                    console.error(`Error handling RPC response for pubkey ${notification.value.pubkey}:`, error);\n                }\n            }\n        }\n        catch (error) {\n            console.error(`[${this.subscriptionName}] Error in notification loop:`, error);\n        }\n    }\n    async subscribe(onChange) {\n        var _a, _b;\n        /**\n         * Start the WebSocket subscription and initialize polling safeguards.\n         *\n         * Flow\n         * - Seeds all monitored accounts with a single batched RPC fetch and emits\n         *   their current state.\n         * - Subscribes to program notifications via WS using gill.\n         * - If `resubOpts.resubTimeoutMs` is set, starts an inactivity timer that\n         *   batch-checks monitored accounts when WS goes quiet.\n         * - Begins monitoring for accounts that may need polling when WS\n         *   notifications are not observed within `pollingIntervalMs`.\n         *\n         * @param onChange Callback invoked with decoded account data when an update\n         * is detected (via WS or batch RPC fetch).\n         */\n        const startTime = performance.now();\n        if (this.listenerId != null || this.isUnsubscribing) {\n            return;\n        }\n        if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n            console.log(`[${this.subscriptionName}] initializing subscription. This many monitored accounts: ${this.accountsToMonitor.size}`);\n        }\n        this.onChange = onChange;\n        // initial fetch of monitored data - only fetch and populate, don't check for missed changes\n        await this.fetchAndPopulateAllMonitoredAccounts();\n        // Create abort controller for proper cleanup\n        const abortController = new AbortController();\n        this.abortController = abortController;\n        this.listenerId = Math.random(); // Unique ID for logging purposes\n        if ((_b = this.resubOpts) === null || _b === void 0 ? void 0 : _b.resubTimeoutMs) {\n            this.receivingData = true;\n            this.setTimeout();\n        }\n        // Subscribe to program account changes using gill's rpcSubscriptions\n        const programId = this.program.programId.toBase58();\n        if ((0, gill_1.isAddress)(programId)) {\n            const subscriptionPromise = this.rpcSubscriptions\n                .programNotifications(programId, {\n                commitment: this.options.commitment,\n                encoding: 'base64',\n                filters: this.options.filters.map((filter) => {\n                    // Convert filter bytes from base58 to base64 if needed\n                    let bytes = filter.memcmp.bytes;\n                    if (typeof bytes === 'string' &&\n                        /^[1-9A-HJ-NP-Za-km-z]+$/.test(bytes)) {\n                        // Looks like base58 - convert to base64\n                        const decoded = bs58_1.default.decode(bytes);\n                        bytes = Buffer.from(decoded).toString('base64');\n                    }\n                    return {\n                        memcmp: {\n                            offset: BigInt(filter.memcmp.offset),\n                            bytes: bytes,\n                            encoding: 'base64',\n                        },\n                    };\n                }),\n            })\n                .subscribe({\n                abortSignal: abortController.signal,\n            });\n            // Start notification loop without awaiting\n            this.handleNotificationLoop(subscriptionPromise);\n            // Start monitoring for accounts that may need polling if no WS event is received\n            this.startMonitoringForAccounts();\n        }\n        const endTime = performance.now();\n        console.log(`[PROFILING] ${this.subscriptionName}.subscribe() completed in ${endTime - startTime}ms`);\n    }\n    setTimeout() {\n        var _a;\n        if (!this.onChange) {\n            throw new Error('onChange callback function must be set');\n        }\n        this.timeoutId = setTimeout(async () => {\n            var _a, _b;\n            if (this.isUnsubscribing) {\n                // If we are in the process of unsubscribing, do not attempt to resubscribe\n                return;\n            }\n            if (this.receivingData) {\n                if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n                    console.log(`No ws data from ${this.subscriptionName} in ${(_b = this.resubOpts) === null || _b === void 0 ? void 0 : _b.resubTimeoutMs}ms, checking for missed changes`);\n                }\n                // Check for missed changes in monitored accounts\n                const missedChangeDetected = await this.fetchAllMonitoredAccounts();\n                if (missedChangeDetected) {\n                    // Signal missed change with a generic identifier since we don't have specific account IDs from this context\n                    this.signalMissedChange('timeout-check');\n                }\n                else {\n                    // No missed changes, continue monitoring\n                    this.receivingData = false;\n                    this.setTimeout();\n                }\n            }\n        }, (_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs);\n    }\n    handleRpcResponse(context, accountId, accountInfo) {\n        const newSlot = Number(context.slot);\n        let newBuffer = undefined;\n        if (accountInfo) {\n            // Handle different data formats from gill\n            if (Array.isArray(accountInfo)) {\n                // If it's a tuple [data, encoding]\n                const [data, encoding] = accountInfo;\n                if (encoding === 'base58') {\n                    // Convert base58 to buffer using bs58\n                    newBuffer = Buffer.from(bs58_1.default.decode(data));\n                }\n                else {\n                    newBuffer = Buffer.from(data, 'base64');\n                }\n            }\n        }\n        const accountIdString = accountId.toString();\n        const existingBufferAndSlot = this.bufferAndSlotMap.get(accountIdString);\n        // Track WebSocket notification time for this account\n        this.lastWsNotificationTime.set(accountIdString, Date.now());\n        // If this account was being polled, stop polling it if the buffer has changed\n        if (this.accountsCurrentlyPolling.has(accountIdString) &&\n            !(existingBufferAndSlot === null || existingBufferAndSlot === void 0 ? void 0 : existingBufferAndSlot.buffer.equals(newBuffer))) {\n            this.accountsCurrentlyPolling.delete(accountIdString);\n            // If no more accounts are being polled, stop batch polling\n            if (this.accountsCurrentlyPolling.size === 0 &&\n                this.batchPollingTimeout) {\n                clearTimeout(this.batchPollingTimeout);\n                this.batchPollingTimeout = undefined;\n            }\n        }\n        if (!existingBufferAndSlot) {\n            if (newBuffer) {\n                this.updateBufferAndHandleChange(newBuffer, newSlot, accountIdString);\n            }\n            return;\n        }\n        if (newSlot < existingBufferAndSlot.slot) {\n            return;\n        }\n        const oldBuffer = existingBufferAndSlot.buffer;\n        if (newBuffer && (!oldBuffer || !newBuffer.equals(oldBuffer))) {\n            this.updateBufferAndHandleChange(newBuffer, newSlot, accountIdString);\n        }\n    }\n    startMonitoringForAccounts() {\n        // Clear any existing polling timeouts\n        this.clearPollingTimeouts();\n        // Start monitoring for each account in the accountsToMonitor set\n        this.accountsToMonitor.forEach((accountIdString) => {\n            this.startMonitoringForAccount(accountIdString);\n        });\n    }\n    startMonitoringForAccount(accountIdString) {\n        // Clear existing timeout for this account\n        const existingTimeout = this.pollingTimeouts.get(accountIdString);\n        if (existingTimeout) {\n            clearTimeout(existingTimeout);\n        }\n        // Set up monitoring timeout - only start polling if no WS notification in 30s\n        const timeoutId = setTimeout(async () => {\n            var _a;\n            // Check if we've received a WS notification for this account recently\n            const lastNotificationTime = this.lastWsNotificationTime.get(accountIdString) || 0;\n            const currentTime = Date.now();\n            if (!lastNotificationTime ||\n                currentTime - lastNotificationTime >= this.pollingIntervalMs) {\n                if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n                    console.debug(`[${this.subscriptionName}] No recent WS notification for ${accountIdString}, adding to polling set`);\n                }\n                // No recent WS notification: add to polling and schedule debounced poll\n                this.accountsCurrentlyPolling.add(accountIdString);\n                this.scheduleDebouncedImmediatePoll();\n            }\n            else {\n                // We received a WS notification recently, continue monitoring\n                this.startMonitoringForAccount(accountIdString);\n            }\n        }, this.pollingIntervalMs);\n        this.pollingTimeouts.set(accountIdString, timeoutId);\n    }\n    scheduleDebouncedImmediatePoll() {\n        if (this.debouncedImmediatePollTimeout) {\n            clearTimeout(this.debouncedImmediatePollTimeout);\n        }\n        this.debouncedImmediatePollTimeout = setTimeout(async () => {\n            var _a;\n            try {\n                await this.pollAllAccounts();\n                // After the immediate poll, ensure continuous batch polling is active\n                if (!this.batchPollingTimeout &&\n                    this.accountsCurrentlyPolling.size > 0) {\n                    this.startBatchPolling();\n                }\n            }\n            catch (e) {\n                if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n                    console.log(`[${this.subscriptionName}] Error during debounced immediate poll:`, e);\n                }\n            }\n        }, this.debouncedImmediatePollMs);\n    }\n    startBatchPolling() {\n        var _a;\n        if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n            console.debug(`[${this.subscriptionName}] Scheduling batch polling`);\n        }\n        // Clear existing batch polling timeout\n        if (this.batchPollingTimeout) {\n            clearTimeout(this.batchPollingTimeout);\n        }\n        // Set up batch polling interval\n        this.batchPollingTimeout = setTimeout(async () => {\n            await this.pollAllAccounts();\n            // Schedule next batch poll\n            this.startBatchPolling();\n        }, this.pollingIntervalMs);\n    }\n    async pollAllAccounts() {\n        var _a, _b;\n        try {\n            // Get all accounts currently being polled\n            const accountsToPoll = Array.from(this.accountsCurrentlyPolling);\n            if (accountsToPoll.length === 0) {\n                return;\n            }\n            if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n                console.debug(`[${this.subscriptionName}] Polling all accounts`, accountsToPoll.length, 'accounts');\n            }\n            // Use the shared batch fetch method\n            await this.fetchAccountsBatch(accountsToPoll);\n        }\n        catch (error) {\n            if ((_b = this.resubOpts) === null || _b === void 0 ? void 0 : _b.logResubMessages) {\n                console.log(`[${this.subscriptionName}] Error batch polling accounts:`, error);\n            }\n        }\n    }\n    /**\n     * Fetches and populates all monitored accounts data without checking for missed changes\n     * This is used during initial subscription to populate data\n     */\n    async fetchAndPopulateAllMonitoredAccounts() {\n        var _a;\n        try {\n            // Get all accounts currently being polled\n            const accountsToMonitor = Array.from(this.accountsToMonitor);\n            if (accountsToMonitor.length === 0) {\n                return;\n            }\n            // Fetch all accounts in a single batch request\n            const accountAddresses = accountsToMonitor.map((accountId) => accountId);\n            const rpcResponse = await this.rpc\n                .getMultipleAccounts(accountAddresses, {\n                commitment: this.options.commitment,\n                encoding: 'base64',\n            })\n                .send();\n            const currentSlot = Number(rpcResponse.context.slot);\n            // Process each account response\n            for (let i = 0; i < accountsToMonitor.length; i++) {\n                const accountIdString = accountsToMonitor[i];\n                const accountInfo = rpcResponse.value[i];\n                if (!accountInfo) {\n                    continue;\n                }\n                const existingBufferAndSlot = this.bufferAndSlotMap.get(accountIdString);\n                if (!existingBufferAndSlot) {\n                    // Account not in our map yet, add it\n                    let newBuffer = undefined;\n                    if (accountInfo) {\n                        if (Array.isArray(accountInfo.data)) {\n                            const [data, encoding] = accountInfo.data;\n                            newBuffer = Buffer.from(data, encoding);\n                        }\n                    }\n                    if (newBuffer) {\n                        this.updateBufferAndHandleChange(newBuffer, currentSlot, accountIdString);\n                    }\n                    continue;\n                }\n                // For initial population, just update the slot if we have newer data\n                if (currentSlot > existingBufferAndSlot.slot) {\n                    let newBuffer = undefined;\n                    if (accountInfo.data) {\n                        if (Array.isArray(accountInfo.data)) {\n                            const [data, encoding] = accountInfo.data;\n                            if (encoding === 'base58') {\n                                newBuffer = Buffer.from(bs58_1.default.decode(data));\n                            }\n                            else {\n                                newBuffer = Buffer.from(data, 'base64');\n                            }\n                        }\n                    }\n                    // Update with newer data if available\n                    if (newBuffer) {\n                        this.updateBufferAndHandleChange(newBuffer, currentSlot, accountIdString);\n                    }\n                }\n            }\n        }\n        catch (error) {\n            if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n                console.log(`[${this.subscriptionName}] Error fetching and populating monitored accounts:`, error);\n            }\n        }\n    }\n    /**\n     * Fetches all monitored accounts and checks for missed changes\n     * Returns true if a missed change was detected and resubscription is needed\n     */\n    async fetchAllMonitoredAccounts() {\n        var _a, _b;\n        try {\n            // Get all accounts currently being polled\n            const accountsToMonitor = Array.from(this.accountsToMonitor);\n            if (accountsToMonitor.length === 0) {\n                return false;\n            }\n            // Fetch all accounts in a single batch request\n            const accountAddresses = accountsToMonitor.map((accountId) => accountId);\n            const rpcResponse = await this.rpc\n                .getMultipleAccounts(accountAddresses, {\n                commitment: this.options.commitment,\n                encoding: 'base64',\n            })\n                .send();\n            const currentSlot = Number(rpcResponse.context.slot);\n            // Process each account response\n            for (let i = 0; i < accountsToMonitor.length; i++) {\n                const accountIdString = accountsToMonitor[i];\n                const accountInfo = rpcResponse.value[i];\n                if (!accountInfo) {\n                    continue;\n                }\n                const existingBufferAndSlot = this.bufferAndSlotMap.get(accountIdString);\n                if (!existingBufferAndSlot) {\n                    // Account not in our map yet, add it\n                    let newBuffer = undefined;\n                    if (accountInfo.data) {\n                        if (Array.isArray(accountInfo.data)) {\n                            const [data, encoding] = accountInfo.data;\n                            newBuffer = Buffer.from(data, encoding);\n                        }\n                    }\n                    if (newBuffer) {\n                        this.updateBufferAndHandleChange(newBuffer, currentSlot, accountIdString);\n                    }\n                    continue;\n                }\n                // Check if we missed an update\n                if (currentSlot > existingBufferAndSlot.slot) {\n                    let newBuffer = undefined;\n                    if (accountInfo.data) {\n                        if (Array.isArray(accountInfo.data)) {\n                            const [data, encoding] = accountInfo.data;\n                            if (encoding === 'base58') {\n                                newBuffer = Buffer.from(bs58_1.default.decode(data));\n                            }\n                            else {\n                                newBuffer = Buffer.from(data, 'base64');\n                            }\n                        }\n                    }\n                    // Check if buffer has changed\n                    if (newBuffer &&\n                        (!existingBufferAndSlot.buffer ||\n                            !newBuffer.equals(existingBufferAndSlot.buffer))) {\n                        if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n                            console.log(`[${this.subscriptionName}] Batch polling detected missed update for account ${accountIdString}, resubscribing`);\n                        }\n                        // We missed an update, return true to indicate resubscription is needed\n                        return true;\n                    }\n                }\n            }\n            // No missed changes detected\n            return false;\n        }\n        catch (error) {\n            if ((_b = this.resubOpts) === null || _b === void 0 ? void 0 : _b.logResubMessages) {\n                console.log(`[${this.subscriptionName}] Error batch polling accounts:`, error);\n            }\n            return false;\n        }\n    }\n    async fetchAccountsBatch(accountIds) {\n        var _a;\n        try {\n            // Chunk account IDs into groups of 100 (getMultipleAccounts limit)\n            const chunkSize = 100;\n            const chunks = [];\n            for (let i = 0; i < accountIds.length; i += chunkSize) {\n                chunks.push(accountIds.slice(i, i + chunkSize));\n            }\n            // Process all chunks concurrently\n            await Promise.all(chunks.map(async (chunk) => {\n                var _a;\n                const accountAddresses = chunk.map((accountId) => accountId);\n                const rpcResponse = await this.rpc\n                    .getMultipleAccounts(accountAddresses, {\n                    commitment: this.options.commitment,\n                    encoding: 'base64',\n                })\n                    .send();\n                const currentSlot = Number(rpcResponse.context.slot);\n                // Process each account response in this chunk\n                for (let i = 0; i < chunk.length; i++) {\n                    const accountIdString = chunk[i];\n                    const accountInfo = rpcResponse.value[i];\n                    if (!accountInfo) {\n                        continue;\n                    }\n                    const existingBufferAndSlot = this.bufferAndSlotMap.get(accountIdString);\n                    if (!existingBufferAndSlot) {\n                        // Account not in our map yet, add it\n                        let newBuffer = undefined;\n                        if (accountInfo.data) {\n                            if (Array.isArray(accountInfo.data)) {\n                                const [data, encoding] = accountInfo.data;\n                                newBuffer = Buffer.from(data, encoding);\n                            }\n                        }\n                        if (newBuffer) {\n                            this.updateBufferAndHandleChange(newBuffer, currentSlot, accountIdString);\n                        }\n                        continue;\n                    }\n                    // Check if we missed an update\n                    if (currentSlot > existingBufferAndSlot.slot) {\n                        let newBuffer = undefined;\n                        if (accountInfo.data) {\n                            if (Array.isArray(accountInfo.data)) {\n                                const [data, encoding] = accountInfo.data;\n                                if (encoding === 'base58') {\n                                    newBuffer = Buffer.from(bs58_1.default.decode(data));\n                                }\n                                else {\n                                    newBuffer = Buffer.from(data, 'base64');\n                                }\n                            }\n                        }\n                        // Check if buffer has changed\n                        if (newBuffer &&\n                            (!existingBufferAndSlot.buffer ||\n                                !newBuffer.equals(existingBufferAndSlot.buffer))) {\n                            if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n                                console.log(`[${this.subscriptionName}] Batch polling detected missed update for account ${accountIdString}, signaling resubscription`);\n                            }\n                            // Signal missed change instead of immediately resubscribing\n                            this.signalMissedChange(accountIdString);\n                            return;\n                        }\n                    }\n                }\n            }));\n        }\n        catch (error) {\n            if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n                console.log(`[${this.subscriptionName}] Error fetching accounts batch:`, error);\n            }\n        }\n    }\n    clearPollingTimeouts() {\n        this.pollingTimeouts.forEach((timeoutId) => {\n            clearTimeout(timeoutId);\n        });\n        this.pollingTimeouts.clear();\n        // Clear batch polling timeout\n        if (this.batchPollingTimeout) {\n            clearTimeout(this.batchPollingTimeout);\n            this.batchPollingTimeout = undefined;\n        }\n        // Clear initial fetch timeout\n        // if (this.initialFetchTimeout) {\n        // \tclearTimeout(this.initialFetchTimeout);\n        // \tthis.initialFetchTimeout = undefined;\n        // }\n        // Clear resubscription timeout\n        if (this.resubscriptionTimeout) {\n            clearTimeout(this.resubscriptionTimeout);\n            this.resubscriptionTimeout = undefined;\n        }\n        // Clear accounts currently polling\n        this.accountsCurrentlyPolling.clear();\n        // Clear accounts pending initial monitor fetch\n        // this.accountsPendingInitialMonitorFetch.clear();\n        // Reset missed change flag and clear accounts with missed updates\n        this.missedChangeDetected = false;\n        this.accountsWithMissedUpdates.clear();\n    }\n    /**\n     * Centralized resubscription handler that only resubscribes once after checking all accounts\n     */\n    async handleResubscription() {\n        var _a;\n        if (this.missedChangeDetected) {\n            if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n                console.log(`[${this.subscriptionName}] Missed change detected for ${this.accountsWithMissedUpdates.size} accounts: ${Array.from(this.accountsWithMissedUpdates).join(', ')}, resubscribing`);\n            }\n            await this.unsubscribe(true);\n            this.receivingData = false;\n            await this.subscribe(this.onChange);\n            this.missedChangeDetected = false;\n            this.accountsWithMissedUpdates.clear();\n        }\n    }\n    /**\n     * Signal that a missed change was detected and schedule resubscription\n     */\n    signalMissedChange(accountIdString) {\n        if (!this.missedChangeDetected) {\n            this.missedChangeDetected = true;\n            this.accountsWithMissedUpdates.add(accountIdString);\n            // Clear any existing resubscription timeout\n            if (this.resubscriptionTimeout) {\n                clearTimeout(this.resubscriptionTimeout);\n            }\n            // Schedule resubscription after a short delay to allow for batch processing\n            this.resubscriptionTimeout = setTimeout(async () => {\n                await this.handleResubscription();\n            }, 100); // 100ms delay to allow for batch processing\n        }\n        else {\n            // If already detected, just add the account to the set\n            this.accountsWithMissedUpdates.add(accountIdString);\n        }\n    }\n    unsubscribe(onResub = false) {\n        if (!onResub) {\n            this.resubOpts.resubTimeoutMs = undefined;\n        }\n        this.isUnsubscribing = true;\n        clearTimeout(this.timeoutId);\n        this.timeoutId = undefined;\n        // Clear polling timeouts\n        this.clearPollingTimeouts();\n        // Abort the WebSocket subscription\n        if (this.abortController) {\n            this.abortController.abort('unsubscribing');\n            this.abortController = undefined;\n        }\n        this.listenerId = undefined;\n        this.isUnsubscribing = false;\n        return Promise.resolve();\n    }\n    // Method to add accounts to the polling list\n    /**\n     * Add an account to the monitored set.\n     * - Monitored accounts are subject to initial fetch and periodic batch polls\n     *   if WS notifications are not observed within `pollingIntervalMs`.\n     */\n    addAccountToMonitor(accountId) {\n        const accountIdString = accountId.toBase58();\n        this.accountsToMonitor.add(accountIdString);\n        // If already subscribed, start monitoring for this account\n        if (this.listenerId != null && !this.isUnsubscribing) {\n            this.startMonitoringForAccount(accountIdString);\n        }\n    }\n    // Method to remove accounts from the polling list\n    removeAccountFromMonitor(accountId) {\n        const accountIdString = accountId.toBase58();\n        this.accountsToMonitor.delete(accountIdString);\n        // Clear monitoring timeout for this account\n        const timeoutId = this.pollingTimeouts.get(accountIdString);\n        if (timeoutId) {\n            clearTimeout(timeoutId);\n            this.pollingTimeouts.delete(accountIdString);\n        }\n        // Remove from currently polling set if it was being polled\n        this.accountsCurrentlyPolling.delete(accountIdString);\n        // If no more accounts are being polled, stop batch polling\n        if (this.accountsCurrentlyPolling.size === 0 && this.batchPollingTimeout) {\n            clearTimeout(this.batchPollingTimeout);\n            this.batchPollingTimeout = undefined;\n        }\n    }\n    // Method to set polling interval\n    /**\n     * Set the monitoring/polling interval for monitored accounts.\n     * Shorter intervals detect missed updates sooner but increase RPC load.\n     */\n    setPollingInterval(intervalMs) {\n        this.pollingIntervalMs = intervalMs;\n        // Restart monitoring with new interval if already subscribed\n        if (this.listenerId != null && !this.isUnsubscribing) {\n            this.startMonitoringForAccounts();\n        }\n    }\n    updateBufferAndHandleChange(newBuffer, newSlot, accountIdString) {\n        this.bufferAndSlotMap.set(accountIdString, {\n            buffer: newBuffer,\n            slot: newSlot,\n        });\n        const account = this.decodeBuffer(this.accountDiscriminator, newBuffer);\n        const accountIdPubkey = new web3_js_1.PublicKey(accountIdString);\n        this.onChange(accountIdPubkey, account, { slot: newSlot }, newBuffer);\n    }\n}\nexports.WebSocketProgramAccountsSubscriberV2 = WebSocketProgramAccountsSubscriberV2;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 2097, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/webSocketDriftClientAccountSubscriberV2.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebSocketDriftClientAccountSubscriberV2 = void 0;\nconst types_1 = require(\"./types\");\nconst types_2 = require(\"../types\");\nconst events_1 = require(\"events\");\nconst pda_1 = require(\"../addresses/pda\");\nconst web3_js_1 = require(\"@solana/web3.js\");\nconst gill_1 = require(\"gill\");\nconst oracleClientCache_1 = require(\"../oracles/oracleClientCache\");\nconst quoteAssetOracleClient_1 = require(\"../oracles/quoteAssetOracleClient\");\nconst config_1 = require(\"../config\");\nconst utils_1 = require(\"./utils\");\nconst oracleId_1 = require(\"../oracles/oracleId\");\nconst types_3 = require(\"../types\");\nconst memcmp_1 = require(\"../memcmp\");\nconst webSocketProgramAccountsSubscriberV2_1 = require(\"./webSocketProgramAccountsSubscriberV2\");\nconst webSocketAccountSubscriberV2_1 = require(\"./webSocketAccountSubscriberV2\");\nconst ORACLE_DEFAULT_ID = (0, oracleId_1.getOracleId)(web3_js_1.PublicKey.default, types_3.OracleSource.QUOTE_ASSET);\nclass WebSocketDriftClientAccountSubscriberV2 {\n    constructor(program, perpMarketIndexes, spotMarketIndexes, oracleInfos, shouldFindAllMarketsAndOracles, delistedMarketSetting, resubOpts, commitment, skipInitialData) {\n        this.oracleClientCache = new oracleClientCache_1.OracleClientCache();\n        this.skipInitialData = true;\n        this.perpMarketAccountLatestData = new Map();\n        this.spotMarketAccountLatestData = new Map();\n        this.perpOracleMap = new Map();\n        this.perpOracleStringMap = new Map();\n        this.spotOracleMap = new Map();\n        this.spotOracleStringMap = new Map();\n        this.oracleSubscribers = new Map();\n        this.isSubscribing = false;\n        this.chunks = (array, size) => {\n            const result = [];\n            for (let i = 0; i < array.length; i += size) {\n                result.push(array.slice(i, i + size));\n            }\n            return result;\n        };\n        this.isSubscribed = false;\n        this.program = program;\n        this.eventEmitter = new events_1.EventEmitter();\n        this.perpMarketIndexes = perpMarketIndexes;\n        this.spotMarketIndexes = spotMarketIndexes;\n        this.oracleInfos = oracleInfos;\n        this.shouldFindAllMarketsAndOracles = shouldFindAllMarketsAndOracles;\n        this.delistedMarketSetting = delistedMarketSetting;\n        this.resubOpts = resubOpts;\n        this.commitment = commitment;\n        this.skipInitialData = skipInitialData !== null && skipInitialData !== void 0 ? skipInitialData : false;\n        const { rpc, rpcSubscriptions } = (0, gill_1.createSolanaClient)({\n            urlOrMoniker: this.program.provider.connection.rpcEndpoint,\n        });\n        this.rpc = rpc;\n        this.rpcSubscriptions = rpcSubscriptions;\n    }\n    async subscribe() {\n        try {\n            const startTime = performance.now();\n            if (this.isSubscribed) {\n                console.log(`[PROFILING] WebSocketDriftClientAccountSubscriberV2.subscribe() skipped - already subscribed`);\n                return true;\n            }\n            if (this.isSubscribing) {\n                console.log(`[PROFILING] WebSocketDriftClientAccountSubscriberV2.subscribe() waiting for existing subscription`);\n                return await this.subscriptionPromise;\n            }\n            this.isSubscribing = true;\n            // Initialize subscriptionPromiseResolver to a no-op function\n            this.subscriptionPromiseResolver = () => { };\n            this.subscriptionPromise = new Promise((res) => {\n                this.subscriptionPromiseResolver = res;\n            });\n            const [perpMarketAccountPubkeys, spotMarketAccountPubkeys] = await Promise.all([\n                Promise.all(this.perpMarketIndexes.map((marketIndex) => (0, pda_1.getPerpMarketPublicKey)(this.program.programId, marketIndex))),\n                Promise.all(this.spotMarketIndexes.map((marketIndex) => (0, pda_1.getSpotMarketPublicKey)(this.program.programId, marketIndex))),\n            ]);\n            // Profile findAllMarketsAndOracles if needed\n            let findAllMarketsDuration = 0;\n            if (this.shouldFindAllMarketsAndOracles) {\n                const findAllMarketsStartTime = performance.now();\n                const { perpMarketIndexes, perpMarketAccounts, spotMarketIndexes, spotMarketAccounts, oracleInfos, } = await (0, config_1.findAllMarketAndOracles)(this.program);\n                this.perpMarketIndexes = perpMarketIndexes;\n                this.spotMarketIndexes = spotMarketIndexes;\n                this.oracleInfos = oracleInfos;\n                // front run and set the initial data here to save extra gma call in set initial data\n                this.initialPerpMarketAccountData = new Map(perpMarketAccounts.map((market) => [market.marketIndex, market]));\n                this.initialSpotMarketAccountData = new Map(spotMarketAccounts.map((market) => [market.marketIndex, market]));\n                const findAllMarketsEndTime = performance.now();\n                findAllMarketsDuration =\n                    findAllMarketsEndTime - findAllMarketsStartTime;\n                console.log(`[PROFILING] findAllMarketAndOracles completed in ${findAllMarketsDuration.toFixed(2)}ms (${perpMarketAccounts.length} perp markets, ${spotMarketAccounts.length} spot markets)`);\n            }\n            // Create subscribers\n            this.perpMarketAllAccountsSubscriber =\n                new webSocketProgramAccountsSubscriberV2_1.WebSocketProgramAccountsSubscriberV2('PerpMarketAccountsSubscriber', 'PerpMarket', this.program, this.program.account.perpMarket.coder.accounts.decodeUnchecked.bind(this.program.account.perpMarket.coder.accounts), {\n                    filters: [(0, memcmp_1.getPerpMarketAccountsFilter)()],\n                    commitment: this.commitment,\n                }, this.resubOpts, perpMarketAccountPubkeys // because we pass these in, it will monitor these accounts and fetch them right away\n                );\n            this.spotMarketAllAccountsSubscriber =\n                new webSocketProgramAccountsSubscriberV2_1.WebSocketProgramAccountsSubscriberV2('SpotMarketAccountsSubscriber', 'SpotMarket', this.program, this.program.account.spotMarket.coder.accounts.decodeUnchecked.bind(this.program.account.spotMarket.coder.accounts), {\n                    filters: [(0, memcmp_1.getSpotMarketAccountsFilter)()],\n                    commitment: this.commitment,\n                }, this.resubOpts, spotMarketAccountPubkeys // because we pass these in, it will monitor these accounts and fetch them right away\n                );\n            // Run all subscriptions in parallel\n            await Promise.all([\n                // Perp market subscription\n                this.perpMarketAllAccountsSubscriber.subscribe((_accountId, data, context, _buffer) => {\n                    if (this.delistedMarketSetting !== types_1.DelistedMarketSetting.Subscribe &&\n                        (0, types_2.isVariant)(data.status, 'delisted')) {\n                        return;\n                    }\n                    this.perpMarketAccountLatestData.set(data.marketIndex, {\n                        data,\n                        slot: context.slot,\n                    });\n                    this.eventEmitter.emit('perpMarketAccountUpdate', data);\n                    this.eventEmitter.emit('update');\n                }),\n                // Spot market subscription\n                this.spotMarketAllAccountsSubscriber.subscribe((_accountId, data, context, _buffer) => {\n                    if (this.delistedMarketSetting !== types_1.DelistedMarketSetting.Subscribe &&\n                        (0, types_2.isVariant)(data.status, 'delisted')) {\n                        return;\n                    }\n                    this.spotMarketAccountLatestData.set(data.marketIndex, {\n                        data,\n                        slot: context.slot,\n                    });\n                    this.eventEmitter.emit('spotMarketAccountUpdate', data);\n                    this.eventEmitter.emit('update');\n                }),\n                // State account subscription\n                (async () => {\n                    const statePublicKey = await (0, pda_1.getDriftStateAccountPublicKey)(this.program.programId);\n                    this.stateAccountSubscriber = new webSocketAccountSubscriberV2_1.WebSocketAccountSubscriberV2('state', this.program, statePublicKey, undefined, undefined, this.commitment, this.rpcSubscriptions, this.rpc);\n                    await Promise.all([\n                        this.stateAccountSubscriber.fetch(),\n                        this.stateAccountSubscriber.subscribe((data) => {\n                            this.eventEmitter.emit('stateAccountUpdate', data);\n                            this.eventEmitter.emit('update');\n                        }),\n                    ]);\n                })(),\n                (async () => {\n                    await this.setInitialData();\n                    const subscribeToOraclesStartTime = performance.now();\n                    await this.subscribeToOracles();\n                    const subscribeToOraclesEndTime = performance.now();\n                    const duration = subscribeToOraclesEndTime - subscribeToOraclesStartTime;\n                    return duration;\n                })(),\n            ]);\n            // const initialPerpMarketDataFromLatestData = new Map(\n            // \tArray.from(this.perpMarketAccountLatestData.values()).map((data) => [\n            // \t\tdata.data.marketIndex,\n            // \t\tdata.data,\n            // \t])\n            // );\n            // const initialSpotMarketDataFromLatestData = new Map(\n            // \tArray.from(this.spotMarketAccountLatestData.values()).map((data) => [\n            // \t\tdata.data.marketIndex,\n            // \t\tdata.data,\n            // \t])\n            // );\n            // this.initialPerpMarketAccountData = initialPerpMarketDataFromLatestData;\n            // this.initialSpotMarketAccountData = initialSpotMarketDataFromLatestData;\n            await this.handleDelistedMarketOracles();\n            await Promise.all([this.setPerpOracleMap(), this.setSpotOracleMap()]);\n            this.eventEmitter.emit('update');\n            // delete initial data\n            this.removeInitialData();\n            const totalDuration = performance.now() - startTime;\n            console.log(`[PROFILING] WebSocketDriftClientAccountSubscriberV2.subscribe() completed in ${totalDuration.toFixed(2)}ms`);\n            // Resolve the subscription promise\n            this.isSubscribed = true;\n            this.isSubscribing = false;\n            // Before calling subscriptionPromiseResolver, check if it's defined\n            if (this.subscriptionPromiseResolver) {\n                this.subscriptionPromiseResolver(true);\n            }\n            return true;\n        }\n        catch (error) {\n            console.error('Subscription failed:', error);\n            this.isSubscribing = false;\n            this.subscriptionPromiseResolver(false);\n            return false;\n        }\n    }\n    async fetch() {\n        await this.setInitialData();\n    }\n    /**\n     * This is a no-op method that always returns true.\n     * Unlike the previous implementation, we don't need to manually subscribe to individual perp markets\n     * because we automatically receive updates for all program account changes via a single websocket subscription.\n     * This means any new perp markets will automatically be included without explicit subscription.\n     * @param marketIndex The perp market index to add (unused)\n     * @returns Promise that resolves to true\n     */\n    addPerpMarket(_marketIndex) {\n        return Promise.resolve(true);\n    }\n    /**\n     * This is a no-op method that always returns true.\n     * Unlike the previous implementation, we don't need to manually subscribe to individual spot markets\n     * because we automatically receive updates for all program account changes via a single websocket subscription.\n     * This means any new spot markets will automatically be included without explicit subscription.\n     * @param marketIndex The spot market index to add (unused)\n     * @returns Promise that resolves to true\n     */\n    addSpotMarket(_marketIndex) {\n        return Promise.resolve(true);\n    }\n    // TODO: need more options to skip loading perp market and spot market data. Because of how we fetch within the program account subscribers, I am commenting this all out\n    async setInitialData() {\n        var _a;\n        const connection = this.program.provider.connection;\n        // Profile oracle initial data setup\n        const oracleSetupStartTime = performance.now();\n        const oracleAccountPubkeyChunks = this.chunks(this.oracleInfos.map((oracleInfo) => oracleInfo.publicKey), 100);\n        const oracleAccountInfos = (await Promise.all(oracleAccountPubkeyChunks.map((oracleAccountPublicKeysChunk) => connection.getMultipleAccountsInfo(oracleAccountPublicKeysChunk)))).flat();\n        this.initialOraclePriceData = new Map(this.oracleInfos.reduce((result, oracleInfo, i) => {\n            if (!oracleAccountInfos[i]) {\n                return result;\n            }\n            const oracleClient = this.oracleClientCache.get(oracleInfo.source, connection, this.program);\n            const oraclePriceData = oracleClient.getOraclePriceDataFromBuffer(oracleAccountInfos[i].data);\n            result.push([\n                (0, oracleId_1.getOracleId)(oracleInfo.publicKey, oracleInfo.source),\n                oraclePriceData,\n            ]);\n            return result;\n        }, []));\n        const oracleSetupEndTime = performance.now();\n        const oracleSetupDuration = oracleSetupEndTime - oracleSetupStartTime;\n        if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.logResubMessages) {\n            console.log(`[PROFILING] Oracle initial data setup completed in ${oracleSetupDuration.toFixed(2)}ms (${this.initialOraclePriceData.size} oracles)`);\n        }\n        // emit initial oracle price data\n        Array.from(this.initialOraclePriceData.entries()).forEach(([oracleId, oraclePriceData]) => {\n            const { publicKey, source } = (0, oracleId_1.getPublicKeyAndSourceFromOracleId)(oracleId);\n            this.eventEmitter.emit('oraclePriceUpdate', publicKey, source, oraclePriceData);\n        });\n        this.eventEmitter.emit('update');\n    }\n    removeInitialData() {\n        this.initialPerpMarketAccountData = new Map();\n        this.initialSpotMarketAccountData = new Map();\n        this.initialOraclePriceData = new Map();\n    }\n    async subscribeToOracles() {\n        const startTime = performance.now();\n        // Filter out default oracles and duplicates to avoid unnecessary subscriptions\n        const validOracleInfos = this.oracleInfos.filter((oracleInfo) => !this.oracleSubscribers.has((0, oracleId_1.getOracleId)(oracleInfo.publicKey, oracleInfo.source)));\n        await Promise.all(validOracleInfos.map((oracleInfo) => this.subscribeToOracle(oracleInfo)));\n        const totalDuration = performance.now() - startTime;\n        console.log(`[PROFILING] subscribeToOracles() completed in ${totalDuration.toFixed(2)}ms`);\n        return true;\n    }\n    async subscribeToOracle(oracleInfo) {\n        var _a;\n        try {\n            const oracleId = (0, oracleId_1.getOracleId)(oracleInfo.publicKey, oracleInfo.source);\n            const client = this.oracleClientCache.get(oracleInfo.source, this.program.provider.connection, this.program);\n            const accountSubscriber = new webSocketAccountSubscriberV2_1.WebSocketAccountSubscriberV2('oracle', this.program, oracleInfo.publicKey, (buffer) => {\n                return client.getOraclePriceDataFromBuffer(buffer);\n            }, this.resubOpts, this.commitment, this.rpcSubscriptions, this.rpc);\n            const initialOraclePriceData = (_a = this.initialOraclePriceData) === null || _a === void 0 ? void 0 : _a.get(oracleId);\n            if (initialOraclePriceData) {\n                accountSubscriber.setData(initialOraclePriceData);\n            }\n            await accountSubscriber.subscribe((data) => {\n                this.eventEmitter.emit('oraclePriceUpdate', oracleInfo.publicKey, oracleInfo.source, data);\n                this.eventEmitter.emit('update');\n            });\n            this.oracleSubscribers.set(oracleId, accountSubscriber);\n            return true;\n        }\n        catch (error) {\n            console.error(`Failed to subscribe to oracle ${oracleInfo.publicKey.toString()}:`, error);\n            return false;\n        }\n    }\n    async unsubscribeFromMarketAccounts() {\n        await this.perpMarketAllAccountsSubscriber.unsubscribe();\n    }\n    async unsubscribeFromSpotMarketAccounts() {\n        await this.spotMarketAllAccountsSubscriber.unsubscribe();\n    }\n    async unsubscribeFromOracles() {\n        await Promise.all(Array.from(this.oracleSubscribers.values()).map((accountSubscriber) => accountSubscriber.unsubscribe()));\n    }\n    async unsubscribe() {\n        var _a;\n        if (!this.isSubscribed) {\n            return;\n        }\n        if (this.subscriptionPromise) {\n            await this.subscriptionPromise;\n        }\n        await Promise.all([\n            (_a = this.stateAccountSubscriber) === null || _a === void 0 ? void 0 : _a.unsubscribe(),\n            this.unsubscribeFromMarketAccounts(),\n            this.unsubscribeFromSpotMarketAccounts(),\n            this.unsubscribeFromOracles(),\n        ]);\n        this.isSubscribed = false;\n        this.isSubscribing = false;\n        this.subscriptionPromiseResolver = () => { };\n    }\n    async addOracle(oracleInfo) {\n        const oracleId = (0, oracleId_1.getOracleId)(oracleInfo.publicKey, oracleInfo.source);\n        if (this.oracleSubscribers.has(oracleId)) {\n            return true;\n        }\n        if (oracleInfo.publicKey.equals(web3_js_1.PublicKey.default)) {\n            return true;\n        }\n        return this.subscribeToOracle(oracleInfo);\n    }\n    async setPerpOracleMap() {\n        const perpMarkets = this.getMarketAccountsAndSlots();\n        const addOraclePromises = [];\n        for (const perpMarket of perpMarkets) {\n            if (!perpMarket || !perpMarket.data) {\n                continue;\n            }\n            const perpMarketAccount = perpMarket.data;\n            const perpMarketIndex = perpMarketAccount.marketIndex;\n            const oracle = perpMarketAccount.amm.oracle;\n            const oracleId = (0, oracleId_1.getOracleId)(oracle, perpMarket.data.amm.oracleSource);\n            if (!this.oracleSubscribers.has(oracleId)) {\n                addOraclePromises.push(this.addOracle({\n                    publicKey: oracle,\n                    source: perpMarket.data.amm.oracleSource,\n                }));\n            }\n            this.perpOracleMap.set(perpMarketIndex, oracle);\n            this.perpOracleStringMap.set(perpMarketIndex, oracleId);\n        }\n        await Promise.all(addOraclePromises);\n    }\n    async setSpotOracleMap() {\n        const spotMarkets = this.getSpotMarketAccountsAndSlots();\n        const addOraclePromises = [];\n        for (const spotMarket of spotMarkets) {\n            if (!spotMarket || !spotMarket.data) {\n                continue;\n            }\n            const spotMarketAccount = spotMarket.data;\n            const spotMarketIndex = spotMarketAccount.marketIndex;\n            const oracle = spotMarketAccount.oracle;\n            const oracleId = (0, oracleId_1.getOracleId)(oracle, spotMarketAccount.oracleSource);\n            if (!this.oracleSubscribers.has(oracleId)) {\n                addOraclePromises.push(this.addOracle({\n                    publicKey: oracle,\n                    source: spotMarketAccount.oracleSource,\n                }));\n            }\n            this.spotOracleMap.set(spotMarketIndex, oracle);\n            this.spotOracleStringMap.set(spotMarketIndex, oracleId);\n        }\n        await Promise.all(addOraclePromises);\n    }\n    async handleDelistedMarketOracles() {\n        if (this.delistedMarketSetting === types_1.DelistedMarketSetting.Subscribe) {\n            return;\n        }\n        const { oracles } = (0, utils_1.findDelistedPerpMarketsAndOracles)(this.getMarketAccountsAndSlots(), this.getSpotMarketAccountsAndSlots());\n        for (const oracle of oracles) {\n            const oracleId = (0, oracleId_1.getOracleId)(oracle.publicKey, oracle.source);\n            if (this.oracleSubscribers.has(oracleId)) {\n                await this.oracleSubscribers.get(oracleId).unsubscribe();\n                if (this.delistedMarketSetting === types_1.DelistedMarketSetting.Discard) {\n                    this.oracleSubscribers.delete(oracleId);\n                }\n            }\n        }\n    }\n    assertIsSubscribed() {\n        if (!this.isSubscribed) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` before using this function');\n        }\n    }\n    getStateAccountAndSlot() {\n        this.assertIsSubscribed();\n        return this.stateAccountSubscriber.dataAndSlot;\n    }\n    getMarketAccountAndSlot(marketIndex) {\n        this.assertIsSubscribed();\n        return this.perpMarketAccountLatestData.get(marketIndex);\n    }\n    getMarketAccountsAndSlots() {\n        return Array.from(this.perpMarketAccountLatestData.values());\n    }\n    getSpotMarketAccountAndSlot(marketIndex) {\n        this.assertIsSubscribed();\n        return this.spotMarketAccountLatestData.get(marketIndex);\n    }\n    getSpotMarketAccountsAndSlots() {\n        return Array.from(this.spotMarketAccountLatestData.values());\n    }\n    getOraclePriceDataAndSlot(oracleId) {\n        var _a;\n        this.assertIsSubscribed();\n        if (oracleId === ORACLE_DEFAULT_ID) {\n            return {\n                data: quoteAssetOracleClient_1.QUOTE_ORACLE_PRICE_DATA,\n                slot: 0,\n            };\n        }\n        return (_a = this.oracleSubscribers.get(oracleId)) === null || _a === void 0 ? void 0 : _a.dataAndSlot;\n    }\n    getOraclePriceDataAndSlotForPerpMarket(marketIndex) {\n        const perpMarketAccount = this.getMarketAccountAndSlot(marketIndex);\n        const oracle = this.perpOracleMap.get(marketIndex);\n        const oracleId = this.perpOracleStringMap.get(marketIndex);\n        if (!perpMarketAccount || !oracleId) {\n            return undefined;\n        }\n        if (!perpMarketAccount.data.amm.oracle.equals(oracle)) {\n            // If the oracle has changed, we need to update the oracle map in background\n            this.setPerpOracleMap();\n        }\n        return this.getOraclePriceDataAndSlot(oracleId);\n    }\n    getOraclePriceDataAndSlotForSpotMarket(marketIndex) {\n        const spotMarketAccount = this.getSpotMarketAccountAndSlot(marketIndex);\n        const oracle = this.spotOracleMap.get(marketIndex);\n        const oracleId = this.spotOracleStringMap.get(marketIndex);\n        if (!spotMarketAccount || !oracleId) {\n            return undefined;\n        }\n        if (!spotMarketAccount.data.oracle.equals(oracle)) {\n            // If the oracle has changed, we need to update the oracle map in background\n            this.setSpotOracleMap();\n        }\n        return this.getOraclePriceDataAndSlot(oracleId);\n    }\n}\nexports.WebSocketDriftClientAccountSubscriberV2 = WebSocketDriftClientAccountSubscriberV2;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 2550, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/bulkAccountLoader.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BulkAccountLoader = void 0;\nconst uuid_1 = require(\"uuid\");\nconst promiseTimeout_1 = require(\"../util/promiseTimeout\");\nconst numericConstants_1 = require(\"../constants/numericConstants\");\nconst oneMinute = 60 * 1000;\nclass BulkAccountLoader {\n    constructor(connection, commitment, pollingFrequency) {\n        this.accountsToLoad = new Map();\n        this.bufferAndSlotMap = new Map();\n        this.errorCallbacks = new Map();\n        this.lastTimeLoadingPromiseCleared = Date.now();\n        this.mostRecentSlot = 0;\n        this.connection = connection;\n        this.commitment = commitment;\n        this.pollingFrequency = pollingFrequency;\n    }\n    async addAccount(publicKey, callback) {\n        if (!publicKey) {\n            console.trace(`Caught adding blank publickey to bulkAccountLoader`);\n        }\n        const existingSize = this.accountsToLoad.size;\n        const callbackId = (0, uuid_1.v4)();\n        const existingAccountToLoad = this.accountsToLoad.get(publicKey.toString());\n        if (existingAccountToLoad) {\n            existingAccountToLoad.callbacks.set(callbackId, callback);\n        }\n        else {\n            const callbacks = new Map();\n            callbacks.set(callbackId, callback);\n            const newAccountToLoad = {\n                publicKey,\n                callbacks,\n            };\n            this.accountsToLoad.set(publicKey.toString(), newAccountToLoad);\n        }\n        if (existingSize === 0) {\n            this.startPolling();\n        }\n        // resolve the current loadPromise in case client wants to call load\n        await this.loadPromise;\n        return callbackId;\n    }\n    removeAccount(publicKey, callbackId) {\n        const existingAccountToLoad = this.accountsToLoad.get(publicKey.toString());\n        if (existingAccountToLoad) {\n            existingAccountToLoad.callbacks.delete(callbackId);\n            if (existingAccountToLoad.callbacks.size === 0) {\n                this.bufferAndSlotMap.delete(publicKey.toString());\n                this.accountsToLoad.delete(existingAccountToLoad.publicKey.toString());\n            }\n        }\n        if (this.accountsToLoad.size === 0) {\n            this.stopPolling();\n        }\n    }\n    addErrorCallbacks(callback) {\n        const callbackId = (0, uuid_1.v4)();\n        this.errorCallbacks.set(callbackId, callback);\n        return callbackId;\n    }\n    removeErrorCallbacks(callbackId) {\n        this.errorCallbacks.delete(callbackId);\n    }\n    chunks(array, size) {\n        return new Array(Math.ceil(array.length / size))\n            .fill(null)\n            .map((_, index) => index * size)\n            .map((begin) => array.slice(begin, begin + size));\n    }\n    async load() {\n        if (this.loadPromise) {\n            const now = Date.now();\n            if (now - this.lastTimeLoadingPromiseCleared > oneMinute) {\n                this.loadPromise = undefined;\n            }\n            else {\n                return this.loadPromise;\n            }\n        }\n        this.loadPromise = new Promise((resolver) => {\n            this.loadPromiseResolver = resolver;\n        });\n        this.lastTimeLoadingPromiseCleared = Date.now();\n        try {\n            const chunks = this.chunks(this.chunks(Array.from(this.accountsToLoad.values()), numericConstants_1.GET_MULTIPLE_ACCOUNTS_CHUNK_SIZE), 10);\n            await Promise.all(chunks.map((chunk) => {\n                return this.loadChunk(chunk);\n            }));\n        }\n        catch (e) {\n            console.error(`Error in bulkAccountLoader.load()`);\n            console.error(e);\n            for (const [_, callback] of this.errorCallbacks) {\n                callback(e);\n            }\n        }\n        finally {\n            this.loadPromiseResolver();\n            this.loadPromise = undefined;\n        }\n    }\n    async loadChunk(accountsToLoadChunks) {\n        if (accountsToLoadChunks.length === 0) {\n            return;\n        }\n        const requests = new Array();\n        for (const accountsToLoadChunk of accountsToLoadChunks) {\n            const args = [\n                accountsToLoadChunk\n                    .filter((accountToLoad) => accountToLoad.callbacks.size > 0)\n                    .map((accountToLoad) => {\n                    return accountToLoad.publicKey.toBase58();\n                }),\n                { commitment: this.commitment },\n            ];\n            requests.push({\n                methodName: 'getMultipleAccounts',\n                args,\n            });\n        }\n        const rpcResponses = await (0, promiseTimeout_1.promiseTimeout)(\n        // @ts-ignore\n        this.connection._rpcBatchRequest(requests), 10 * 1000 // 30 second timeout\n        );\n        if (rpcResponses === null) {\n            this.log('request to rpc timed out');\n            return;\n        }\n        rpcResponses.forEach((rpcResponse, i) => {\n            if (!rpcResponse.result) {\n                console.error('rpc response missing result:');\n                console.log(JSON.stringify(rpcResponse));\n                return;\n            }\n            const newSlot = rpcResponse.result.context.slot;\n            if (newSlot > this.mostRecentSlot) {\n                this.mostRecentSlot = newSlot;\n            }\n            const accountsToLoad = accountsToLoadChunks[i];\n            accountsToLoad.forEach((accountToLoad, j) => {\n                if (accountToLoad.callbacks.size === 0) {\n                    return;\n                }\n                const key = accountToLoad.publicKey.toBase58();\n                const oldRPCResponse = this.bufferAndSlotMap.get(key);\n                if (oldRPCResponse && newSlot < oldRPCResponse.slot) {\n                    return;\n                }\n                let newBuffer = undefined;\n                if (rpcResponse.result.value[j]) {\n                    const raw = rpcResponse.result.value[j].data[0];\n                    const dataType = rpcResponse.result.value[j].data[1];\n                    newBuffer = Buffer.from(raw, dataType);\n                }\n                if (!oldRPCResponse) {\n                    this.bufferAndSlotMap.set(key, {\n                        slot: newSlot,\n                        buffer: newBuffer,\n                    });\n                    this.handleAccountCallbacks(accountToLoad, newBuffer, newSlot);\n                    return;\n                }\n                const oldBuffer = oldRPCResponse.buffer;\n                if (newBuffer && (!oldBuffer || !newBuffer.equals(oldBuffer))) {\n                    this.bufferAndSlotMap.set(key, {\n                        slot: newSlot,\n                        buffer: newBuffer,\n                    });\n                    this.handleAccountCallbacks(accountToLoad, newBuffer, newSlot);\n                }\n            });\n        });\n    }\n    handleAccountCallbacks(accountToLoad, buffer, slot) {\n        for (const [_, callback] of accountToLoad.callbacks) {\n            try {\n                callback(buffer, slot);\n            }\n            catch (e) {\n                console.log('Bulk account load: error in account callback');\n                console.log('accounto to load', accountToLoad.publicKey.toString());\n                console.log('buffer', buffer.toString('base64'));\n                for (const callback of accountToLoad.callbacks.values()) {\n                    console.log('account to load cb', callback);\n                }\n                throw e;\n            }\n        }\n    }\n    getBufferAndSlot(publicKey) {\n        return this.bufferAndSlotMap.get(publicKey.toString());\n    }\n    getSlot() {\n        return this.mostRecentSlot;\n    }\n    startPolling() {\n        if (this.intervalId) {\n            return;\n        }\n        if (this.pollingFrequency !== 0)\n            this.intervalId = setInterval(this.load.bind(this), this.pollingFrequency);\n    }\n    stopPolling() {\n        if (this.intervalId) {\n            clearInterval(this.intervalId);\n            this.intervalId = undefined;\n        }\n    }\n    log(msg) {\n        console.log(msg);\n    }\n    updatePollingFrequency(pollingFrequency) {\n        this.stopPolling();\n        this.pollingFrequency = pollingFrequency;\n        if (this.accountsToLoad.size > 0) {\n            this.startPolling();\n        }\n    }\n}\nexports.BulkAccountLoader = BulkAccountLoader;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 2767, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/bulkUserSubscription.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.bulkPollingUserSubscribe = void 0;\n/**\n * @param users\n * @param accountLoader\n */\nasync function bulkPollingUserSubscribe(users, accountLoader) {\n    if (users.length === 0) {\n        await accountLoader.load();\n        return;\n    }\n    await Promise.all(users.map((user) => {\n        return user.accountSubscriber.addToAccountLoader();\n    }));\n    await accountLoader.load();\n    await Promise.all(users.map(async (user) => {\n        return user.subscribe();\n    }));\n}\nexports.bulkPollingUserSubscribe = bulkPollingUserSubscribe;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,wBAAwB,GAAG,KAAK;AACxC;;;CAGC,GACD,eAAe,yBAAyB,KAAK,EAAE,aAAa;IACxD,IAAI,MAAM,MAAM,KAAK,GAAG;QACpB,MAAM,cAAc,IAAI;QACxB;IACJ;IACA,MAAM,QAAQ,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC;QACzB,OAAO,KAAK,iBAAiB,CAAC,kBAAkB;IACpD;IACA,MAAM,cAAc,IAAI;IACxB,MAAM,QAAQ,GAAG,CAAC,MAAM,GAAG,CAAC,OAAO;QAC/B,OAAO,KAAK,SAAS;IACzB;AACJ;AACA,QAAQ,wBAAwB,GAAG","ignoreList":[0]}},
    {"offset": {"line": 2792, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/bulkUserStatsSubscription.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.bulkPollingUserStatsSubscribe = void 0;\n/**\n * @param userStats\n * @param accountLoader\n */\nasync function bulkPollingUserStatsSubscribe(userStats, accountLoader) {\n    if (userStats.length === 0) {\n        await accountLoader.load();\n        return;\n    }\n    await Promise.all(userStats.map((userStat) => {\n        return userStat.accountSubscriber.addToAccountLoader();\n    }));\n    await accountLoader.load();\n    await Promise.all(userStats.map(async (userStat) => {\n        return userStat.subscribe();\n    }));\n}\nexports.bulkPollingUserStatsSubscribe = bulkPollingUserStatsSubscribe;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,6BAA6B,GAAG,KAAK;AAC7C;;;CAGC,GACD,eAAe,8BAA8B,SAAS,EAAE,aAAa;IACjE,IAAI,UAAU,MAAM,KAAK,GAAG;QACxB,MAAM,cAAc,IAAI;QACxB;IACJ;IACA,MAAM,QAAQ,GAAG,CAAC,UAAU,GAAG,CAAC,CAAC;QAC7B,OAAO,SAAS,iBAAiB,CAAC,kBAAkB;IACxD;IACA,MAAM,cAAc,IAAI;IACxB,MAAM,QAAQ,GAAG,CAAC,UAAU,GAAG,CAAC,OAAO;QACnC,OAAO,SAAS,SAAS;IAC7B;AACJ;AACA,QAAQ,6BAA6B,GAAG","ignoreList":[0]}},
    {"offset": {"line": 2817, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/customizedCadenceBulkAccountLoader.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CustomizedCadenceBulkAccountLoader = void 0;\nconst numericConstants_1 = require(\"../constants/numericConstants\");\nconst bulkAccountLoader_1 = require(\"./bulkAccountLoader\");\nconst uuid_1 = require(\"uuid\");\nclass CustomizedCadenceBulkAccountLoader extends bulkAccountLoader_1.BulkAccountLoader {\n    constructor(connection, commitment, defaultPollingFrequency) {\n        super(connection, commitment, defaultPollingFrequency);\n        this.customIntervalId = null;\n        this.currentPollingFrequency = null;\n        this.accountFrequencies = new Map();\n        this.lastPollingTimes = new Map();\n        this.defaultPollingFrequency = defaultPollingFrequency;\n    }\n    getAccountsToLoad() {\n        const currentTime = Date.now();\n        const accountsToLoad = [];\n        for (const [key, frequency] of this.accountFrequencies.entries()) {\n            const lastPollTime = this.lastPollingTimes.get(key) || 0;\n            if (currentTime - lastPollTime >= frequency) {\n                const account = this.accountsToLoad.get(key);\n                if (account) {\n                    accountsToLoad.push(account);\n                    this.lastPollingTimes.set(key, currentTime);\n                }\n            }\n        }\n        return accountsToLoad;\n    }\n    async load() {\n        return this.handleAccountLoading();\n    }\n    async handleAccountLoading() {\n        const accounts = this.getAccountsToLoad();\n        if (accounts.length > 0) {\n            const chunks = this.chunks(this.chunks(accounts, numericConstants_1.GET_MULTIPLE_ACCOUNTS_CHUNK_SIZE), 10);\n            await Promise.all(chunks.map((chunk) => {\n                return this.loadChunk(chunk);\n            }));\n        }\n    }\n    /**\n     * Updates the polling frequency for an account. This affects all callbacks attached to this account.\n     *\n     * @param publicKey The public key of the account to set the custom polling frequency for\n     * @param newFrequency The new polling frequency in ms\n     */\n    setCustomPollingFrequency(publicKey, newFrequency) {\n        const key = publicKey.toBase58();\n        this.accountFrequencies.set(key, newFrequency);\n        this.lastPollingTimes.set(key, 0); // Reset last polling time to ensure immediate load\n        this.restartPollingIfNeeded(newFrequency);\n    }\n    restartPollingIfNeeded(newFrequency) {\n        if ((this.currentPollingFrequency &&\n            newFrequency < this.currentPollingFrequency) ||\n            !this.customIntervalId) {\n            this.stopPolling();\n            this.startPolling();\n        }\n    }\n    /**\n     * Adds an account to be monitored by the bulk account loader\n     * @param publicKey The public key of the account to monitor\n     * @param callback Function to be called when account data is received\n     * @param customPollingFrequency Optional custom polling frequency in ms for this specific account.\n     * If not provided, will use the default polling frequency\n     * @returns A unique callback ID that can be used to remove this specific callback later\n     *\n     * The method will:\n     * 1. Create a new callback mapping for the account if it doesn't exist already\n     * 2. Set up polling frequency tracking for the account if it doesn't exist already. If previous polling frequency is faster than the new one,\n     *    we will use the previous frequency.\n     * 3. Reset last polling time to 0 to ensure data fetch is triggered on the next poll. Note that this does not mean the account will be fetched immediately.\n     * 4. Automatically restart polling if this account needs a faster frequency than existing accounts\n     */\n    async addAccount(publicKey, callback, customPollingFrequency) {\n        const callbackId = (0, uuid_1.v4)();\n        const existingAccountToLoad = this.accountsToLoad.get(publicKey.toString());\n        if (existingAccountToLoad) {\n            existingAccountToLoad.callbacks.set(callbackId, callback);\n        }\n        else {\n            const callbacks = new Map();\n            callbacks.set(callbackId, callback);\n            const newAccountToLoad = {\n                publicKey,\n                callbacks,\n            };\n            this.accountsToLoad.set(publicKey.toString(), newAccountToLoad);\n        }\n        const key = publicKey.toBase58();\n        const previousFrequency = this.accountFrequencies.get(key) || this.defaultPollingFrequency;\n        const updatedFrequency = customPollingFrequency && customPollingFrequency < previousFrequency\n            ? customPollingFrequency\n            : previousFrequency;\n        this.accountFrequencies.set(key, updatedFrequency);\n        this.lastPollingTimes.set(key, 0); // Reset last polling time to ensure immediate load\n        this.restartPollingIfNeeded(updatedFrequency);\n        return callbackId;\n    }\n    removeAccount(publicKey, callbackId) {\n        const existingAccountToLoad = this.accountsToLoad.get(publicKey.toString());\n        if (existingAccountToLoad) {\n            existingAccountToLoad.callbacks.delete(callbackId);\n            if (existingAccountToLoad.callbacks.size === 0) {\n                this.bufferAndSlotMap.delete(publicKey.toString());\n                this.accountsToLoad.delete(existingAccountToLoad.publicKey.toString());\n                const key = publicKey.toBase58();\n                this.accountFrequencies.delete(key);\n                this.lastPollingTimes.delete(key);\n            }\n        }\n        if (this.accountsToLoad.size === 0) {\n            this.stopPolling();\n        }\n        else {\n            // Restart polling in case we removed the account with the smallest frequency\n            this.restartPollingIfNeeded(this.defaultPollingFrequency);\n        }\n    }\n    getAccountCadence(publicKey) {\n        const key = publicKey.toBase58();\n        return this.accountFrequencies.get(key) || null;\n    }\n    startPolling() {\n        if (this.customIntervalId) {\n            return;\n        }\n        const minFrequency = Math.min(...Array.from(this.accountFrequencies.values()), this.defaultPollingFrequency);\n        this.currentPollingFrequency = minFrequency;\n        this.customIntervalId = setInterval(() => {\n            this.handleAccountLoading().catch((error) => {\n                console.error('Error in account loading:', error);\n            });\n        }, minFrequency);\n    }\n    stopPolling() {\n        super.stopPolling();\n        if (this.customIntervalId) {\n            clearInterval(this.customIntervalId);\n            this.customIntervalId = null;\n            this.currentPollingFrequency = null;\n        }\n        this.lastPollingTimes.clear();\n    }\n    clearAccountFrequencies() {\n        this.accountFrequencies.clear();\n    }\n}\nexports.CustomizedCadenceBulkAccountLoader = CustomizedCadenceBulkAccountLoader;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 2966, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/pollingDriftClientAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PollingDriftClientAccountSubscriber = void 0;\nconst types_1 = require(\"./types\");\nconst events_1 = require(\"events\");\nconst types_2 = require(\"../types\");\nconst pda_1 = require(\"../addresses/pda\");\nconst utils_1 = require(\"./utils\");\nconst web3_js_1 = require(\"@solana/web3.js\");\nconst oracleClientCache_1 = require(\"../oracles/oracleClientCache\");\nconst quoteAssetOracleClient_1 = require(\"../oracles/quoteAssetOracleClient\");\nconst config_1 = require(\"../config\");\nconst oracleId_1 = require(\"../oracles/oracleId\");\nconst ORACLE_DEFAULT_ID = (0, oracleId_1.getOracleId)(web3_js_1.PublicKey.default, types_2.OracleSource.QUOTE_ASSET);\nclass PollingDriftClientAccountSubscriber {\n    constructor(program, accountLoader, perpMarketIndexes, spotMarketIndexes, oracleInfos, shouldFindAllMarketsAndOracles, delistedMarketSetting) {\n        this.oracleClientCache = new oracleClientCache_1.OracleClientCache();\n        this.accountsToPoll = new Map();\n        this.oraclesToPoll = new Map();\n        this.perpMarket = new Map();\n        this.perpOracleMap = new Map();\n        this.perpOracleStringMap = new Map();\n        this.spotMarket = new Map();\n        this.spotOracleMap = new Map();\n        this.spotOracleStringMap = new Map();\n        this.oracles = new Map();\n        this.isSubscribing = false;\n        this.isSubscribed = false;\n        this.program = program;\n        this.eventEmitter = new events_1.EventEmitter();\n        this.accountLoader = accountLoader;\n        this.perpMarketIndexes = perpMarketIndexes;\n        this.spotMarketIndexes = spotMarketIndexes;\n        this.oracleInfos = oracleInfos;\n        this.shouldFindAllMarketsAndOracles = shouldFindAllMarketsAndOracles;\n        this.delistedMarketSetting = delistedMarketSetting;\n    }\n    async subscribe() {\n        if (this.isSubscribed) {\n            return true;\n        }\n        if (this.isSubscribing) {\n            return await this.subscriptionPromise;\n        }\n        this.isSubscribing = true;\n        this.subscriptionPromise = new Promise((res) => {\n            this.subscriptionPromiseResolver = res;\n        });\n        if (this.shouldFindAllMarketsAndOracles) {\n            const { perpMarketIndexes, spotMarketIndexes, oracleInfos } = await (0, config_1.findAllMarketAndOracles)(this.program);\n            this.perpMarketIndexes = perpMarketIndexes;\n            this.spotMarketIndexes = spotMarketIndexes;\n            this.oracleInfos = oracleInfos;\n        }\n        await this.updateAccountsToPoll();\n        this.updateOraclesToPoll();\n        await this.addToAccountLoader();\n        let subscriptionSucceeded = false;\n        let retries = 0;\n        while (!subscriptionSucceeded && retries < 5) {\n            await this.fetch();\n            subscriptionSucceeded = this.didSubscriptionSucceed();\n            retries++;\n        }\n        if (subscriptionSucceeded) {\n            this.eventEmitter.emit('update');\n        }\n        this.handleDelistedMarkets();\n        await Promise.all([this.setPerpOracleMap(), this.setSpotOracleMap()]);\n        this.isSubscribing = false;\n        this.isSubscribed = subscriptionSucceeded;\n        this.subscriptionPromiseResolver(subscriptionSucceeded);\n        return subscriptionSucceeded;\n    }\n    async updateAccountsToPoll() {\n        if (this.accountsToPoll.size > 0) {\n            return;\n        }\n        const statePublicKey = await (0, pda_1.getDriftStateAccountPublicKey)(this.program.programId);\n        this.accountsToPoll.set(statePublicKey.toString(), {\n            key: 'state',\n            publicKey: statePublicKey,\n            eventType: 'stateAccountUpdate',\n        });\n        await Promise.all([\n            this.updatePerpMarketAccountsToPoll(),\n            this.updateSpotMarketAccountsToPoll(),\n        ]);\n    }\n    async updatePerpMarketAccountsToPoll() {\n        await Promise.all(this.perpMarketIndexes.map((marketIndex) => {\n            return this.addPerpMarketAccountToPoll(marketIndex);\n        }));\n        return true;\n    }\n    async addPerpMarketAccountToPoll(marketIndex) {\n        const perpMarketPublicKey = await (0, pda_1.getPerpMarketPublicKey)(this.program.programId, marketIndex);\n        this.accountsToPoll.set(perpMarketPublicKey.toString(), {\n            key: 'perpMarket',\n            publicKey: perpMarketPublicKey,\n            eventType: 'perpMarketAccountUpdate',\n            mapKey: marketIndex,\n        });\n        return true;\n    }\n    async updateSpotMarketAccountsToPoll() {\n        await Promise.all(this.spotMarketIndexes.map(async (marketIndex) => {\n            await this.addSpotMarketAccountToPoll(marketIndex);\n        }));\n        return true;\n    }\n    async addSpotMarketAccountToPoll(marketIndex) {\n        const marketPublicKey = await (0, pda_1.getSpotMarketPublicKey)(this.program.programId, marketIndex);\n        this.accountsToPoll.set(marketPublicKey.toString(), {\n            key: 'spotMarket',\n            publicKey: marketPublicKey,\n            eventType: 'spotMarketAccountUpdate',\n            mapKey: marketIndex,\n        });\n        return true;\n    }\n    updateOraclesToPoll() {\n        for (const oracleInfo of this.oracleInfos) {\n            if (!oracleInfo.publicKey.equals(web3_js_1.PublicKey.default)) {\n                this.addOracleToPoll(oracleInfo);\n            }\n        }\n        return true;\n    }\n    addOracleToPoll(oracleInfo) {\n        this.oraclesToPoll.set((0, oracleId_1.getOracleId)(oracleInfo.publicKey, oracleInfo.source), {\n            publicKey: oracleInfo.publicKey,\n            source: oracleInfo.source,\n        });\n        return true;\n    }\n    async addToAccountLoader() {\n        const accountPromises = [];\n        for (const [_, accountToPoll] of this.accountsToPoll) {\n            accountPromises.push(this.addAccountToAccountLoader(accountToPoll));\n        }\n        const oraclePromises = [];\n        for (const [_, oracleToPoll] of this.oraclesToPoll) {\n            oraclePromises.push(this.addOracleToAccountLoader(oracleToPoll));\n        }\n        await Promise.all([...accountPromises, ...oraclePromises]);\n        this.errorCallbackId = this.accountLoader.addErrorCallbacks((error) => {\n            this.eventEmitter.emit('error', error);\n        });\n    }\n    async addAccountToAccountLoader(accountToPoll) {\n        accountToPoll.callbackId = await this.accountLoader.addAccount(accountToPoll.publicKey, (buffer, slot) => {\n            if (!buffer)\n                return;\n            const account = this.program.account[accountToPoll.key].coder.accounts.decodeUnchecked((0, utils_1.capitalize)(accountToPoll.key), buffer);\n            const dataAndSlot = {\n                data: account,\n                slot,\n            };\n            if (accountToPoll.mapKey != undefined) {\n                this[accountToPoll.key].set(accountToPoll.mapKey, dataAndSlot);\n            }\n            else {\n                this[accountToPoll.key] = dataAndSlot;\n            }\n            // @ts-ignore\n            this.eventEmitter.emit(accountToPoll.eventType, account);\n            this.eventEmitter.emit('update');\n            if (!this.isSubscribed) {\n                this.isSubscribed = this.didSubscriptionSucceed();\n            }\n        });\n    }\n    async addOracleToAccountLoader(oracleToPoll) {\n        const oracleClient = this.oracleClientCache.get(oracleToPoll.source, this.program.provider.connection, this.program);\n        const oracleId = (0, oracleId_1.getOracleId)(oracleToPoll.publicKey, oracleToPoll.source);\n        oracleToPoll.callbackId = await this.accountLoader.addAccount(oracleToPoll.publicKey, (buffer, slot) => {\n            if (!buffer)\n                return;\n            const oraclePriceData = oracleClient.getOraclePriceDataFromBuffer(buffer);\n            const dataAndSlot = {\n                data: oraclePriceData,\n                slot,\n            };\n            this.oracles.set(oracleId, dataAndSlot);\n            this.eventEmitter.emit('oraclePriceUpdate', oracleToPoll.publicKey, oracleToPoll.source, oraclePriceData);\n            this.eventEmitter.emit('update');\n        });\n    }\n    async fetch() {\n        await this.accountLoader.load();\n        for (const [_, accountToPoll] of this.accountsToPoll) {\n            const bufferAndSlot = this.accountLoader.getBufferAndSlot(accountToPoll.publicKey);\n            if (!bufferAndSlot) {\n                continue;\n            }\n            const { buffer, slot } = bufferAndSlot;\n            if (buffer) {\n                const account = this.program.account[accountToPoll.key].coder.accounts.decodeUnchecked((0, utils_1.capitalize)(accountToPoll.key), buffer);\n                if (accountToPoll.mapKey != undefined) {\n                    this[accountToPoll.key].set(accountToPoll.mapKey, {\n                        data: account,\n                        slot,\n                    });\n                }\n                else {\n                    this[accountToPoll.key] = {\n                        data: account,\n                        slot,\n                    };\n                }\n            }\n        }\n        for (const [_, oracleToPoll] of this.oraclesToPoll) {\n            const bufferAndSlot = this.accountLoader.getBufferAndSlot(oracleToPoll.publicKey);\n            if (!bufferAndSlot) {\n                continue;\n            }\n            const { buffer, slot } = bufferAndSlot;\n            if (buffer) {\n                const oracleClient = this.oracleClientCache.get(oracleToPoll.source, this.program.provider.connection, this.program);\n                const oraclePriceData = oracleClient.getOraclePriceDataFromBuffer(buffer);\n                this.oracles.set((0, oracleId_1.getOracleId)(oracleToPoll.publicKey, oracleToPoll.source), {\n                    data: oraclePriceData,\n                    slot,\n                });\n            }\n        }\n    }\n    didSubscriptionSucceed() {\n        if (this.state)\n            return true;\n        return false;\n    }\n    async unsubscribe() {\n        for (const [_, accountToPoll] of this.accountsToPoll) {\n            this.accountLoader.removeAccount(accountToPoll.publicKey, accountToPoll.callbackId);\n        }\n        for (const [_, oracleToPoll] of this.oraclesToPoll) {\n            this.accountLoader.removeAccount(oracleToPoll.publicKey, oracleToPoll.callbackId);\n        }\n        this.accountLoader.removeErrorCallbacks(this.errorCallbackId);\n        this.errorCallbackId = undefined;\n        this.accountsToPoll.clear();\n        this.oraclesToPoll.clear();\n        this.isSubscribed = false;\n    }\n    async addSpotMarket(marketIndex) {\n        const marketPublicKey = await (0, pda_1.getSpotMarketPublicKey)(this.program.programId, marketIndex);\n        if (this.accountsToPoll.has(marketPublicKey.toString())) {\n            return true;\n        }\n        await this.addSpotMarketAccountToPoll(marketIndex);\n        const accountToPoll = this.accountsToPoll.get(marketPublicKey.toString());\n        await this.addAccountToAccountLoader(accountToPoll);\n        this.setSpotOracleMap();\n        return true;\n    }\n    async addPerpMarket(marketIndex) {\n        const marketPublicKey = await (0, pda_1.getPerpMarketPublicKey)(this.program.programId, marketIndex);\n        if (this.accountsToPoll.has(marketPublicKey.toString())) {\n            return true;\n        }\n        await this.addPerpMarketAccountToPoll(marketIndex);\n        const accountToPoll = this.accountsToPoll.get(marketPublicKey.toString());\n        await this.addAccountToAccountLoader(accountToPoll);\n        await this.setPerpOracleMap();\n        return true;\n    }\n    async addOracle(oracleInfo) {\n        const oracleId = (0, oracleId_1.getOracleId)(oracleInfo.publicKey, oracleInfo.source);\n        if (oracleInfo.publicKey.equals(web3_js_1.PublicKey.default) ||\n            this.oracles.has(oracleId)) {\n            return true;\n        }\n        // this func can be called multiple times before the first pauseForOracleToBeAdded finishes\n        // avoid adding to oraclesToPoll multiple time\n        if (!this.oraclesToPoll.has(oracleId)) {\n            this.addOracleToPoll(oracleInfo);\n            const oracleToPoll = this.oraclesToPoll.get(oracleId);\n            await this.addOracleToAccountLoader(oracleToPoll);\n        }\n        await this.pauseForOracleToBeAdded(3, oracleInfo.publicKey.toBase58());\n        return true;\n    }\n    async pauseForOracleToBeAdded(tries, oracle) {\n        let i = 0;\n        while (i < tries) {\n            await new Promise((r) => setTimeout(r, this.accountLoader.pollingFrequency));\n            if (this.accountLoader.bufferAndSlotMap.has(oracle)) {\n                return;\n            }\n            i++;\n        }\n        console.log(`Pausing to find oracle ${oracle} failed`);\n    }\n    async setPerpOracleMap() {\n        const perpMarkets = this.getMarketAccountsAndSlots();\n        const oraclePromises = [];\n        for (const perpMarket of perpMarkets) {\n            const perpMarketAccount = perpMarket.data;\n            const perpMarketIndex = perpMarketAccount.marketIndex;\n            const oracle = perpMarketAccount.amm.oracle;\n            const oracleId = (0, oracleId_1.getOracleId)(oracle, perpMarketAccount.amm.oracleSource);\n            if (!this.oracles.has(oracleId)) {\n                oraclePromises.push(this.addOracle({\n                    publicKey: oracle,\n                    source: perpMarketAccount.amm.oracleSource,\n                }));\n            }\n            this.perpOracleMap.set(perpMarketIndex, oracle);\n            this.perpOracleStringMap.set(perpMarketIndex, oracleId);\n        }\n        await Promise.all(oraclePromises);\n    }\n    async setSpotOracleMap() {\n        const spotMarkets = this.getSpotMarketAccountsAndSlots();\n        const oraclePromises = [];\n        for (const spotMarket of spotMarkets) {\n            const spotMarketAccount = spotMarket.data;\n            const spotMarketIndex = spotMarketAccount.marketIndex;\n            const oracle = spotMarketAccount.oracle;\n            const oracleId = (0, oracleId_1.getOracleId)(oracle, spotMarketAccount.oracleSource);\n            if (!this.oracles.has(oracleId)) {\n                oraclePromises.push(this.addOracle({\n                    publicKey: oracle,\n                    source: spotMarketAccount.oracleSource,\n                }));\n            }\n            this.spotOracleMap.set(spotMarketIndex, oracle);\n            this.spotOracleStringMap.set(spotMarketIndex, oracleId);\n        }\n        await Promise.all(oraclePromises);\n    }\n    handleDelistedMarkets() {\n        if (this.delistedMarketSetting === types_1.DelistedMarketSetting.Subscribe) {\n            return;\n        }\n        const { perpMarketIndexes, oracles } = (0, utils_1.findDelistedPerpMarketsAndOracles)(this.getMarketAccountsAndSlots(), this.getSpotMarketAccountsAndSlots());\n        for (const perpMarketIndex of perpMarketIndexes) {\n            const perpMarketPubkey = this.perpMarket.get(perpMarketIndex).data.pubkey;\n            const callbackId = this.accountsToPoll.get(perpMarketPubkey.toBase58()).callbackId;\n            this.accountLoader.removeAccount(perpMarketPubkey, callbackId);\n            if (this.delistedMarketSetting === types_1.DelistedMarketSetting.Discard) {\n                this.perpMarket.delete(perpMarketIndex);\n            }\n        }\n        for (const oracle of oracles) {\n            const oracleId = (0, oracleId_1.getOracleId)(oracle.publicKey, oracle.source);\n            const callbackId = this.oraclesToPoll.get(oracleId).callbackId;\n            this.accountLoader.removeAccount(oracle.publicKey, callbackId);\n            if (this.delistedMarketSetting === types_1.DelistedMarketSetting.Discard) {\n                this.oracles.delete(oracleId);\n            }\n        }\n    }\n    assertIsSubscribed() {\n        if (!this.isSubscribed) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` before using this function');\n        }\n    }\n    getStateAccountAndSlot() {\n        this.assertIsSubscribed();\n        return this.state;\n    }\n    getMarketAccountAndSlot(marketIndex) {\n        return this.perpMarket.get(marketIndex);\n    }\n    getMarketAccountsAndSlots() {\n        return Array.from(this.perpMarket.values());\n    }\n    getSpotMarketAccountAndSlot(marketIndex) {\n        return this.spotMarket.get(marketIndex);\n    }\n    getSpotMarketAccountsAndSlots() {\n        return Array.from(this.spotMarket.values());\n    }\n    getOraclePriceDataAndSlot(oracleId) {\n        this.assertIsSubscribed();\n        if (oracleId === ORACLE_DEFAULT_ID) {\n            return {\n                data: quoteAssetOracleClient_1.QUOTE_ORACLE_PRICE_DATA,\n                slot: 0,\n            };\n        }\n        return this.oracles.get(oracleId);\n    }\n    getOraclePriceDataAndSlotForPerpMarket(marketIndex) {\n        const perpMarketAccount = this.getMarketAccountAndSlot(marketIndex);\n        const oracle = this.perpOracleMap.get(marketIndex);\n        const oracleId = this.perpOracleStringMap.get(marketIndex);\n        if (!perpMarketAccount || !oracle) {\n            return undefined;\n        }\n        if (!perpMarketAccount.data.amm.oracle.equals(oracle)) {\n            // If the oracle has changed, we need to update the oracle map in background\n            this.setPerpOracleMap();\n        }\n        return this.getOraclePriceDataAndSlot(oracleId);\n    }\n    getOraclePriceDataAndSlotForSpotMarket(marketIndex) {\n        const spotMarketAccount = this.getSpotMarketAccountAndSlot(marketIndex);\n        const oracle = this.spotOracleMap.get(marketIndex);\n        const oracleId = this.spotOracleStringMap.get(marketIndex);\n        if (!spotMarketAccount || !oracle) {\n            return undefined;\n        }\n        if (!spotMarketAccount.data.oracle.equals(oracle)) {\n            // If the oracle has changed, we need to update the oracle map in background\n            this.setSpotOracleMap();\n        }\n        return this.getOraclePriceDataAndSlot(oracleId);\n    }\n    updateAccountLoaderPollingFrequency(pollingFrequency) {\n        this.accountLoader.updatePollingFrequency(pollingFrequency);\n    }\n}\nexports.PollingDriftClientAccountSubscriber = PollingDriftClientAccountSubscriber;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3389, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/pollingOracleAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PollingOracleAccountSubscriber = void 0;\nconst types_1 = require(\"./types\");\nconst events_1 = require(\"events\");\nclass PollingOracleAccountSubscriber {\n    constructor(publicKey, oracleClient, accountLoader) {\n        this.isSubscribed = false;\n        this.publicKey = publicKey;\n        this.oracleClient = oracleClient;\n        this.accountLoader = accountLoader;\n        this.eventEmitter = new events_1.EventEmitter();\n    }\n    async subscribe() {\n        if (this.isSubscribed) {\n            return true;\n        }\n        await this.addToAccountLoader();\n        let subscriptionSucceeded = false;\n        let retries = 0;\n        while (!subscriptionSucceeded && retries < 5) {\n            await this.fetch();\n            subscriptionSucceeded = this.didSubscriptionSucceed();\n            retries++;\n        }\n        if (subscriptionSucceeded) {\n            this.eventEmitter.emit('update');\n        }\n        this.isSubscribed = subscriptionSucceeded;\n        return subscriptionSucceeded;\n    }\n    async addToAccountLoader() {\n        if (this.callbackId) {\n            return;\n        }\n        this.callbackId = await this.accountLoader.addAccount(this.publicKey, async (buffer, slot) => {\n            const oraclePriceData = await this.oracleClient.getOraclePriceDataFromBuffer(buffer);\n            this.oraclePriceData = { data: oraclePriceData, slot };\n            // @ts-ignore\n            this.eventEmitter.emit('oracleUpdate', oraclePriceData);\n            this.eventEmitter.emit('update');\n        });\n        this.errorCallbackId = this.accountLoader.addErrorCallbacks((error) => {\n            this.eventEmitter.emit('error', error);\n        });\n    }\n    async fetch() {\n        await this.accountLoader.load();\n        const { buffer, slot } = this.accountLoader.getBufferAndSlot(this.publicKey);\n        this.oraclePriceData = {\n            data: await this.oracleClient.getOraclePriceDataFromBuffer(buffer),\n            slot,\n        };\n    }\n    async unsubscribe() {\n        if (!this.isSubscribed) {\n            return;\n        }\n        this.accountLoader.removeAccount(this.publicKey, this.callbackId);\n        this.callbackId = undefined;\n        this.accountLoader.removeErrorCallbacks(this.errorCallbackId);\n        this.errorCallbackId = undefined;\n        this.isSubscribed = false;\n    }\n    assertIsSubscribed() {\n        if (!this.isSubscribed) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` before using this function');\n        }\n    }\n    getOraclePriceData() {\n        this.assertIsSubscribed();\n        return this.oraclePriceData;\n    }\n    didSubscriptionSucceed() {\n        return !!this.oraclePriceData;\n    }\n}\nexports.PollingOracleAccountSubscriber = PollingOracleAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,8BAA8B,GAAG,KAAK;AAC9C,MAAM;AACN,MAAM;AACN,MAAM;IACF,YAAY,SAAS,EAAE,YAAY,EAAE,aAAa,CAAE;QAChD,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,aAAa,GAAG;QACrB,IAAI,CAAC,YAAY,GAAG,IAAI,SAAS,YAAY;IACjD;IACA,MAAM,YAAY;QACd,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,OAAO;QACX;QACA,MAAM,IAAI,CAAC,kBAAkB;QAC7B,IAAI,wBAAwB;QAC5B,IAAI,UAAU;QACd,MAAO,CAAC,yBAAyB,UAAU,EAAG;YAC1C,MAAM,IAAI,CAAC,KAAK;YAChB,wBAAwB,IAAI,CAAC,sBAAsB;YACnD;QACJ;QACA,IAAI,uBAAuB;YACvB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,YAAY,GAAG;QACpB,OAAO;IACX;IACA,MAAM,qBAAqB;QACvB,IAAI,IAAI,CAAC,UAAU,EAAE;YACjB;QACJ;QACA,IAAI,CAAC,UAAU,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,QAAQ;YACjF,MAAM,kBAAkB,MAAM,IAAI,CAAC,YAAY,CAAC,4BAA4B,CAAC;YAC7E,IAAI,CAAC,eAAe,GAAG;gBAAE,MAAM;gBAAiB;YAAK;YACrD,aAAa;YACb,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,gBAAgB;YACvC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC;YACzD,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS;QACpC;IACJ;IACA,MAAM,QAAQ;QACV,MAAM,IAAI,CAAC,aAAa,CAAC,IAAI;QAC7B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,IAAI,CAAC,SAAS;QAC3E,IAAI,CAAC,eAAe,GAAG;YACnB,MAAM,MAAM,IAAI,CAAC,YAAY,CAAC,4BAA4B,CAAC;YAC3D;QACJ;IACJ;IACA,MAAM,cAAc;QAChB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB;QACJ;QACA,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU;QAChE,IAAI,CAAC,UAAU,GAAG;QAClB,IAAI,CAAC,aAAa,CAAC,oBAAoB,CAAC,IAAI,CAAC,eAAe;QAC5D,IAAI,CAAC,eAAe,GAAG;QACvB,IAAI,CAAC,YAAY,GAAG;IACxB;IACA,qBAAqB;QACjB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,MAAM,IAAI,QAAQ,kBAAkB,CAAC;QACzC;IACJ;IACA,qBAAqB;QACjB,IAAI,CAAC,kBAAkB;QACvB,OAAO,IAAI,CAAC,eAAe;IAC/B;IACA,yBAAyB;QACrB,OAAO,CAAC,CAAC,IAAI,CAAC,eAAe;IACjC;AACJ;AACA,QAAQ,8BAA8B,GAAG","ignoreList":[0]}},
    {"offset": {"line": 3475, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/pollingTokenAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PollingTokenAccountSubscriber = void 0;\nconst types_1 = require(\"./types\");\nconst events_1 = require(\"events\");\nconst token_1 = require(\"../token\");\nclass PollingTokenAccountSubscriber {\n    constructor(publicKey, accountLoader) {\n        this.isSubscribed = false;\n        this.publicKey = publicKey;\n        this.accountLoader = accountLoader;\n        this.eventEmitter = new events_1.EventEmitter();\n    }\n    async subscribe() {\n        if (this.isSubscribed) {\n            return true;\n        }\n        await this.addToAccountLoader();\n        let subscriptionSucceeded = false;\n        let retries = 0;\n        while (!subscriptionSucceeded && retries < 5) {\n            await this.fetch();\n            subscriptionSucceeded = this.didSubscriptionSucceed();\n            retries++;\n        }\n        if (subscriptionSucceeded) {\n            this.eventEmitter.emit('update');\n        }\n        this.isSubscribed = subscriptionSucceeded;\n        return subscriptionSucceeded;\n    }\n    async addToAccountLoader() {\n        if (this.callbackId) {\n            return;\n        }\n        this.callbackId = await this.accountLoader.addAccount(this.publicKey, (buffer, slot) => {\n            const tokenAccount = (0, token_1.parseTokenAccount)(buffer, this.publicKey);\n            this.tokenAccountAndSlot = { data: tokenAccount, slot };\n            // @ts-ignore\n            this.eventEmitter.emit('tokenAccountUpdate', tokenAccount);\n            this.eventEmitter.emit('update');\n        });\n        this.errorCallbackId = this.accountLoader.addErrorCallbacks((error) => {\n            this.eventEmitter.emit('error', error);\n        });\n    }\n    async fetch() {\n        await this.accountLoader.load();\n        const { buffer, slot } = this.accountLoader.getBufferAndSlot(this.publicKey);\n        this.tokenAccountAndSlot = {\n            data: (0, token_1.parseTokenAccount)(buffer, this.publicKey),\n            slot,\n        };\n    }\n    async unsubscribe() {\n        if (!this.isSubscribed) {\n            return;\n        }\n        this.accountLoader.removeAccount(this.publicKey, this.callbackId);\n        this.callbackId = undefined;\n        this.accountLoader.removeErrorCallbacks(this.errorCallbackId);\n        this.errorCallbackId = undefined;\n        this.isSubscribed = false;\n    }\n    assertIsSubscribed() {\n        if (!this.isSubscribed) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` before using this function');\n        }\n    }\n    getTokenAccountAndSlot() {\n        this.assertIsSubscribed();\n        return this.tokenAccountAndSlot;\n    }\n    didSubscriptionSucceed() {\n        return !!this.tokenAccountAndSlot;\n    }\n}\nexports.PollingTokenAccountSubscriber = PollingTokenAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,6BAA6B,GAAG,KAAK;AAC7C,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;IACF,YAAY,SAAS,EAAE,aAAa,CAAE;QAClC,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,CAAC,aAAa,GAAG;QACrB,IAAI,CAAC,YAAY,GAAG,IAAI,SAAS,YAAY;IACjD;IACA,MAAM,YAAY;QACd,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,OAAO;QACX;QACA,MAAM,IAAI,CAAC,kBAAkB;QAC7B,IAAI,wBAAwB;QAC5B,IAAI,UAAU;QACd,MAAO,CAAC,yBAAyB,UAAU,EAAG;YAC1C,MAAM,IAAI,CAAC,KAAK;YAChB,wBAAwB,IAAI,CAAC,sBAAsB;YACnD;QACJ;QACA,IAAI,uBAAuB;YACvB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,YAAY,GAAG;QACpB,OAAO;IACX;IACA,MAAM,qBAAqB;QACvB,IAAI,IAAI,CAAC,UAAU,EAAE;YACjB;QACJ;QACA,IAAI,CAAC,UAAU,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,QAAQ;YAC3E,MAAM,eAAe,CAAC,GAAG,QAAQ,iBAAiB,EAAE,QAAQ,IAAI,CAAC,SAAS;YAC1E,IAAI,CAAC,mBAAmB,GAAG;gBAAE,MAAM;gBAAc;YAAK;YACtD,aAAa;YACb,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,sBAAsB;YAC7C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC;YACzD,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS;QACpC;IACJ;IACA,MAAM,QAAQ;QACV,MAAM,IAAI,CAAC,aAAa,CAAC,IAAI;QAC7B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,IAAI,CAAC,SAAS;QAC3E,IAAI,CAAC,mBAAmB,GAAG;YACvB,MAAM,CAAC,GAAG,QAAQ,iBAAiB,EAAE,QAAQ,IAAI,CAAC,SAAS;YAC3D;QACJ;IACJ;IACA,MAAM,cAAc;QAChB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB;QACJ;QACA,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU;QAChE,IAAI,CAAC,UAAU,GAAG;QAClB,IAAI,CAAC,aAAa,CAAC,oBAAoB,CAAC,IAAI,CAAC,eAAe;QAC5D,IAAI,CAAC,eAAe,GAAG;QACvB,IAAI,CAAC,YAAY,GAAG;IACxB;IACA,qBAAqB;QACjB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,MAAM,IAAI,QAAQ,kBAAkB,CAAC;QACzC;IACJ;IACA,yBAAyB;QACrB,IAAI,CAAC,kBAAkB;QACvB,OAAO,IAAI,CAAC,mBAAmB;IACnC;IACA,yBAAyB;QACrB,OAAO,CAAC,CAAC,IAAI,CAAC,mBAAmB;IACrC;AACJ;AACA,QAAQ,6BAA6B,GAAG","ignoreList":[0]}},
    {"offset": {"line": 3561, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/pollingUserAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PollingUserAccountSubscriber = void 0;\nconst types_1 = require(\"./types\");\nconst events_1 = require(\"events\");\nclass PollingUserAccountSubscriber {\n    constructor(connection, userAccountPublicKey, accountLoader, decode) {\n        this.isSubscribed = false;\n        this.connection = connection;\n        this.accountLoader = accountLoader;\n        this.eventEmitter = new events_1.EventEmitter();\n        this.userAccountPublicKey = userAccountPublicKey;\n        this.decode = decode;\n    }\n    async subscribe(userAccount) {\n        if (this.isSubscribed) {\n            return true;\n        }\n        if (userAccount) {\n            this.user = { data: userAccount, slot: undefined };\n        }\n        await this.addToAccountLoader();\n        await this.fetchIfUnloaded();\n        if (this.doesAccountExist()) {\n            this.eventEmitter.emit('update');\n        }\n        this.isSubscribed = true;\n        return true;\n    }\n    async addToAccountLoader() {\n        if (this.callbackId) {\n            return;\n        }\n        this.callbackId = await this.accountLoader.addAccount(this.userAccountPublicKey, (buffer, slot) => {\n            if (!buffer) {\n                return;\n            }\n            if (this.user && this.user.slot > slot) {\n                return;\n            }\n            const account = this.decode('User', buffer);\n            this.user = { data: account, slot };\n            this.eventEmitter.emit('userAccountUpdate', account);\n            this.eventEmitter.emit('update');\n        });\n        this.errorCallbackId = this.accountLoader.addErrorCallbacks((error) => {\n            this.eventEmitter.emit('error', error);\n        });\n    }\n    async fetchIfUnloaded() {\n        if (this.user === undefined) {\n            await this.fetch();\n        }\n    }\n    async fetch() {\n        var _a, _b;\n        try {\n            const dataAndContext = await this.connection.getAccountInfoAndContext(this.userAccountPublicKey, this.accountLoader.commitment);\n            if (dataAndContext.context.slot > ((_b = (_a = this.user) === null || _a === void 0 ? void 0 : _a.slot) !== null && _b !== void 0 ? _b : 0)) {\n                this.user = {\n                    data: this.decode('User', dataAndContext.value.data),\n                    slot: dataAndContext.context.slot,\n                };\n            }\n        }\n        catch (e) {\n            console.log(`PollingUserAccountSubscriber.fetch() UserAccount does not exist: ${e.message}-${e.stack}`);\n        }\n    }\n    doesAccountExist() {\n        return this.user !== undefined;\n    }\n    async unsubscribe() {\n        if (!this.isSubscribed) {\n            return;\n        }\n        this.accountLoader.removeAccount(this.userAccountPublicKey, this.callbackId);\n        this.callbackId = undefined;\n        this.accountLoader.removeErrorCallbacks(this.errorCallbackId);\n        this.errorCallbackId = undefined;\n        this.isSubscribed = false;\n    }\n    assertIsSubscribed() {\n        if (!this.isSubscribed) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` before using this function');\n        }\n    }\n    getUserAccountAndSlot() {\n        if (!this.doesAccountExist()) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` or `fetch` before using this function');\n        }\n        return this.user;\n    }\n    updateData(userAccount, slot) {\n        if (!this.user || this.user.slot < slot) {\n            this.user = { data: userAccount, slot };\n            this.eventEmitter.emit('userAccountUpdate', userAccount);\n            this.eventEmitter.emit('update');\n        }\n    }\n}\nexports.PollingUserAccountSubscriber = PollingUserAccountSubscriber;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3676, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/pollingUserStatsAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PollingUserStatsAccountSubscriber = void 0;\nconst types_1 = require(\"./types\");\nconst events_1 = require(\"events\");\nclass PollingUserStatsAccountSubscriber {\n    constructor(program, userStatsAccountPublicKey, accountLoader) {\n        this.isSubscribed = false;\n        this.program = program;\n        this.accountLoader = accountLoader;\n        this.eventEmitter = new events_1.EventEmitter();\n        this.userStatsAccountPublicKey = userStatsAccountPublicKey;\n    }\n    async subscribe(userStatsAccount) {\n        if (this.isSubscribed) {\n            return true;\n        }\n        if (userStatsAccount) {\n            this.userStats = { data: userStatsAccount, slot: undefined };\n        }\n        await this.addToAccountLoader();\n        await this.fetchIfUnloaded();\n        if (this.doesAccountExist()) {\n            this.eventEmitter.emit('update');\n        }\n        this.isSubscribed = true;\n        return true;\n    }\n    async addToAccountLoader() {\n        if (this.callbackId !== undefined) {\n            return;\n        }\n        this.callbackId = await this.accountLoader.addAccount(this.userStatsAccountPublicKey, (buffer, slot) => {\n            if (!buffer) {\n                return;\n            }\n            if (this.userStats && this.userStats.slot > slot) {\n                return;\n            }\n            const account = this.program.account.userStats.coder.accounts.decodeUnchecked('UserStats', buffer);\n            this.userStats = { data: account, slot };\n            this.eventEmitter.emit('userStatsAccountUpdate', account);\n            this.eventEmitter.emit('update');\n        });\n        this.errorCallbackId = this.accountLoader.addErrorCallbacks((error) => {\n            this.eventEmitter.emit('error', error);\n        });\n    }\n    async fetchIfUnloaded() {\n        if (this.userStats === undefined) {\n            await this.fetch();\n        }\n    }\n    async fetch() {\n        var _a, _b;\n        try {\n            const dataAndContext = await this.program.account.userStats.fetchAndContext(this.userStatsAccountPublicKey, this.accountLoader.commitment);\n            if (dataAndContext.context.slot > ((_b = (_a = this.userStats) === null || _a === void 0 ? void 0 : _a.slot) !== null && _b !== void 0 ? _b : 0)) {\n                this.userStats = {\n                    data: dataAndContext.data,\n                    slot: dataAndContext.context.slot,\n                };\n            }\n        }\n        catch (e) {\n            console.log(`PollingUserStatsAccountSubscriber.fetch() UserStatsAccount does not exist: ${e.message}`);\n        }\n    }\n    doesAccountExist() {\n        return this.userStats !== undefined;\n    }\n    async unsubscribe() {\n        if (!this.isSubscribed) {\n            return;\n        }\n        this.accountLoader.removeAccount(this.userStatsAccountPublicKey, this.callbackId);\n        this.callbackId = undefined;\n        this.accountLoader.removeErrorCallbacks(this.errorCallbackId);\n        this.errorCallbackId = undefined;\n        this.isSubscribed = false;\n    }\n    assertIsSubscribed() {\n        if (!this.isSubscribed) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` before using this function');\n        }\n    }\n    getUserStatsAccountAndSlot() {\n        if (!this.doesAccountExist()) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` or `fetch` before using this function');\n        }\n        return this.userStats;\n    }\n}\nexports.PollingUserStatsAccountSubscriber = PollingUserStatsAccountSubscriber;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3780, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/pollingInsuranceFundStakeAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PollingInsuranceFundStakeAccountSubscriber = void 0;\nconst types_1 = require(\"./types\");\nconst events_1 = require(\"events\");\nclass PollingInsuranceFundStakeAccountSubscriber {\n    constructor(program, publicKey, accountLoader) {\n        this.isSubscribed = false;\n        this.program = program;\n        this.insuranceFundStakeAccountPublicKey = publicKey;\n        this.accountLoader = accountLoader;\n        this.eventEmitter = new events_1.EventEmitter();\n    }\n    async subscribe(insuranceFundStake) {\n        if (this.isSubscribed) {\n            return true;\n        }\n        if (insuranceFundStake) {\n            this.insuranceFundStakeAccountAndSlot = {\n                data: insuranceFundStake,\n                slot: undefined,\n            };\n        }\n        await this.addToAccountLoader();\n        if (this.doesAccountExist()) {\n            this.eventEmitter.emit('update');\n        }\n        this.isSubscribed = true;\n        return true;\n    }\n    async addToAccountLoader() {\n        if (this.callbackId) {\n            return;\n        }\n        this.callbackId = await this.accountLoader.addAccount(this.insuranceFundStakeAccountPublicKey, (buffer, slot) => {\n            if (!buffer) {\n                return;\n            }\n            if (this.insuranceFundStakeAccountAndSlot &&\n                this.insuranceFundStakeAccountAndSlot.slot > slot) {\n                return;\n            }\n            const account = this.program.account.user.coder.accounts.decode('InsuranceFundStake', buffer);\n            this.insuranceFundStakeAccountAndSlot = { data: account, slot };\n            this.eventEmitter.emit('insuranceFundStakeAccountUpdate', account);\n            this.eventEmitter.emit('update');\n        });\n        this.errorCallbackId = this.accountLoader.addErrorCallbacks((error) => {\n            this.eventEmitter.emit('error', error);\n        });\n    }\n    async fetchIfUnloaded() {\n        if (this.insuranceFundStakeAccountAndSlot === undefined) {\n            await this.fetch();\n        }\n    }\n    async fetch() {\n        var _a, _b;\n        try {\n            const dataAndContext = await this.program.account.insuranceFundStake.fetchAndContext(this.insuranceFundStakeAccountPublicKey, this.accountLoader.commitment);\n            if (dataAndContext.context.slot >\n                ((_b = (_a = this.insuranceFundStakeAccountAndSlot) === null || _a === void 0 ? void 0 : _a.slot) !== null && _b !== void 0 ? _b : 0)) {\n                this.insuranceFundStakeAccountAndSlot = {\n                    data: dataAndContext.data,\n                    slot: dataAndContext.context.slot,\n                };\n            }\n        }\n        catch (e) {\n            console.log(`PollingInsuranceFundStakeAccountSubscriber.fetch() InsuranceFundStake does not exist: ${e.message}`);\n        }\n    }\n    doesAccountExist() {\n        return this.insuranceFundStakeAccountAndSlot !== undefined;\n    }\n    async unsubscribe() {\n        if (!this.isSubscribed) {\n            return;\n        }\n        this.accountLoader.removeAccount(this.insuranceFundStakeAccountPublicKey, this.callbackId);\n        this.callbackId = undefined;\n        this.accountLoader.removeErrorCallbacks(this.errorCallbackId);\n        this.errorCallbackId = undefined;\n        this.isSubscribed = false;\n    }\n    assertIsSubscribed() {\n        if (!this.isSubscribed) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` before using this function');\n        }\n    }\n    getInsuranceFundStakeAccountAndSlot() {\n        this.assertIsSubscribed();\n        return this.insuranceFundStakeAccountAndSlot;\n    }\n    didSubscriptionSucceed() {\n        return !!this.insuranceFundStakeAccountAndSlot;\n    }\n    updateData(insuranceFundStake, slot) {\n        if (!this.insuranceFundStakeAccountAndSlot ||\n            this.insuranceFundStakeAccountAndSlot.slot < slot) {\n            this.insuranceFundStakeAccountAndSlot = {\n                data: insuranceFundStake,\n                slot,\n            };\n            this.eventEmitter.emit('insuranceFundStakeAccountUpdate', insuranceFundStake);\n            this.eventEmitter.emit('update');\n        }\n    }\n}\nexports.PollingInsuranceFundStakeAccountSubscriber = PollingInsuranceFundStakeAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,0CAA0C,GAAG,KAAK;AAC1D,MAAM;AACN,MAAM;AACN,MAAM;IACF,YAAY,OAAO,EAAE,SAAS,EAAE,aAAa,CAAE;QAC3C,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,kCAAkC,GAAG;QAC1C,IAAI,CAAC,aAAa,GAAG;QACrB,IAAI,CAAC,YAAY,GAAG,IAAI,SAAS,YAAY;IACjD;IACA,MAAM,UAAU,kBAAkB,EAAE;QAChC,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,OAAO;QACX;QACA,IAAI,oBAAoB;YACpB,IAAI,CAAC,gCAAgC,GAAG;gBACpC,MAAM;gBACN,MAAM;YACV;QACJ;QACA,MAAM,IAAI,CAAC,kBAAkB;QAC7B,IAAI,IAAI,CAAC,gBAAgB,IAAI;YACzB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,YAAY,GAAG;QACpB,OAAO;IACX;IACA,MAAM,qBAAqB;QACvB,IAAI,IAAI,CAAC,UAAU,EAAE;YACjB;QACJ;QACA,IAAI,CAAC,UAAU,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,IAAI,CAAC,kCAAkC,EAAE,CAAC,QAAQ;YACpG,IAAI,CAAC,QAAQ;gBACT;YACJ;YACA,IAAI,IAAI,CAAC,gCAAgC,IACrC,IAAI,CAAC,gCAAgC,CAAC,IAAI,GAAG,MAAM;gBACnD;YACJ;YACA,MAAM,UAAU,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,sBAAsB;YACtF,IAAI,CAAC,gCAAgC,GAAG;gBAAE,MAAM;gBAAS;YAAK;YAC9D,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,mCAAmC;YAC1D,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC;YACzD,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS;QACpC;IACJ;IACA,MAAM,kBAAkB;QACpB,IAAI,IAAI,CAAC,gCAAgC,KAAK,WAAW;YACrD,MAAM,IAAI,CAAC,KAAK;QACpB;IACJ;IACA,MAAM,QAAQ;QACV,IAAI,IAAI;QACR,IAAI;YACA,MAAM,iBAAiB,MAAM,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,kBAAkB,CAAC,eAAe,CAAC,IAAI,CAAC,kCAAkC,EAAE,IAAI,CAAC,aAAa,CAAC,UAAU;YAC3J,IAAI,eAAe,OAAO,CAAC,IAAI,GAC3B,CAAC,CAAC,KAAK,CAAC,KAAK,IAAI,CAAC,gCAAgC,MAAM,QAAQ,OAAO,KAAK,IAAI,KAAK,IAAI,GAAG,IAAI,MAAM,QAAQ,OAAO,KAAK,IAAI,KAAK,CAAC,GAAG;gBACvI,IAAI,CAAC,gCAAgC,GAAG;oBACpC,MAAM,eAAe,IAAI;oBACzB,MAAM,eAAe,OAAO,CAAC,IAAI;gBACrC;YACJ;QACJ,EACA,OAAO,GAAG;YACN,QAAQ,GAAG,CAAC,CAAC,sFAAsF,EAAE,EAAE,OAAO,EAAE;QACpH;IACJ;IACA,mBAAmB;QACf,OAAO,IAAI,CAAC,gCAAgC,KAAK;IACrD;IACA,MAAM,cAAc;QAChB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB;QACJ;QACA,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC,IAAI,CAAC,kCAAkC,EAAE,IAAI,CAAC,UAAU;QACzF,IAAI,CAAC,UAAU,GAAG;QAClB,IAAI,CAAC,aAAa,CAAC,oBAAoB,CAAC,IAAI,CAAC,eAAe;QAC5D,IAAI,CAAC,eAAe,GAAG;QACvB,IAAI,CAAC,YAAY,GAAG;IACxB;IACA,qBAAqB;QACjB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,MAAM,IAAI,QAAQ,kBAAkB,CAAC;QACzC;IACJ;IACA,sCAAsC;QAClC,IAAI,CAAC,kBAAkB;QACvB,OAAO,IAAI,CAAC,gCAAgC;IAChD;IACA,yBAAyB;QACrB,OAAO,CAAC,CAAC,IAAI,CAAC,gCAAgC;IAClD;IACA,WAAW,kBAAkB,EAAE,IAAI,EAAE;QACjC,IAAI,CAAC,IAAI,CAAC,gCAAgC,IACtC,IAAI,CAAC,gCAAgC,CAAC,IAAI,GAAG,MAAM;YACnD,IAAI,CAAC,gCAAgC,GAAG;gBACpC,MAAM;gBACN;YACJ;YACA,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,mCAAmC;YAC1D,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;IACJ;AACJ;AACA,QAAQ,0CAA0C,GAAG","ignoreList":[0]}},
    {"offset": {"line": 3894, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/pollingHighLeverageModeConfigAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PollingHighLeverageModeConfigAccountSubscriber = void 0;\nconst types_1 = require(\"./types\");\nconst events_1 = require(\"events\");\nclass PollingHighLeverageModeConfigAccountSubscriber {\n    constructor(program, publicKey, accountLoader) {\n        this.isSubscribed = false;\n        this.program = program;\n        this.highLeverageModeConfigAccountPublicKey = publicKey;\n        this.accountLoader = accountLoader;\n        this.eventEmitter = new events_1.EventEmitter();\n    }\n    async subscribe(highLeverageModeConfig) {\n        if (this.isSubscribed) {\n            return true;\n        }\n        if (highLeverageModeConfig) {\n            this.highLeverageModeConfigAccountAndSlot = {\n                data: highLeverageModeConfig,\n                slot: undefined,\n            };\n        }\n        await this.addToAccountLoader();\n        await this.fetchIfUnloaded();\n        if (this.doesAccountExist()) {\n            this.eventEmitter.emit('update');\n        }\n        this.isSubscribed = true;\n        return true;\n    }\n    async addToAccountLoader() {\n        if (this.callbackId) {\n            return;\n        }\n        this.callbackId = await this.accountLoader.addAccount(this.highLeverageModeConfigAccountPublicKey, (buffer, slot) => {\n            if (!buffer) {\n                return;\n            }\n            if (this.highLeverageModeConfigAccountAndSlot &&\n                this.highLeverageModeConfigAccountAndSlot.slot > slot) {\n                return;\n            }\n            const account = this.program.account.user.coder.accounts.decode('HighLeverageModeConfig', buffer);\n            this.highLeverageModeConfigAccountAndSlot = { data: account, slot };\n            this.eventEmitter.emit('highLeverageModeConfigAccountUpdate', account);\n            this.eventEmitter.emit('update');\n        });\n        this.errorCallbackId = this.accountLoader.addErrorCallbacks((error) => {\n            this.eventEmitter.emit('error', error);\n        });\n    }\n    async fetchIfUnloaded() {\n        if (this.highLeverageModeConfigAccountAndSlot === undefined) {\n            await this.fetch();\n        }\n    }\n    async fetch() {\n        var _a, _b;\n        try {\n            const dataAndContext = await this.program.account.highLeverageModeConfig.fetchAndContext(this.highLeverageModeConfigAccountPublicKey, this.accountLoader.commitment);\n            if (dataAndContext.context.slot >\n                ((_b = (_a = this.highLeverageModeConfigAccountAndSlot) === null || _a === void 0 ? void 0 : _a.slot) !== null && _b !== void 0 ? _b : 0)) {\n                this.highLeverageModeConfigAccountAndSlot = {\n                    data: dataAndContext.data,\n                    slot: dataAndContext.context.slot,\n                };\n            }\n        }\n        catch (e) {\n            console.log(`PollingHighLeverageModeConfigAccountSubscriber.fetch() HighLeverageModeConfig does not exist: ${e.message}`);\n        }\n    }\n    doesAccountExist() {\n        return this.highLeverageModeConfigAccountAndSlot !== undefined;\n    }\n    async unsubscribe() {\n        if (!this.isSubscribed) {\n            return;\n        }\n        this.accountLoader.removeAccount(this.highLeverageModeConfigAccountPublicKey, this.callbackId);\n        this.callbackId = undefined;\n        this.accountLoader.removeErrorCallbacks(this.errorCallbackId);\n        this.errorCallbackId = undefined;\n        this.isSubscribed = false;\n    }\n    assertIsSubscribed() {\n        if (!this.isSubscribed) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` before using this function');\n        }\n    }\n    getHighLeverageModeConfigAccountAndSlot() {\n        this.assertIsSubscribed();\n        return this.highLeverageModeConfigAccountAndSlot;\n    }\n    didSubscriptionSucceed() {\n        return !!this.highLeverageModeConfigAccountAndSlot;\n    }\n    updateData(highLeverageModeConfig, slot) {\n        if (!this.highLeverageModeConfigAccountAndSlot ||\n            this.highLeverageModeConfigAccountAndSlot.slot < slot) {\n            this.highLeverageModeConfigAccountAndSlot = {\n                data: highLeverageModeConfig,\n                slot,\n            };\n            this.eventEmitter.emit('highLeverageModeConfigAccountUpdate', highLeverageModeConfig);\n            this.eventEmitter.emit('update');\n        }\n    }\n}\nexports.PollingHighLeverageModeConfigAccountSubscriber = PollingHighLeverageModeConfigAccountSubscriber;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 4009, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/basicUserAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BasicUserAccountSubscriber = void 0;\nconst events_1 = require(\"events\");\n/**\n * Basic implementation of UserAccountSubscriber. It will only take in UserAccount\n * data during initialization and will not fetch or subscribe to updates.\n */\nclass BasicUserAccountSubscriber {\n    constructor(userAccountPublicKey, data, slot) {\n        this.isSubscribed = true;\n        this.eventEmitter = new events_1.EventEmitter();\n        this.userAccountPublicKey = userAccountPublicKey;\n        this.user = { data, slot };\n    }\n    async subscribe(_userAccount) {\n        return true;\n    }\n    async addToAccountLoader() { }\n    async fetch() { }\n    doesAccountExist() {\n        return this.user !== undefined;\n    }\n    async unsubscribe() { }\n    assertIsSubscribed() { }\n    getUserAccountAndSlot() {\n        return this.user;\n    }\n    updateData(userAccount, slot) {\n        var _a;\n        if (!this.user || slot >= ((_a = this.user.slot) !== null && _a !== void 0 ? _a : 0)) {\n            this.user = { data: userAccount, slot };\n            this.eventEmitter.emit('userAccountUpdate', userAccount);\n            this.eventEmitter.emit('update');\n        }\n    }\n}\nexports.BasicUserAccountSubscriber = BasicUserAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,0BAA0B,GAAG,KAAK;AAC1C,MAAM;AACN;;;CAGC,GACD,MAAM;IACF,YAAY,oBAAoB,EAAE,IAAI,EAAE,IAAI,CAAE;QAC1C,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,YAAY,GAAG,IAAI,SAAS,YAAY;QAC7C,IAAI,CAAC,oBAAoB,GAAG;QAC5B,IAAI,CAAC,IAAI,GAAG;YAAE;YAAM;QAAK;IAC7B;IACA,MAAM,UAAU,YAAY,EAAE;QAC1B,OAAO;IACX;IACA,MAAM,qBAAqB,CAAE;IAC7B,MAAM,QAAQ,CAAE;IAChB,mBAAmB;QACf,OAAO,IAAI,CAAC,IAAI,KAAK;IACzB;IACA,MAAM,cAAc,CAAE;IACtB,qBAAqB,CAAE;IACvB,wBAAwB;QACpB,OAAO,IAAI,CAAC,IAAI;IACpB;IACA,WAAW,WAAW,EAAE,IAAI,EAAE;QAC1B,IAAI;QACJ,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,QAAQ,CAAC,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,IAAI,MAAM,QAAQ,OAAO,KAAK,IAAI,KAAK,CAAC,GAAG;YAClF,IAAI,CAAC,IAAI,GAAG;gBAAE,MAAM;gBAAa;YAAK;YACtC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,qBAAqB;YAC5C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;IACJ;AACJ;AACA,QAAQ,0BAA0B,GAAG","ignoreList":[0]}},
    {"offset": {"line": 4057, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/oneShotUserAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.OneShotUserAccountSubscriber = void 0;\nconst basicUserAccountSubscriber_1 = require(\"./basicUserAccountSubscriber\");\n/**\n * Simple implementation of UserAccountSubscriber. It will fetch the UserAccount\n * date on subscribe (or call to fetch) if no account data is provided on init.\n * Expect to use only 1 RPC call unless you call fetch repeatedly.\n */\nclass OneShotUserAccountSubscriber extends basicUserAccountSubscriber_1.BasicUserAccountSubscriber {\n    constructor(program, userAccountPublicKey, data, slot, commitment) {\n        super(userAccountPublicKey, data, slot);\n        this.program = program;\n        this.commitment = commitment !== null && commitment !== void 0 ? commitment : 'confirmed';\n    }\n    async subscribe(userAccount) {\n        if (userAccount) {\n            this.user = { data: userAccount, slot: this.user.slot };\n            return true;\n        }\n        await this.fetchIfUnloaded();\n        if (this.doesAccountExist()) {\n            this.eventEmitter.emit('update');\n        }\n        return true;\n    }\n    async fetchIfUnloaded() {\n        if (this.user.data === undefined) {\n            await this.fetch();\n        }\n    }\n    async fetch() {\n        var _a, _b;\n        try {\n            const dataAndContext = await this.program.account.user.fetchAndContext(this.userAccountPublicKey, this.commitment);\n            if (dataAndContext.context.slot > ((_b = (_a = this.user) === null || _a === void 0 ? void 0 : _a.slot) !== null && _b !== void 0 ? _b : 0)) {\n                this.user = {\n                    data: dataAndContext.data,\n                    slot: dataAndContext.context.slot,\n                };\n            }\n        }\n        catch (e) {\n            console.error(`OneShotUserAccountSubscriber.fetch() UserAccount does not exist: ${e.message}`);\n        }\n    }\n}\nexports.OneShotUserAccountSubscriber = OneShotUserAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,4BAA4B,GAAG,KAAK;AAC5C,MAAM;AACN;;;;CAIC,GACD,MAAM,qCAAqC,6BAA6B,0BAA0B;IAC9F,YAAY,OAAO,EAAE,oBAAoB,EAAE,IAAI,EAAE,IAAI,EAAE,UAAU,CAAE;QAC/D,KAAK,CAAC,sBAAsB,MAAM;QAClC,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,UAAU,GAAG,eAAe,QAAQ,eAAe,KAAK,IAAI,aAAa;IAClF;IACA,MAAM,UAAU,WAAW,EAAE;QACzB,IAAI,aAAa;YACb,IAAI,CAAC,IAAI,GAAG;gBAAE,MAAM;gBAAa,MAAM,IAAI,CAAC,IAAI,CAAC,IAAI;YAAC;YACtD,OAAO;QACX;QACA,MAAM,IAAI,CAAC,eAAe;QAC1B,IAAI,IAAI,CAAC,gBAAgB,IAAI;YACzB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,OAAO;IACX;IACA,MAAM,kBAAkB;QACpB,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,KAAK,WAAW;YAC9B,MAAM,IAAI,CAAC,KAAK;QACpB;IACJ;IACA,MAAM,QAAQ;QACV,IAAI,IAAI;QACR,IAAI;YACA,MAAM,iBAAiB,MAAM,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,oBAAoB,EAAE,IAAI,CAAC,UAAU;YACjH,IAAI,eAAe,OAAO,CAAC,IAAI,GAAG,CAAC,CAAC,KAAK,CAAC,KAAK,IAAI,CAAC,IAAI,MAAM,QAAQ,OAAO,KAAK,IAAI,KAAK,IAAI,GAAG,IAAI,MAAM,QAAQ,OAAO,KAAK,IAAI,KAAK,CAAC,GAAG;gBACzI,IAAI,CAAC,IAAI,GAAG;oBACR,MAAM,eAAe,IAAI;oBACzB,MAAM,eAAe,OAAO,CAAC,IAAI;gBACrC;YACJ;QACJ,EACA,OAAO,GAAG;YACN,QAAQ,KAAK,CAAC,CAAC,iEAAiE,EAAE,EAAE,OAAO,EAAE;QACjG;IACJ;AACJ;AACA,QAAQ,4BAA4B,GAAG","ignoreList":[0]}},
    {"offset": {"line": 4111, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/basicUserStatsAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BasicUserStatsAccountSubscriber = void 0;\nconst events_1 = require(\"events\");\n/**\n * Basic implementation of UserStatsAccountSubscriber. It will only take in UserStatsAccount\n * data during initialization and will not fetch or subscribe to updates.\n */\nclass BasicUserStatsAccountSubscriber {\n    constructor(userStatsAccountPublicKey, data, slot) {\n        this.isSubscribed = true;\n        this.eventEmitter = new events_1.EventEmitter();\n        this.userStatsAccountPublicKey = userStatsAccountPublicKey;\n        this.userStats = { data, slot };\n    }\n    async subscribe(_userStatsAccount) {\n        return true;\n    }\n    async addToAccountLoader() { }\n    async fetch() { }\n    doesAccountExist() {\n        return this.userStats !== undefined;\n    }\n    async unsubscribe() { }\n    assertIsSubscribed() { }\n    getUserStatsAccountAndSlot() {\n        return this.userStats;\n    }\n    updateData(userStatsAccount, slot) {\n        var _a;\n        if (!this.userStats || slot >= ((_a = this.userStats.slot) !== null && _a !== void 0 ? _a : 0)) {\n            this.userStats = { data: userStatsAccount, slot };\n            this.eventEmitter.emit('userStatsAccountUpdate', userStatsAccount);\n            this.eventEmitter.emit('update');\n        }\n    }\n}\nexports.BasicUserStatsAccountSubscriber = BasicUserStatsAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,+BAA+B,GAAG,KAAK;AAC/C,MAAM;AACN;;;CAGC,GACD,MAAM;IACF,YAAY,yBAAyB,EAAE,IAAI,EAAE,IAAI,CAAE;QAC/C,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,YAAY,GAAG,IAAI,SAAS,YAAY;QAC7C,IAAI,CAAC,yBAAyB,GAAG;QACjC,IAAI,CAAC,SAAS,GAAG;YAAE;YAAM;QAAK;IAClC;IACA,MAAM,UAAU,iBAAiB,EAAE;QAC/B,OAAO;IACX;IACA,MAAM,qBAAqB,CAAE;IAC7B,MAAM,QAAQ,CAAE;IAChB,mBAAmB;QACf,OAAO,IAAI,CAAC,SAAS,KAAK;IAC9B;IACA,MAAM,cAAc,CAAE;IACtB,qBAAqB,CAAE;IACvB,6BAA6B;QACzB,OAAO,IAAI,CAAC,SAAS;IACzB;IACA,WAAW,gBAAgB,EAAE,IAAI,EAAE;QAC/B,IAAI;QACJ,IAAI,CAAC,IAAI,CAAC,SAAS,IAAI,QAAQ,CAAC,CAAC,KAAK,IAAI,CAAC,SAAS,CAAC,IAAI,MAAM,QAAQ,OAAO,KAAK,IAAI,KAAK,CAAC,GAAG;YAC5F,IAAI,CAAC,SAAS,GAAG;gBAAE,MAAM;gBAAkB;YAAK;YAChD,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,0BAA0B;YACjD,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;IACJ;AACJ;AACA,QAAQ,+BAA+B,GAAG","ignoreList":[0]}},
    {"offset": {"line": 4159, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/oneShotUserStatsAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.OneShotUserStatsAccountSubscriber = void 0;\nconst basicUserStatsAccountSubscriber_1 = require(\"./basicUserStatsAccountSubscriber\");\n/**\n * Simple implementation of UserStatsAccountSubscriber. It will fetch the UserStatsAccount\n * data on subscribe (or call to fetch) if no account data is provided on init.\n * Expect to use only 1 RPC call unless you call fetch repeatedly.\n */\nclass OneShotUserStatsAccountSubscriber extends basicUserStatsAccountSubscriber_1.BasicUserStatsAccountSubscriber {\n    constructor(program, userStatsAccountPublicKey, data, slot, commitment) {\n        super(userStatsAccountPublicKey, data, slot);\n        this.program = program;\n        this.commitment = commitment !== null && commitment !== void 0 ? commitment : 'confirmed';\n    }\n    async subscribe(userStatsAccount) {\n        if (userStatsAccount) {\n            this.userStats = { data: userStatsAccount, slot: this.userStats.slot };\n            return true;\n        }\n        await this.fetchIfUnloaded();\n        if (this.doesAccountExist()) {\n            this.eventEmitter.emit('update');\n        }\n        return true;\n    }\n    async fetchIfUnloaded() {\n        if (this.userStats.data === undefined) {\n            await this.fetch();\n        }\n    }\n    async fetch() {\n        var _a, _b;\n        try {\n            const dataAndContext = await this.program.account.userStats.fetchAndContext(this.userStatsAccountPublicKey, this.commitment);\n            if (dataAndContext.context.slot > ((_b = (_a = this.userStats) === null || _a === void 0 ? void 0 : _a.slot) !== null && _b !== void 0 ? _b : 0)) {\n                this.userStats = {\n                    data: dataAndContext.data,\n                    slot: dataAndContext.context.slot,\n                };\n            }\n        }\n        catch (e) {\n            console.error(`OneShotUserStatsAccountSubscriber.fetch() UserStatsAccount does not exist: ${e.message}`);\n        }\n    }\n}\nexports.OneShotUserStatsAccountSubscriber = OneShotUserStatsAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,iCAAiC,GAAG,KAAK;AACjD,MAAM;AACN;;;;CAIC,GACD,MAAM,0CAA0C,kCAAkC,+BAA+B;IAC7G,YAAY,OAAO,EAAE,yBAAyB,EAAE,IAAI,EAAE,IAAI,EAAE,UAAU,CAAE;QACpE,KAAK,CAAC,2BAA2B,MAAM;QACvC,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,UAAU,GAAG,eAAe,QAAQ,eAAe,KAAK,IAAI,aAAa;IAClF;IACA,MAAM,UAAU,gBAAgB,EAAE;QAC9B,IAAI,kBAAkB;YAClB,IAAI,CAAC,SAAS,GAAG;gBAAE,MAAM;gBAAkB,MAAM,IAAI,CAAC,SAAS,CAAC,IAAI;YAAC;YACrE,OAAO;QACX;QACA,MAAM,IAAI,CAAC,eAAe;QAC1B,IAAI,IAAI,CAAC,gBAAgB,IAAI;YACzB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,OAAO;IACX;IACA,MAAM,kBAAkB;QACpB,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,KAAK,WAAW;YACnC,MAAM,IAAI,CAAC,KAAK;QACpB;IACJ;IACA,MAAM,QAAQ;QACV,IAAI,IAAI;QACR,IAAI;YACA,MAAM,iBAAiB,MAAM,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,eAAe,CAAC,IAAI,CAAC,yBAAyB,EAAE,IAAI,CAAC,UAAU;YAC3H,IAAI,eAAe,OAAO,CAAC,IAAI,GAAG,CAAC,CAAC,KAAK,CAAC,KAAK,IAAI,CAAC,SAAS,MAAM,QAAQ,OAAO,KAAK,IAAI,KAAK,IAAI,GAAG,IAAI,MAAM,QAAQ,OAAO,KAAK,IAAI,KAAK,CAAC,GAAG;gBAC9I,IAAI,CAAC,SAAS,GAAG;oBACb,MAAM,eAAe,IAAI;oBACzB,MAAM,eAAe,OAAO,CAAC,IAAI;gBACrC;YACJ;QACJ,EACA,OAAO,GAAG;YACN,QAAQ,KAAK,CAAC,CAAC,2EAA2E,EAAE,EAAE,OAAO,EAAE;QAC3G;IACJ;AACJ;AACA,QAAQ,iCAAiC,GAAG","ignoreList":[0]}},
    {"offset": {"line": 4213, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/webSocketUserAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebSocketUserAccountSubscriber = void 0;\nconst types_1 = require(\"./types\");\nconst events_1 = require(\"events\");\nconst webSocketAccountSubscriber_1 = require(\"./webSocketAccountSubscriber\");\nclass WebSocketUserAccountSubscriber {\n    constructor(program, userAccountPublicKey, resubOpts, commitment) {\n        this.isSubscribed = false;\n        this.program = program;\n        this.resubOpts = resubOpts;\n        this.userAccountPublicKey = userAccountPublicKey;\n        this.eventEmitter = new events_1.EventEmitter();\n        this.commitment = commitment;\n    }\n    async subscribe(userAccount) {\n        if (this.isSubscribed) {\n            return true;\n        }\n        this.userDataAccountSubscriber = new webSocketAccountSubscriber_1.WebSocketAccountSubscriber('user', this.program, this.userAccountPublicKey, undefined, this.resubOpts, this.commitment);\n        if (userAccount) {\n            this.userDataAccountSubscriber.setData(userAccount);\n        }\n        await this.userDataAccountSubscriber.subscribe((data) => {\n            this.eventEmitter.emit('userAccountUpdate', data);\n            this.eventEmitter.emit('update');\n        });\n        this.eventEmitter.emit('update');\n        this.isSubscribed = true;\n        return true;\n    }\n    async fetch() {\n        await Promise.all([this.userDataAccountSubscriber.fetch()]);\n    }\n    async unsubscribe() {\n        if (!this.isSubscribed) {\n            return;\n        }\n        await Promise.all([this.userDataAccountSubscriber.unsubscribe()]);\n        this.isSubscribed = false;\n    }\n    assertIsSubscribed() {\n        if (!this.isSubscribed) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` before using this function');\n        }\n    }\n    getUserAccountAndSlot() {\n        this.assertIsSubscribed();\n        return this.userDataAccountSubscriber.dataAndSlot;\n    }\n    updateData(userAccount, slot) {\n        var _a;\n        const currentDataSlot = ((_a = this.userDataAccountSubscriber.dataAndSlot) === null || _a === void 0 ? void 0 : _a.slot) || 0;\n        if (currentDataSlot <= slot) {\n            this.userDataAccountSubscriber.setData(userAccount, slot);\n            this.eventEmitter.emit('userAccountUpdate', userAccount);\n            this.eventEmitter.emit('update');\n        }\n    }\n}\nexports.WebSocketUserAccountSubscriber = WebSocketUserAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,8BAA8B,GAAG,KAAK;AAC9C,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;IACF,YAAY,OAAO,EAAE,oBAAoB,EAAE,SAAS,EAAE,UAAU,CAAE;QAC9D,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,CAAC,oBAAoB,GAAG;QAC5B,IAAI,CAAC,YAAY,GAAG,IAAI,SAAS,YAAY;QAC7C,IAAI,CAAC,UAAU,GAAG;IACtB;IACA,MAAM,UAAU,WAAW,EAAE;QACzB,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,OAAO;QACX;QACA,IAAI,CAAC,yBAAyB,GAAG,IAAI,6BAA6B,0BAA0B,CAAC,QAAQ,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,oBAAoB,EAAE,WAAW,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU;QACxL,IAAI,aAAa;YACb,IAAI,CAAC,yBAAyB,CAAC,OAAO,CAAC;QAC3C;QACA,MAAM,IAAI,CAAC,yBAAyB,CAAC,SAAS,CAAC,CAAC;YAC5C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,qBAAqB;YAC5C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QACvB,IAAI,CAAC,YAAY,GAAG;QACpB,OAAO;IACX;IACA,MAAM,QAAQ;QACV,MAAM,QAAQ,GAAG,CAAC;YAAC,IAAI,CAAC,yBAAyB,CAAC,KAAK;SAAG;IAC9D;IACA,MAAM,cAAc;QAChB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB;QACJ;QACA,MAAM,QAAQ,GAAG,CAAC;YAAC,IAAI,CAAC,yBAAyB,CAAC,WAAW;SAAG;QAChE,IAAI,CAAC,YAAY,GAAG;IACxB;IACA,qBAAqB;QACjB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,MAAM,IAAI,QAAQ,kBAAkB,CAAC;QACzC;IACJ;IACA,wBAAwB;QACpB,IAAI,CAAC,kBAAkB;QACvB,OAAO,IAAI,CAAC,yBAAyB,CAAC,WAAW;IACrD;IACA,WAAW,WAAW,EAAE,IAAI,EAAE;QAC1B,IAAI;QACJ,MAAM,kBAAkB,CAAC,CAAC,KAAK,IAAI,CAAC,yBAAyB,CAAC,WAAW,MAAM,QAAQ,OAAO,KAAK,IAAI,KAAK,IAAI,GAAG,IAAI,KAAK;QAC5H,IAAI,mBAAmB,MAAM;YACzB,IAAI,CAAC,yBAAyB,CAAC,OAAO,CAAC,aAAa;YACpD,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,qBAAqB;YAC5C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;IACJ;AACJ;AACA,QAAQ,8BAA8B,GAAG","ignoreList":[0]}},
    {"offset": {"line": 4283, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/grpcAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.grpcAccountSubscriber = void 0;\nconst web3_js_1 = require(\"@solana/web3.js\");\nconst Buffer = __importStar(require(\"buffer\"));\nconst webSocketAccountSubscriber_1 = require(\"./webSocketAccountSubscriber\");\nconst grpc_1 = require(\"../isomorphic/grpc\");\nclass grpcAccountSubscriber extends webSocketAccountSubscriber_1.WebSocketAccountSubscriber {\n    constructor(client, commitmentLevel, accountName, program, accountPublicKey, decodeBuffer, resubOpts) {\n        super(accountName, program, accountPublicKey, decodeBuffer, resubOpts);\n        this.client = client;\n        this.commitmentLevel = commitmentLevel;\n    }\n    static async create(grpcConfigs, accountName, program, accountPublicKey, decodeBuffer, resubOpts, clientProp) {\n        var _a, _b;\n        const client = clientProp\n            ? clientProp\n            : await (0, grpc_1.createClient)(grpcConfigs.endpoint, grpcConfigs.token, (_a = grpcConfigs.channelOptions) !== null && _a !== void 0 ? _a : {});\n        const commitmentLevel = \n        // @ts-ignore :: isomorphic exported enum fails typescript but will work at runtime\n        (_b = grpcConfigs.commitmentLevel) !== null && _b !== void 0 ? _b : grpc_1.CommitmentLevel.CONFIRMED;\n        return new grpcAccountSubscriber(client, commitmentLevel, accountName, program, accountPublicKey, decodeBuffer, resubOpts);\n    }\n    async subscribe(onChange) {\n        if (this.listenerId != null || this.isUnsubscribing) {\n            return;\n        }\n        this.onChange = onChange;\n        if (!this.dataAndSlot) {\n            await this.fetch();\n        }\n        // Subscribe with grpc\n        this.stream =\n            (await this.client.subscribe());\n        const request = {\n            slots: {},\n            accounts: {\n                account: {\n                    account: [this.accountPublicKey.toString()],\n                    owner: [],\n                    filters: [],\n                },\n            },\n            transactions: {},\n            blocks: {},\n            blocksMeta: {},\n            accountsDataSlice: [],\n            commitment: this.commitmentLevel,\n            entry: {},\n            transactionsStatus: {},\n        };\n        this.stream.on('data', (chunk) => {\n            var _a;\n            if (!chunk.account) {\n                return;\n            }\n            const slot = Number(chunk.account.slot);\n            const accountInfo = {\n                owner: new web3_js_1.PublicKey(chunk.account.account.owner),\n                lamports: Number(chunk.account.account.lamports),\n                data: Buffer.Buffer.from(chunk.account.account.data),\n                executable: chunk.account.account.executable,\n                rentEpoch: Number(chunk.account.account.rentEpoch),\n            };\n            if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs) {\n                this.receivingData = true;\n                clearTimeout(this.timeoutId);\n                this.handleRpcResponse({\n                    slot,\n                }, accountInfo);\n                this.setTimeout();\n            }\n            else {\n                this.handleRpcResponse({\n                    slot,\n                }, accountInfo);\n            }\n        });\n        return new Promise((resolve, reject) => {\n            this.stream.write(request, (err) => {\n                var _a;\n                if (err === null || err === undefined) {\n                    this.listenerId = 1;\n                    if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs) {\n                        this.receivingData = true;\n                        this.setTimeout();\n                    }\n                    resolve();\n                }\n                else {\n                    reject(err);\n                }\n            });\n        }).catch((reason) => {\n            console.error(reason);\n            throw reason;\n        });\n    }\n    async unsubscribe(onResub = false) {\n        if (!onResub && this.resubOpts) {\n            this.resubOpts.resubTimeoutMs = undefined;\n        }\n        this.isUnsubscribing = true;\n        clearTimeout(this.timeoutId);\n        this.timeoutId = undefined;\n        if (this.listenerId != null) {\n            const promise = new Promise((resolve, reject) => {\n                const request = {\n                    slots: {},\n                    accounts: {},\n                    transactions: {},\n                    blocks: {},\n                    blocksMeta: {},\n                    accountsDataSlice: [],\n                    entry: {},\n                    transactionsStatus: {},\n                };\n                this.stream.write(request, (err) => {\n                    if (err === null || err === undefined) {\n                        this.listenerId = undefined;\n                        this.isUnsubscribing = false;\n                        resolve();\n                    }\n                    else {\n                        reject(err);\n                    }\n                });\n            }).catch((reason) => {\n                console.error(reason);\n                throw reason;\n            });\n            return promise;\n        }\n        else {\n            this.isUnsubscribing = false;\n        }\n    }\n}\nexports.grpcAccountSubscriber = grpcAccountSubscriber;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 4454, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/grpcUserAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.grpcUserAccountSubscriber = void 0;\nconst webSocketUserAccountSubscriber_1 = require(\"./webSocketUserAccountSubscriber\");\nconst grpcAccountSubscriber_1 = require(\"./grpcAccountSubscriber\");\nclass grpcUserAccountSubscriber extends webSocketUserAccountSubscriber_1.WebSocketUserAccountSubscriber {\n    constructor(grpcConfigs, program, userAccountPublicKey, resubOpts) {\n        super(program, userAccountPublicKey, resubOpts);\n        this.grpcConfigs = grpcConfigs;\n    }\n    async subscribe(userAccount) {\n        if (this.isSubscribed) {\n            return true;\n        }\n        this.userDataAccountSubscriber = await grpcAccountSubscriber_1.grpcAccountSubscriber.create(this.grpcConfigs, 'user', this.program, this.userAccountPublicKey, undefined, this.resubOpts);\n        if (userAccount) {\n            this.userDataAccountSubscriber.setData(userAccount);\n        }\n        await this.userDataAccountSubscriber.subscribe((data) => {\n            this.eventEmitter.emit('userAccountUpdate', data);\n            this.eventEmitter.emit('update');\n        });\n        this.eventEmitter.emit('update');\n        this.isSubscribed = true;\n        return true;\n    }\n}\nexports.grpcUserAccountSubscriber = grpcUserAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,yBAAyB,GAAG,KAAK;AACzC,MAAM;AACN,MAAM;AACN,MAAM,kCAAkC,iCAAiC,8BAA8B;IACnG,YAAY,WAAW,EAAE,OAAO,EAAE,oBAAoB,EAAE,SAAS,CAAE;QAC/D,KAAK,CAAC,SAAS,sBAAsB;QACrC,IAAI,CAAC,WAAW,GAAG;IACvB;IACA,MAAM,UAAU,WAAW,EAAE;QACzB,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,OAAO;QACX;QACA,IAAI,CAAC,yBAAyB,GAAG,MAAM,wBAAwB,qBAAqB,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,EAAE,QAAQ,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,oBAAoB,EAAE,WAAW,IAAI,CAAC,SAAS;QACxL,IAAI,aAAa;YACb,IAAI,CAAC,yBAAyB,CAAC,OAAO,CAAC;QAC3C;QACA,MAAM,IAAI,CAAC,yBAAyB,CAAC,SAAS,CAAC,CAAC;YAC5C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,qBAAqB;YAC5C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QACvB,IAAI,CAAC,YAAY,GAAG;QACpB,OAAO;IACX;AACJ;AACA,QAAQ,yBAAyB,GAAG","ignoreList":[0]}},
    {"offset": {"line": 4487, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/webSocketUserStatsAccountSubsriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WebSocketUserStatsAccountSubscriber = void 0;\nconst types_1 = require(\"./types\");\nconst events_1 = require(\"events\");\nconst webSocketAccountSubscriber_1 = require(\"./webSocketAccountSubscriber\");\nclass WebSocketUserStatsAccountSubscriber {\n    constructor(program, userStatsAccountPublicKey, resubOpts, commitment) {\n        this.isSubscribed = false;\n        this.program = program;\n        this.userStatsAccountPublicKey = userStatsAccountPublicKey;\n        this.eventEmitter = new events_1.EventEmitter();\n        this.resubOpts = resubOpts;\n        this.commitment = commitment;\n    }\n    async subscribe(userStatsAccount) {\n        if (this.isSubscribed) {\n            return true;\n        }\n        this.userStatsAccountSubscriber = new webSocketAccountSubscriber_1.WebSocketAccountSubscriber('userStats', this.program, this.userStatsAccountPublicKey, undefined, this.resubOpts, this.commitment);\n        if (userStatsAccount) {\n            this.userStatsAccountSubscriber.setData(userStatsAccount);\n        }\n        await this.userStatsAccountSubscriber.subscribe((data) => {\n            this.eventEmitter.emit('userStatsAccountUpdate', data);\n            this.eventEmitter.emit('update');\n        });\n        this.eventEmitter.emit('update');\n        this.isSubscribed = true;\n        return true;\n    }\n    async fetch() {\n        await Promise.all([this.userStatsAccountSubscriber.fetch()]);\n    }\n    async unsubscribe() {\n        if (!this.isSubscribed) {\n            return;\n        }\n        await Promise.all([this.userStatsAccountSubscriber.unsubscribe()]);\n        this.isSubscribed = false;\n    }\n    assertIsSubscribed() {\n        if (!this.isSubscribed) {\n            throw new types_1.NotSubscribedError('You must call `subscribe` before using this function');\n        }\n    }\n    getUserStatsAccountAndSlot() {\n        this.assertIsSubscribed();\n        return this.userStatsAccountSubscriber.dataAndSlot;\n    }\n}\nexports.WebSocketUserStatsAccountSubscriber = WebSocketUserStatsAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,mCAAmC,GAAG,KAAK;AACnD,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;IACF,YAAY,OAAO,EAAE,yBAAyB,EAAE,SAAS,EAAE,UAAU,CAAE;QACnE,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,yBAAyB,GAAG;QACjC,IAAI,CAAC,YAAY,GAAG,IAAI,SAAS,YAAY;QAC7C,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,CAAC,UAAU,GAAG;IACtB;IACA,MAAM,UAAU,gBAAgB,EAAE;QAC9B,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,OAAO;QACX;QACA,IAAI,CAAC,0BAA0B,GAAG,IAAI,6BAA6B,0BAA0B,CAAC,aAAa,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,yBAAyB,EAAE,WAAW,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU;QACnM,IAAI,kBAAkB;YAClB,IAAI,CAAC,0BAA0B,CAAC,OAAO,CAAC;QAC5C;QACA,MAAM,IAAI,CAAC,0BAA0B,CAAC,SAAS,CAAC,CAAC;YAC7C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,0BAA0B;YACjD,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QACvB,IAAI,CAAC,YAAY,GAAG;QACpB,OAAO;IACX;IACA,MAAM,QAAQ;QACV,MAAM,QAAQ,GAAG,CAAC;YAAC,IAAI,CAAC,0BAA0B,CAAC,KAAK;SAAG;IAC/D;IACA,MAAM,cAAc;QAChB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB;QACJ;QACA,MAAM,QAAQ,GAAG,CAAC;YAAC,IAAI,CAAC,0BAA0B,CAAC,WAAW;SAAG;QACjE,IAAI,CAAC,YAAY,GAAG;IACxB;IACA,qBAAqB;QACjB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,MAAM,IAAI,QAAQ,kBAAkB,CAAC;QACzC;IACJ;IACA,6BAA6B;QACzB,IAAI,CAAC,kBAAkB;QACvB,OAAO,IAAI,CAAC,0BAA0B,CAAC,WAAW;IACtD;AACJ;AACA,QAAQ,mCAAmC,GAAG","ignoreList":[0]}},
    {"offset": {"line": 4548, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/grpcUserStatsAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.grpcUserStatsAccountSubscriber = void 0;\nconst webSocketUserStatsAccountSubsriber_1 = require(\"./webSocketUserStatsAccountSubsriber\");\nconst grpcAccountSubscriber_1 = require(\"./grpcAccountSubscriber\");\nclass grpcUserStatsAccountSubscriber extends webSocketUserStatsAccountSubsriber_1.WebSocketUserStatsAccountSubscriber {\n    constructor(grpcConfigs, program, userStatsAccountPublicKey, resubOpts) {\n        super(program, userStatsAccountPublicKey, resubOpts);\n        this.grpcConfigs = grpcConfigs;\n    }\n    async subscribe(userStatsAccount) {\n        if (this.isSubscribed) {\n            return true;\n        }\n        this.userStatsAccountSubscriber = await grpcAccountSubscriber_1.grpcAccountSubscriber.create(this.grpcConfigs, 'userStats', this.program, this.userStatsAccountPublicKey, undefined, this.resubOpts);\n        if (userStatsAccount) {\n            this.userStatsAccountSubscriber.setData(userStatsAccount);\n        }\n        await this.userStatsAccountSubscriber.subscribe((data) => {\n            this.eventEmitter.emit('userStatsAccountUpdate', data);\n            this.eventEmitter.emit('update');\n        });\n        this.eventEmitter.emit('update');\n        this.isSubscribed = true;\n        return true;\n    }\n}\nexports.grpcUserStatsAccountSubscriber = grpcUserStatsAccountSubscriber;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,8BAA8B,GAAG,KAAK;AAC9C,MAAM;AACN,MAAM;AACN,MAAM,uCAAuC,qCAAqC,mCAAmC;IACjH,YAAY,WAAW,EAAE,OAAO,EAAE,yBAAyB,EAAE,SAAS,CAAE;QACpE,KAAK,CAAC,SAAS,2BAA2B;QAC1C,IAAI,CAAC,WAAW,GAAG;IACvB;IACA,MAAM,UAAU,gBAAgB,EAAE;QAC9B,IAAI,IAAI,CAAC,YAAY,EAAE;YACnB,OAAO;QACX;QACA,IAAI,CAAC,0BAA0B,GAAG,MAAM,wBAAwB,qBAAqB,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,EAAE,aAAa,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,yBAAyB,EAAE,WAAW,IAAI,CAAC,SAAS;QACnM,IAAI,kBAAkB;YAClB,IAAI,CAAC,0BAA0B,CAAC,OAAO,CAAC;QAC5C;QACA,MAAM,IAAI,CAAC,0BAA0B,CAAC,SAAS,CAAC,CAAC;YAC7C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,0BAA0B;YACjD,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAC3B;QACA,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QACvB,IAAI,CAAC,YAAY,GAAG;QACpB,OAAO;IACX;AACJ;AACA,QAAQ,8BAA8B,GAAG","ignoreList":[0]}},
    {"offset": {"line": 4581, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/grpcDriftClientAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.grpcDriftClientAccountSubscriber = void 0;\nconst webSocketDriftClientAccountSubscriber_1 = require(\"./webSocketDriftClientAccountSubscriber\");\nconst config_1 = require(\"../config\");\nconst pda_1 = require(\"../addresses/pda\");\nconst grpcAccountSubscriber_1 = require(\"./grpcAccountSubscriber\");\nconst oracleId_1 = require(\"../oracles/oracleId\");\nclass grpcDriftClientAccountSubscriber extends webSocketDriftClientAccountSubscriber_1.WebSocketDriftClientAccountSubscriber {\n    constructor(grpcConfigs, program, perpMarketIndexes, spotMarketIndexes, oracleInfos, shouldFindAllMarketsAndOracles, delistedMarketSetting, resubOpts) {\n        super(program, perpMarketIndexes, spotMarketIndexes, oracleInfos, shouldFindAllMarketsAndOracles, delistedMarketSetting, resubOpts);\n        this.grpcConfigs = grpcConfigs;\n    }\n    async subscribe() {\n        if (this.isSubscribed) {\n            return true;\n        }\n        if (this.isSubscribing) {\n            return await this.subscriptionPromise;\n        }\n        this.isSubscribing = true;\n        this.subscriptionPromise = new Promise((res) => {\n            this.subscriptionPromiseResolver = res;\n        });\n        if (this.shouldFindAllMarketsAndOracles) {\n            const { perpMarketIndexes, perpMarketAccounts, spotMarketIndexes, spotMarketAccounts, oracleInfos, } = await (0, config_1.findAllMarketAndOracles)(this.program);\n            this.perpMarketIndexes = perpMarketIndexes;\n            this.spotMarketIndexes = spotMarketIndexes;\n            this.oracleInfos = oracleInfos;\n            // front run and set the initial data here to save extra gma call in set initial data\n            this.initialPerpMarketAccountData = new Map(perpMarketAccounts.map((market) => [market.marketIndex, market]));\n            this.initialSpotMarketAccountData = new Map(spotMarketAccounts.map((market) => [market.marketIndex, market]));\n        }\n        const statePublicKey = await (0, pda_1.getDriftStateAccountPublicKey)(this.program.programId);\n        // create and activate main state account subscription\n        this.stateAccountSubscriber =\n            await grpcAccountSubscriber_1.grpcAccountSubscriber.create(this.grpcConfigs, 'state', this.program, statePublicKey, undefined, undefined);\n        await this.stateAccountSubscriber.subscribe((data) => {\n            this.eventEmitter.emit('stateAccountUpdate', data);\n            this.eventEmitter.emit('update');\n        });\n        // set initial data to avoid spamming getAccountInfo calls in webSocketAccountSubscriber\n        await this.setInitialData();\n        await Promise.all([\n            // subscribe to market accounts\n            this.subscribeToPerpMarketAccounts(),\n            // subscribe to spot market accounts\n            this.subscribeToSpotMarketAccounts(),\n            // subscribe to oracles\n            this.subscribeToOracles(),\n        ]);\n        this.eventEmitter.emit('update');\n        await this.handleDelistedMarkets();\n        await Promise.all([this.setPerpOracleMap(), this.setSpotOracleMap()]);\n        this.subscriptionPromiseResolver(true);\n        this.isSubscribing = false;\n        this.isSubscribed = true;\n        // delete initial data\n        this.removeInitialData();\n        return true;\n    }\n    async subscribeToSpotMarketAccount(marketIndex) {\n        const marketPublicKey = await (0, pda_1.getSpotMarketPublicKey)(this.program.programId, marketIndex);\n        const accountSubscriber = await grpcAccountSubscriber_1.grpcAccountSubscriber.create(this.grpcConfigs, 'spotMarket', this.program, marketPublicKey, undefined, this.resubOpts);\n        accountSubscriber.setData(this.initialSpotMarketAccountData.get(marketIndex));\n        await accountSubscriber.subscribe((data) => {\n            this.eventEmitter.emit('spotMarketAccountUpdate', data);\n            this.eventEmitter.emit('update');\n        });\n        this.spotMarketAccountSubscribers.set(marketIndex, accountSubscriber);\n        return true;\n    }\n    async subscribeToPerpMarketAccount(marketIndex) {\n        const perpMarketPublicKey = await (0, pda_1.getPerpMarketPublicKey)(this.program.programId, marketIndex);\n        const accountSubscriber = await grpcAccountSubscriber_1.grpcAccountSubscriber.create(this.grpcConfigs, 'perpMarket', this.program, perpMarketPublicKey, undefined, this.resubOpts);\n        accountSubscriber.setData(this.initialPerpMarketAccountData.get(marketIndex));\n        await accountSubscriber.subscribe((data) => {\n            this.eventEmitter.emit('perpMarketAccountUpdate', data);\n            this.eventEmitter.emit('update');\n        });\n        this.perpMarketAccountSubscribers.set(marketIndex, accountSubscriber);\n        return true;\n    }\n    async subscribeToOracle(oracleInfo) {\n        const oracleId = (0, oracleId_1.getOracleId)(oracleInfo.publicKey, oracleInfo.source);\n        const client = this.oracleClientCache.get(oracleInfo.source, this.program.provider.connection, this.program);\n        const accountSubscriber = await grpcAccountSubscriber_1.grpcAccountSubscriber.create(this.grpcConfigs, 'oracle', this.program, oracleInfo.publicKey, (buffer) => {\n            return client.getOraclePriceDataFromBuffer(buffer);\n        }, this.resubOpts);\n        accountSubscriber.setData(this.initialOraclePriceData.get(oracleId));\n        await accountSubscriber.subscribe((data) => {\n            this.eventEmitter.emit('oraclePriceUpdate', oracleInfo.publicKey, oracleInfo.source, data);\n            this.eventEmitter.emit('update');\n        });\n        this.oracleSubscribers.set(oracleId, accountSubscriber);\n        return true;\n    }\n}\nexports.grpcDriftClientAccountSubscriber = grpcDriftClientAccountSubscriber;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 4693, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/grpcProgramAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.grpcProgramAccountSubscriber = void 0;\nconst bs58_1 = __importDefault(require(\"bs58\"));\nconst web3_js_1 = require(\"@solana/web3.js\");\nconst Buffer = __importStar(require(\"buffer\"));\nconst webSocketProgramAccountSubscriber_1 = require(\"./webSocketProgramAccountSubscriber\");\nconst grpc_1 = require(\"../isomorphic/grpc\");\nclass grpcProgramAccountSubscriber extends webSocketProgramAccountSubscriber_1.WebSocketProgramAccountSubscriber {\n    constructor(client, commitmentLevel, subscriptionName, accountDiscriminator, program, decodeBufferFn, options = {\n        filters: [],\n    }, resubOpts) {\n        super(subscriptionName, accountDiscriminator, program, decodeBufferFn, options, resubOpts);\n        this.client = client;\n        this.commitmentLevel = commitmentLevel;\n    }\n    static async create(grpcConfigs, subscriptionName, accountDiscriminator, program, decodeBufferFn, options = {\n        filters: [],\n    }, resubOpts) {\n        var _a, _b;\n        const client = await (0, grpc_1.createClient)(grpcConfigs.endpoint, grpcConfigs.token, (_a = grpcConfigs.channelOptions) !== null && _a !== void 0 ? _a : {});\n        const commitmentLevel = \n        // @ts-ignore :: isomorphic exported enum fails typescript but will work at runtime\n        (_b = grpcConfigs.commitmentLevel) !== null && _b !== void 0 ? _b : grpc_1.CommitmentLevel.CONFIRMED;\n        return new grpcProgramAccountSubscriber(client, commitmentLevel, subscriptionName, accountDiscriminator, program, decodeBufferFn, options, resubOpts);\n    }\n    async subscribe(onChange) {\n        if (this.listenerId != null || this.isUnsubscribing) {\n            return;\n        }\n        this.onChange = onChange;\n        // Subscribe with grpc\n        this.stream =\n            (await this.client.subscribe());\n        const filters = this.options.filters.map((filter) => {\n            return {\n                memcmp: {\n                    offset: filter.memcmp.offset.toString(),\n                    bytes: bs58_1.default.decode(filter.memcmp.bytes),\n                },\n            };\n        });\n        const request = {\n            slots: {},\n            accounts: {\n                drift: {\n                    account: [],\n                    owner: [this.program.programId.toBase58()],\n                    filters,\n                },\n            },\n            transactions: {},\n            blocks: {},\n            blocksMeta: {},\n            accountsDataSlice: [],\n            commitment: this.commitmentLevel,\n            entry: {},\n            transactionsStatus: {},\n        };\n        this.stream.on('data', (chunk) => {\n            var _a;\n            if (!chunk.account) {\n                return;\n            }\n            const slot = Number(chunk.account.slot);\n            const accountInfo = {\n                owner: new web3_js_1.PublicKey(chunk.account.account.owner),\n                lamports: Number(chunk.account.account.lamports),\n                data: Buffer.Buffer.from(chunk.account.account.data),\n                executable: chunk.account.account.executable,\n                rentEpoch: Number(chunk.account.account.rentEpoch),\n            };\n            if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs) {\n                this.receivingData = true;\n                clearTimeout(this.timeoutId);\n                this.handleRpcResponse({\n                    slot,\n                }, {\n                    accountId: new web3_js_1.PublicKey(chunk.account.account.pubkey),\n                    accountInfo,\n                });\n                this.setTimeout();\n            }\n            else {\n                this.handleRpcResponse({\n                    slot,\n                }, {\n                    accountId: new web3_js_1.PublicKey(chunk.account.account.pubkey),\n                    accountInfo,\n                });\n            }\n        });\n        return new Promise((resolve, reject) => {\n            this.stream.write(request, (err) => {\n                var _a;\n                if (err === null || err === undefined) {\n                    this.listenerId = 1;\n                    if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs) {\n                        this.receivingData = true;\n                        this.setTimeout();\n                    }\n                    resolve();\n                }\n                else {\n                    reject(err);\n                }\n            });\n        }).catch((reason) => {\n            console.error(reason);\n            throw reason;\n        });\n    }\n    async unsubscribe(onResub = false) {\n        if (!onResub && this.resubOpts) {\n            this.resubOpts.resubTimeoutMs = undefined;\n        }\n        this.isUnsubscribing = true;\n        clearTimeout(this.timeoutId);\n        this.timeoutId = undefined;\n        if (this.listenerId != null) {\n            const promise = new Promise((resolve, reject) => {\n                const request = {\n                    slots: {},\n                    accounts: {},\n                    transactions: {},\n                    blocks: {},\n                    blocksMeta: {},\n                    accountsDataSlice: [],\n                    entry: {},\n                    transactionsStatus: {},\n                };\n                this.stream.write(request, (err) => {\n                    if (err === null || err === undefined) {\n                        this.listenerId = undefined;\n                        this.isUnsubscribing = false;\n                        resolve();\n                    }\n                    else {\n                        reject(err);\n                    }\n                });\n            }).catch((reason) => {\n                console.error(reason);\n                throw reason;\n            });\n            return promise;\n        }\n        else {\n            this.isUnsubscribing = false;\n        }\n    }\n}\nexports.grpcProgramAccountSubscriber = grpcProgramAccountSubscriber;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 4885, "column": 0}, "map": {"version":3,"sources":["file:///Users/madhavbansal/Documents/lomen/poc/drift-perps/dashboard/node_modules/.pnpm/%40drift-labs%2Bsdk%402.149.0-beta.0_%40solana%2Bsysvars%402.3.0_fastestsmallesttextencoderdecoder%401.0.22_typescript%405.9.3_ws%408.18.3/node_modules/%40drift-labs/sdk/lib/browser/accounts/laserProgramAccountSubscriber.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.LaserstreamProgramAccountSubscriber = void 0;\nconst web3_js_1 = require(\"@solana/web3.js\");\nconst Buffer = __importStar(require(\"buffer\"));\nconst webSocketProgramAccountSubscriber_1 = require(\"./webSocketProgramAccountSubscriber\");\nconst grpc_1 = require(\"../isomorphic/grpc\");\nclass LaserstreamProgramAccountSubscriber extends webSocketProgramAccountSubscriber_1.WebSocketProgramAccountSubscriber {\n    constructor(laserConfig, commitmentLevel, subscriptionName, accountDiscriminator, program, decodeBufferFn, options = { filters: [] }, resubOpts) {\n        super(subscriptionName, accountDiscriminator, program, decodeBufferFn, options, resubOpts);\n        this.laserConfig = laserConfig;\n        this.commitmentLevel = this.toLaserCommitment(commitmentLevel);\n    }\n    static async create(grpcConfigs, subscriptionName, accountDiscriminator, program, decodeBufferFn, options = {\n        filters: [],\n    }, resubOpts) {\n        var _a;\n        const laserConfig = {\n            apiKey: grpcConfigs.token,\n            endpoint: grpcConfigs.endpoint,\n            maxReconnectAttempts: grpcConfigs.enableReconnect ? 10 : 0,\n            channelOptions: {\n                'grpc.default_compression_algorithm': grpc_1.CompressionAlgorithms.zstd,\n                'grpc.max_receive_message_length': 1000000000,\n            },\n        };\n        const commitmentLevel = (_a = grpcConfigs.commitmentLevel) !== null && _a !== void 0 ? _a : grpc_1.CommitmentLevel.CONFIRMED;\n        return new LaserstreamProgramAccountSubscriber(laserConfig, commitmentLevel, subscriptionName, accountDiscriminator, program, decodeBufferFn, options, resubOpts);\n    }\n    async subscribe(onChange) {\n        var _a;\n        if (this.listenerId != null || this.isUnsubscribing)\n            return;\n        this.onChange = onChange;\n        const filters = this.options.filters.map((filter) => {\n            return {\n                memcmp: {\n                    offset: filter.memcmp.offset,\n                    base58: filter.memcmp.bytes,\n                },\n            };\n        });\n        const request = {\n            slots: {},\n            accounts: {\n                drift: {\n                    account: [],\n                    owner: [this.program.programId.toBase58()],\n                    filters,\n                },\n            },\n            transactions: {},\n            blocks: {},\n            blocksMeta: {},\n            accountsDataSlice: [],\n            commitment: this.commitmentLevel,\n            entry: {},\n            transactionsStatus: {},\n        };\n        try {\n            const stream = await (0, grpc_1.LaserSubscribe)(this.laserConfig, request, async (update) => {\n                var _a;\n                if (update.account) {\n                    const slot = Number(update.account.slot);\n                    const acc = update.account.account;\n                    const accountInfo = {\n                        owner: new web3_js_1.PublicKey(acc.owner),\n                        lamports: Number(acc.lamports),\n                        data: Buffer.Buffer.from(acc.data),\n                        executable: acc.executable,\n                        rentEpoch: Number(acc.rentEpoch),\n                    };\n                    const payload = {\n                        accountId: new web3_js_1.PublicKey(acc.pubkey),\n                        accountInfo,\n                    };\n                    if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs) {\n                        this.receivingData = true;\n                        clearTimeout(this.timeoutId);\n                        this.handleRpcResponse({ slot }, payload);\n                        this.setTimeout();\n                    }\n                    else {\n                        this.handleRpcResponse({ slot }, payload);\n                    }\n                }\n            }, async (error) => {\n                console.error('LaserStream client error:', error);\n                throw error;\n            });\n            this.stream = stream;\n            this.listenerId = 1;\n            if ((_a = this.resubOpts) === null || _a === void 0 ? void 0 : _a.resubTimeoutMs) {\n                this.receivingData = true;\n                this.setTimeout();\n            }\n        }\n        catch (err) {\n            console.error('Failed to start LaserStream client:', err);\n            throw err;\n        }\n    }\n    async unsubscribe(onResub = false) {\n        if (!onResub && this.resubOpts) {\n            this.resubOpts.resubTimeoutMs = undefined;\n        }\n        this.isUnsubscribing = true;\n        clearTimeout(this.timeoutId);\n        this.timeoutId = undefined;\n        if (this.listenerId != null && this.stream) {\n            try {\n                this.stream.cancel();\n            }\n            finally {\n                this.listenerId = undefined;\n                this.isUnsubscribing = false;\n            }\n        }\n        else {\n            this.isUnsubscribing = false;\n        }\n    }\n    toLaserCommitment(level) {\n        var _a, _b;\n        if (typeof level === 'string') {\n            return ((_a = grpc_1.LaserCommitmentLevel[level.toUpperCase()]) !== null && _a !== void 0 ? _a : grpc_1.LaserCommitmentLevel.CONFIRMED);\n        }\n        return (_b = level) !== null && _b !== void 0 ? _b : grpc_1.LaserCommitmentLevel.CONFIRMED;\n    }\n}\nexports.LaserstreamProgramAccountSubscriber = LaserstreamProgramAccountSubscriber;\n"],"names":[],"mappings":"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","ignoreList":[0]}}]
}